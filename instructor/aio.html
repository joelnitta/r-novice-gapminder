<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>R for Reproducible Scientific Analysis: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/swc/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicons/swc/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicons/swc/favicon-16x16.png">
<link rel="manifest" href="../favicons/swc/site.webmanifest">
<link rel="mask-icon" href="../favicons/swc/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav software"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="swc-logo" alt="Software Carpentry" src="../assets/images/software-logo.svg">
</div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav software" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Software Carpentry" src="../assets/images/software-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      R for Reproducible Scientific Analysis
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            R for Reproducible Scientific Analysis
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="discuss.html">Discussion</a></li>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  R for Reproducible Scientific Analysis
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress software">
    <div class="progress-bar software" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-rstudio-intro.html">1. RとRStudio入門</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-project-intro.html">2. RStudio を使ったプロジェクト管理</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-seeking-help.html">3. ヘルプの利用</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-data-structures-part1.html">4. データ構造</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-data-structures-part2.html">5. データフレームの操作</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-data-subsetting.html">6. データの部分集合化</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-control-flow.html">7. Control Flow</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-plot-ggplot2.html">8. Creating Publication-Quality Graphics with ggplot2</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-vectorization.html">9. Vectorization</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="10-functions.html">10. Functions Explained</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="11-writing-data.html">11. Writing Data</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush13">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading13">
        <a href="12-dplyr.html">12. Data Frame Manipulation with dplyr</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush14">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading14">
        <a href="13-tidyr.html">13. Data Frame Manipulation with tidyr</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush15">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading15">
        <a href="14-knitr-markdown.html">14. Producing Reports With knitr</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush16">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading16">
        <a href="15-wrap-up.html">15. Writing Good Software</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="discuss.html">Discussion</a></li>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-rstudio-intro"><p>Content from <a href="01-rstudio-intro.html">RとRStudio入門</a></p>
<hr>
<p>Last updated on 2024-11-21 |

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/episodes/01-rstudio-intro.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 55 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>RStudio内でどのように操作するのか？</li>
<li>Rとの対話方法は？</li>
<li>環境をどのように管理するのか？</li>
<li>パッケージをどのようにインストールするのか？</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>RStudioの各ペインの目的と使用方法を説明する</li>
<li>RStudio内のボタンやオプションの場所を見つける</li>
<li>変数を定義する</li>
<li>データを変数に代入する</li>
<li>インタラクティブなRセッションでワークスペースを管理する</li>
<li>数学および比較演算子を使用する</li>
<li>関数を呼び出す</li>
<li>パッケージを管理する</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="ワークショップを始める前に">ワークショップを始める前に<a class="anchor" aria-label="anchor" href="#%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%83%E3%83%97%E3%82%92%E5%A7%8B%E3%82%81%E3%82%8B%E5%89%8D%E3%81%AB"></a>
</h2>
<hr class="half-width">
<p>ワークショップで使用する一部のパッケージが正しくインストールされない（または全くインストールされない）場合があるため、お使いのマシンにRとRStudioの最新バージョンがインストールされていることを確認してください。</p>
<ul>
<li><a href="https://www.r-project.org/" class="external-link">最新バージョンのRをこちらからダウンロードしてインストールしてください</a></li>
<li><a href="https://www.rstudio.com/products/rstudio/download/#download" class="external-link">RStudioをこちらからダウンロードしてインストールしてください</a></li>
</ul></section><section><h2 class="section-heading" id="なぜrとrstudioを使うのか">なぜRとRStudioを使うのか？<a class="anchor" aria-label="anchor" href="#%E3%81%AA%E3%81%9Cr%E3%81%A8rstudio%E3%82%92%E4%BD%BF%E3%81%86%E3%81%AE%E3%81%8B"></a>
</h2>
<hr class="half-width">
<p>Software CarpentryワークショップのRセクションへようこそ！</p>
<p>科学は多段階のプロセスです。
実験を設計してデータを収集した後、本当の楽しみは分析から始まります！このレッスンでは、R言語の基本を教えるとともに、科学プロジェクトのためのコードを整理するベストプラクティスを学び、作業をより簡単にする方法を紹介します。</p>
<p>データを分析するためにMicrosoft
ExcelやGoogleスプレッドシートを使用することもできますが、これらのツールは柔軟性やアクセス性に限界があります。さらに、元データの変更や探索の手順を共有することが難しいため、これは「再現可能な」研究にとって重要なポイントです（<a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1003285" class="external-link">再現可能な研究についてはこちら</a>）。</p>
<p>したがって、このレッスンでは、RとRStudioを使用してデータの探索を始める方法を学びます。RプログラムはWindows、Mac、Linuxオペレーティングシステムで利用可能で、上記のリンクから無料でダウンロードできます。Rを実行するために必要なのはRプログラムだけです。</p>
<p>しかし、Rをより使いやすくするために、同じくダウンロードしたRStudioというプログラムを使用します。RStudioは無料でオープンソースの統合開発環境（IDE）で、組み込みエディタを提供し、すべてのプラットフォームで動作します（サーバー上でも利用可能）。バージョン管理やプロジェクト管理との統合など、多くの利点があります。</p>
</section><section><h2 class="section-heading" id="概要">概要<a class="anchor" aria-label="anchor" href="#%E6%A6%82%E8%A6%81"></a>
</h2>
<hr class="half-width">
<p>生データから始め、探索的な分析を行い、結果をグラフでプロットする方法を学びます。この例では、<a href="https://www.gapminder.org" class="external-link">gapminder.org</a>のデータセットを使用し、時間を通じた各国の人口情報を扱います。データをRに読み込むことができますか？セネガルの人口をプロットできますか？アジア大陸の国々の平均所得を計算できますか？このレッスンの終わりまでに、これらの国々の人口を1分以内にプロットできるようになります！</p>
<p><strong>基本レイアウト</strong></p>
<p>RStudioを初めて開くと、次の3つのパネルが表示されます：</p>
<ul>
<li>インタラクティブなRコンソール/ターミナル（左全体）</li>
<li>環境/履歴/接続（右上のタブ）</li>
<li>ファイル/プロット/パッケージ/ヘルプ/ビューア（右下のタブ）</li>
</ul>
<figure><img src="../fig/01-rstudio.png" alt="RStudioのレイアウト" class="figure mx-auto d-block"></figure><p>ファイル（例えばRスクリプト）を開くと、上部左にエディタパネルも表示されます。</p>
<figure><img src="../fig/01-rstudio-script.png" alt="RStudioで.Rファイルを開いたレイアウト" class="figure mx-auto d-block"></figure><div id="rスクリプト" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="rスクリプト" class="callout-inner">
<h3 class="callout-title">Rスクリプト</h3>
<div class="callout-content">
<p>Rコンソールに書いたコマンドはファイルに保存し、再実行することができます。このようなRコードを含むファイルをRスクリプトと呼びます。Rスクリプトは名前の末尾が<code>.R</code>となっており、それがRスクリプトであることを示します。</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="rstudio内でのワークフロー">RStudio内でのワークフロー<a class="anchor" aria-label="anchor" href="#rstudio%E5%86%85%E3%81%A7%E3%81%AE%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%95%E3%83%AD%E3%83%BC"></a>
</h2>
<hr class="half-width">
<p>RStudio内で作業する主な方法は2つあります：</p>
<ol style="list-style-type: decimal">
<li>インタラクティブなRコンソール内でテストや試行を行い、そのコードをコピーして.Rファイルに貼り付け、後で実行する。
<ul>
<li>小規模なテストや初期の段階では効果的です。</li>
<li>しかし、すぐに手間がかかるようになります。</li>
</ul>
</li>
<li>最初から.Rファイルに記述し、RStudioのショートカットキーを使用して「Run」コマンドを実行し、現在の行、選択した行、または変更した行をインタラクティブなRコンソールに送る。
<ul>
<li>これは作業を始める良い方法です。すべてのコードが後で使用するために保存されます。</li>
<li>RStudio内またはRの<code>source()</code>関数を使用して作成したファイルを実行できます。</li>
</ul>
</li>
</ol>
<div id="ヒントコードのセグメントを実行する" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒントコードのセグメントを実行する" class="callout-inner">
<h3 class="callout-title">ヒント：コードのセグメントを実行する</h3>
<div class="callout-content">
<p>RStudioでは、エディタウィンドウからコードを実行する柔軟性があります。ボタン、メニューオプション、およびキーボードショートカットがあります。現在の行を実行するには、次の方法があります：</p>
<ol style="list-style-type: decimal">
<li>エディタパネルの上部にある「Run」ボタンをクリックする</li>
<li>「Code」メニューから「Run Lines」を選択する</li>
<li>WindowsまたはLinuxでは<kbd>Ctrl</kbd>+<kbd>Return</kbd>、OS
Xでは<kbd>⌘</kbd>+<kbd>Return</kbd>を押す
（このショートカットはボタンの上にマウスをホバーさせると確認できます）。コードブロックを実行するには、選択して「Run」をクリックします。
最近実行したコードブロックを修正した場合、セクションを再選択して「Run」を押す必要はありません。次のボタン「Re-run
the previous
region」を使用すると、修正を含む前のコードブロックを実行できます。</li>
</ol>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="r入門">R入門<a class="anchor" aria-label="anchor" href="#r%E5%85%A5%E9%96%80"></a>
</h2>
<hr class="half-width">
<p>Rでの作業の多くは、インタラクティブなRコンソール内で行います。ここでは、すべてのコードを実行し、Rスクリプトファイルに追加する前にアイデアを試すのに便利な環境です。RStudioのコンソールは、コマンドライン環境で<code>R</code>と入力した場合と同じです。</p>
<p>Rのインタラクティブセッションを開くと、最初に情報が表示され、その後に「&gt;」と点滅するカーソルが現れます。これは、シェルレッスンで学んだシェル環境と多くの点で似ています。「Read,
evaluate, print
loop」（読み取り、評価、印刷ループ）の考え方に基づいて動作します：コマンドを入力すると、Rがそれを実行し、結果を返します。</p>
</section><section><h2 class="section-heading" id="rを計算機として使う">Rを計算機として使う<a class="anchor" aria-label="anchor" href="#r%E3%82%92%E8%A8%88%E7%AE%97%E6%A9%9F%E3%81%A8%E3%81%97%E3%81%A6%E4%BD%BF%E3%81%86"></a>
</h2>
<hr class="half-width">
<p>Rで最も簡単なことは、算術を行うことです：</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">+</span> <span class="fl">100</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 101</code></pre>
</div>
<p>Rは答えを表示し、その前に”[1]“を付けます。[1]はコンソールに表示される行の最初の要素のインデックスを示します。ベクトルのインデックスについての詳細は、<a href="https://swcarpentry.github.io/r-novice-gapminder/06-data-subsetting/index.html" class="external-link">エピソード6：データのサブセット化</a>を参照してください。</p>
<p>不完全なコマンドを入力すると、R</p>
<p>は完了を待機します。Unix
Shellのbashに慣れている場合、この動作をbashで見たことがあるかもしれません。</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">+</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>+</code></pre>
</div>
<p>「&gt;」ではなく「+」が表示された場合、Rはコマンドの完了を待機しています。コマンドをキャンセルしたい場合は<kbd>Esc</kbd>を押すと、RStudioは「&gt;」プロンプトに戻ります。</p>
<div id="ヒントコマンドのキャンセル" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒントコマンドのキャンセル" class="callout-inner">
<h3 class="callout-title">ヒント：コマンドのキャンセル</h3>
<div class="callout-content">
<p>コマンドラインからRを使用している場合は、RStudioの代わりに<kbd>Esc</kbd>ではなく<kbd>Ctrl</kbd>+<kbd>C</kbd>を使用してコマンドをキャンセルする必要があります。これはMacユーザーにも適用されます！</p>
<p>コマンドのキャンセルは、不完全なコマンドを終了させるだけでなく、予想以上に時間がかかる場合にコードの実行を停止したり、現在書いているコードを削除したりするためにも役立ちます。</p>
</div>
</div>
</div>
<p>Rを計算機として使用する場合、演算の順序は学校で学んだものと同じです。</p>
<p>優先順位が高いものから低いものへ：</p>
<ul>
<li>括弧：<code>(</code>, <code>)</code>
</li>
<li>累乗：<code>^</code>または<code>**</code>
</li>
<li>乗算：<code>*</code>
</li>
<li>除算：<code>/</code>
</li>
<li>加算：<code>+</code>
</li>
<li>減算：<code>-</code>
</li>
</ul>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">3</span> <span class="op">+</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 13</code></pre>
</div>
<p>評価の順序を変更したい場合や意図を明確にしたい場合は、括弧を使用してグループ化します。</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 16</code></pre>
</div>
<p>必要ない場合は煩雑になりますが、意図を明確にできます。他の人が後でコードを読むかもしれないことを忘れないでください。</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fl">3</span> <span class="op">+</span> <span class="op">(</span><span class="fl">5</span> <span class="op">*</span> <span class="op">(</span><span class="fl">2</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># 読みにくい</span></span>
<span><span class="fl">3</span> <span class="op">+</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">^</span> <span class="fl">2</span>       <span class="co"># 規則を覚えていれば明快</span></span>
<span><span class="fl">3</span> <span class="op">+</span> <span class="fl">5</span> <span class="op">*</span> <span class="op">(</span><span class="fl">2</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>     <span class="co"># 規則を忘れた場合はこれが助けになる</span></span></code></pre>
</div>
<p>各コード行の後にあるテキストは「コメント」と呼ばれます。ハッシュ記号<code>#</code>の後に続く内容は、コードを実行する際にRによって無視されます。</p>
<p>非常に小さいまたは大きい数値は、科学表記法で表示されます：</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">2</span><span class="op">/</span><span class="fl">10000</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2e-04</code></pre>
</div>
<p>これは「<code>10^XX</code>で掛ける」という短縮形です。したがって、<code>2e-4</code>は<code>2 * 10^(-4)</code>の短縮形です。</p>
<p>科学表記法で数値を書くこともできます：</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">5e3</span>  <span class="co"># マイナスがない点に注意</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5000</code></pre>
</div>
</section><section><h2 class="section-heading" id="数学関数">数学関数<a class="anchor" aria-label="anchor" href="#%E6%95%B0%E5%AD%A6%E9%96%A2%E6%95%B0"></a>
</h2>
<hr class="half-width">
<p>Rには多くの組み込み数学関数があります。関数を呼び出すには、関数名を入力し、その後に開き括弧と閉じ括弧を続けます。関数は引数を入力として受け取ります。関数の括弧内に入力したものはすべて引数と見なされます。関数によって引数の数は異なり、引数を必要としないものから複数の引数を必要とするものまであります。例：</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">getwd</span><span class="op">(</span><span class="op">)</span> <span class="co"># 絶対パスを返す</span></span></code></pre>
</div>
<p>この例では引数は不要ですが、以下の数学関数では結果を計算するために値を渡す必要があります。</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sin</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>  <span class="co"># 三角関数</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.841471</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">log</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>  <span class="co"># 自然対数</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">log10</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="co"># 常用対数（底10）</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">exp</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span> <span class="co"># e^(1/2)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.648721</code></pre>
</div>
<p>Rのすべての関数を覚えようとする必要はありません。Googleで検索するか、関数名の最初の数文字を覚えていれば、RStudioのタブ補完機能を使うことができます。</p>
<p>RStudioの大きな利点の一つは、オートコンプリート機能があることです。これにより、関数、引数、および受け取る値を簡単に調べることができます。</p>
<p>コマンド名の前に<code>?</code>を付けると、そのコマンドのヘルプページが開きます。RStudioを使用している場合、’Help’ペインに表示されます。ターミナルでRを使用している場合は、ブラウザでヘルプページが開きます。ヘルプページにはコマンドの詳細な説明と動作の仕組みが含まれています。ページの下部までスクロールすると、通常、コマンドの使用例が掲載されています。後ほど例を見ていきます。</p>
</section><section><h2 class="section-heading" id="比較演算">比較演算<a class="anchor" aria-label="anchor" href="#%E6%AF%94%E8%BC%83%E6%BC%94%E7%AE%97"></a>
</h2>
<hr class="half-width">
<p>Rでは比較を行うこともできます：</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">==</span> <span class="fl">1</span>  <span class="co"># 等しい（等号が2つ、"等しい"と読む）</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">!=</span> <span class="fl">2</span>  <span class="co"># 等しくない（"等しくない"と読む）</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">&lt;</span> <span class="fl">2</span>  <span class="co"># より小さい</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">&lt;=</span> <span class="fl">1</span>  <span class="co"># 以下</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">&gt;</span> <span class="fl">0</span>  <span class="co"># より大きい</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">&gt;=</span> <span class="op">-</span><span class="fl">9</span> <span class="co"># 以上</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<div id="ヒント数値の比較" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント数値の比較" class="callout-inner">
<h3 class="callout-title">ヒント：数値の比較</h3>
<div class="callout-content">
<p>数値を比較する際の注意点として、整数（小数を含まない数値型）以外を比較する場合は、<code>==</code>を使用しないでください。</p>
<p>コンピュータは小数を特定の精度でしか表現できないため、Rが表示する際に同じに見える2つの数値が、内部表現では異なる場合があります。このわずかな差異は「数値計算誤差（Machine
numeric tolerance）」と呼ばれます。</p>
<p>代わりに<code>all.equal</code>関数を使用してください。</p>
<p>さらに詳しく知りたい方はこちら：<a href="https://floating-point-gui.de/" class="external-link">http://floating-point-gui.de/</a></p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="変数と代入">変数と代入<a class="anchor" aria-label="anchor" href="#%E5%A4%89%E6%95%B0%E3%81%A8%E4%BB%A3%E5%85%A5"></a>
</h2>
<hr class="half-width">
<p>代入演算子<code>&lt;-</code>を使用して、値を変数に格納できます：</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">40</span></span></code></pre>
</div>
<p>代入は値を表示しません。代わりに、それを後で使用するために<strong>変数</strong>というものに格納します。この場合、<code>x</code>には値<code>0.025</code>が格納されています：</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.025</code></pre>
</div>
<p>正確には、この格納された値は<a href="https://en.wikipedia.org/wiki/Floating_point" class="external-link">浮動小数点数</a>と呼ばれる分数の<em>10進数近似値</em>です。</p>
<p>RStudioの右上ペインにある<code>Environment</code>タブを確認すると、<code>x</code>とその値が表示されていることがわかります。変数<code>x</code>は、数値を期待する計算の中で数値の代わりに使用できます：</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">log</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -3.688879</code></pre>
</div>
<p>また、変数には再代入も可能です：</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></code></pre>
</div>
<p>以前は<code>x</code>に0.025が格納されていましたが、現在は100が格納されています。</p>
<p>代入値には、代入先の変数を含めることもできます：</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span> <span class="co"># RStudioの右上タブでxの説明が更新されることに注目</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span></span></code></pre>
</div>
<p>代入の右辺には有効なR式を使用できます。右辺は代入が行われる前に<em>完全に評価</em>されます。</p>
<p>変数名には、文字、数字、アンダースコア、ピリオドを含めることができますが、スペースは含められません。また、変数名は文字またはピリオドで始める必要があります（数字やアンダースコアでは始めることはできません）。ピリオドで始まる変数は隠し変数と見なされます。</p>
<p>長い変数名については、異なる人が異なる規約を使用します。その例として：</p>
<ul>
<li>periods.between.words</li>
<li>underscores_between_words</li>
<li>camelCaseToSeparateWords</li>
</ul>
<p>どれを使用するかは自由ですが、<strong>一貫性を保つ</strong>ことが重要です。</p>
<p>代入には<code>=</code>演算子を使用することも可能です：</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">40</span></span></code></pre>
</div>
<p>しかし、これはRユーザーの間ではあまり一般的ではありません。最も重要なのは、使用する演算子に<strong>一貫性を持つ</strong>ことです。<code>&lt;-</code>を使用したほうが混乱が少ない場合もあり、コミュニティでは最も一般的に使われています。そのため、<code>&lt;-</code>を使用することを推奨します。</p>
<div id="チャレンジ-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-1" class="callout-inner">
<h3 class="callout-title">チャレンジ 1</h3>
<div class="callout-content">
<p>次の中で有効なRの変数名はどれですか？</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>min_height</span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>max.height</span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>_age</span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>.mass</span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>MaxLength</span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a>min<span class="sc">-</span>length</span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a><span class="dv">2</span>widths</span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a>celsius2kelvin</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> チャレンジ1の解答 </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>次のものはR変数として使用できます：</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">min_height</span></span>
<span><span class="va">max.height</span></span>
<span><span class="va">MaxLength</span></span>
<span><span class="va">celsius2kelvin</span></span></code></pre>
</div>
<p>次のものは隠し変数を作成します：</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.mass</span></span></code></pre>
</div>
<p>次のものは変数を作成できません：</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a>_age</span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a>min<span class="sc">-</span>length</span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a><span class="dv">2</span>widths</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="ベクトル化">ベクトル化<a class="anchor" aria-label="anchor" href="#%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB%E5%8C%96"></a>
</h2>
<hr class="half-width">
<p>Rの特徴の1つに、Rが<strong>ベクトル化</strong>されているという点があります。つまり、変数や関数にベクトルを値として持たせることができます。物理学や数学におけるベクトルとは異なり、Rにおけるベクトルは同じデータ型の値が順序付けられた集合を指します。例：</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 4 5</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">2</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  2  4  8 16 32</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span><span class="fl">2</span><span class="op">^</span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  2  4  8 16 32</code></pre>
</div>
<p>この機能は非常に強力で、今後のレッスンでさらに詳しく説明します。</p>
</section><section><h2 class="section-heading" id="環境の管理">環境の管理<a class="anchor" aria-label="anchor" href="#%E7%92%B0%E5%A2%83%E3%81%AE%E7%AE%A1%E7%90%86"></a>
</h2>
<hr class="half-width">
<p>Rセッションとやり取りするための便利なコマンドがいくつかあります。</p>
<p><code>ls</code>を使用すると、グローバル環境（現在のRセッション）に保存されているすべての変数と関数を一覧表示できます：</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ls</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "x" "y"</code></pre>
</div>
<div id="ヒント隠しオブジェクト" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント隠しオブジェクト" class="callout-inner">
<h3 class="callout-title">ヒント：隠しオブジェクト</h3>
<div class="callout-content">
<p>シェルと同様に、<code>ls</code>ではデフォルトで”.”で始まる変数や関数は表示されません。すべてのオブジェクトを一覧表示するには、<code>ls(all.names=TRUE)</code>と入力してください。</p>
</div>
</div>
</div>
<p>ここでは、<code>ls</code>に引数を渡していませんが、関数を呼び出すために括弧は必要です。</p>
<p><code>ls</code>だけを入力すると、オブジェクト一覧ではなくコードが表示されます：</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ls</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>function (name, pos = -1L, envir = as.environment(pos), all.names = FALSE,
    pattern, sorted = TRUE)
{
    if (!missing(name)) {
        pos &lt;- tryCatch(name, error = function(e) e)
        if (inherits(pos, "error")) {
            name &lt;- substitute(name)
            if (!is.character(name))
                name &lt;- deparse(name)
            warning(gettextf("%s converted to character string",
                sQuote(name)), domain = NA)
            pos &lt;- name
        }
    }
    all.names &lt;- .Internal(ls(envir, all.names, sorted))
    if (!missing(pattern)) {
        if ((ll &lt;- length(grep("[", pattern, fixed = TRUE))) &amp;&amp;
            ll != length(grep("]", pattern, fixed = TRUE))) {
            if (pattern == "[") {
                pattern &lt;- "\\["
                warning("replaced regular expression pattern '[' by  '\\\\['")
            }
            else if (length(grep("[^\\\\]\\[&lt;-", pattern))) {
                pattern &lt;- sub("\\[&lt;-", "\\\\\\[&lt;-", pattern)
                warning("replaced '[&lt;-' by '\\\\[&lt;-' in regular expression pattern")
            }
        }
        grep(pattern, all.names, value = TRUE)
    }
    else all.names
}
&lt;bytecode: 0x55aea48f6e20&gt;
&lt;environment: namespace:base&gt;</code></pre>
</div>
<p>これはどういうことでしょうか？</p>
<p>Rではすべてがオブジェクトであり、オブジェクト名だけを入力すると、その内容が表示されます。先ほど作成したオブジェクト<code>x</code>には1,
2, 3, 4, 5が格納されています：</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 4 5</code></pre>
</div>
<p>オブジェクト<code>ls</code>には、<code>ls</code>関数を動作させるRコードが格納されています！関数の仕組みや作成方法については後のレッスンで説明します。</p>
<p>不要になったオブジェクトを削除するには、<code>rm</code>を使用します：</p>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rm</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<p>多くのオブジェクトが環境にあり、それらをすべて削除したい場合は、<code>ls</code>の結果を<code>rm</code>関数に渡します：</p>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rm</span><span class="op">(</span>list <span class="op">=</span> <span class="fu">ls</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>この場合、2つの関数を組み合わせています。演算の順序と同様に、最も内側の括弧内の内容が最初に評価されます。</p>
<p>この場合、<code>ls</code>の結果が<code>rm</code>の<code>list</code>引数として使用されるよう指定しています。引数に値を名前で割り当てる場合、<strong>必ず<code>=</code>演算子を使用</strong>する必要があります！</p>
<p>代わりに<code>&lt;-</code>を使用すると、予期しない副作用が発生するか、エラーメッセージが表示される可能性があります：</p>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rm</span><span class="op">(</span><span class="va">list</span> <span class="op">&lt;-</span> <span class="fu">ls</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in rm(list &lt;- ls()): ... must contain names or character strings</code></pre>
</div>
<div id="ヒント警告とエラー" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント警告とエラー" class="callout-inner">
<h3 class="callout-title">ヒント：警告とエラー</h3>
<div class="callout-content">
<p>Rが予期しない動作をした場合は注意してください！エラーはRが計算を続行できない場合に発生します。一方、警告は通常、関数が実行されたものの、期待通りに動作しなかったことを意味します。</p>
<p>どちらの場合も、Rが表示するメッセージには問題を解決するための手がかりが含まれていることが多いです。</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="rパッケージ">Rパッケージ<a class="anchor" aria-label="anchor" href="#r%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"></a>
</h2>
<hr class="half-width">
<p>Rにはパッケージを作成することで関数を追加することができます。また、他の人が作成したパッケージを利用することも可能です。この執筆時点で、CRAN（Comprehensive
R Archive
Network）には10,000を超えるパッケージが利用可能です。RとRStudioにはパッケージを管理するための機能があります：</p>
<ul>
<li>インストールされているパッケージを確認するには、<code>installed.packages()</code>を入力します。</li>
<li>パッケージをインストールするには、<code>install.packages("packagename")</code>と入力します。ここで<code>packagename</code>はパッケージ名で、引用符で囲みます。</li>
<li>インストール済みのパッケージを更新するには、<code>update.packages()</code>を入力します。</li>
<li>パッケージを削除するには、<code>remove.packages("packagename")</code>を使用します。</li>
<li>パッケージを利用可能にするには、<code>library(packagename)</code>を入力します。</li>
</ul>
<p>RStudioの右下ペインの「Packages」タブからもパッケージを表示、ロード、デタッチすることができます。このタブをクリックすると、インストール済みのパッケージがチェックボックス付きで表示されます。パッケージ名の横にあるチェックボックスがオンの場合、そのパッケージはロードされており、オフの場合はロードされていません。空のボックスをクリックするとそのパッケージがロードされ、チェックボックスをクリックするとパッケージがデタッチされます。</p>
<p>また、「Packages」タブの上部にある「Install」ボタンと「Update」ボタンを使用して、パッケージをインストールおよび更新できます。</p>
<div id="チャレンジ-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-2" class="callout-inner">
<h3 class="callout-title">チャレンジ 2</h3>
<div class="callout-content">
<p>次のプログラムの各文の後で、各変数の値はどうなるでしょうか？</p>
<div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="fl">47.5</span></span>
<span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fl">122</span></span>
<span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="va">mass</span> <span class="op">*</span> <span class="fl">2.3</span></span>
<span><span class="va">age</span> <span class="op">&lt;-</span> <span class="va">age</span> <span class="op">-</span> <span class="fl">20</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> チャレンジ2の解答 </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb64">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="fl">47.5</span></span></code></pre>
</div>
<p>この時点で変数<code>mass</code>の値は47.5になります。</p>
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fl">122</span></span></code></pre>
</div>
<p>この時点で変数<code>age</code>の値は122になります。</p>
<div class="codewrapper sourceCode" id="cb66">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="va">mass</span> <span class="op">*</span> <span class="fl">2.3</span></span></code></pre>
</div>
<p>既存の値47.5に2.3を掛け、新しい値109.25を<code>mass</code>に格納します。</p>
<div class="codewrapper sourceCode" id="cb67">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="va">age</span> <span class="op">-</span> <span class="fl">20</span></span></code></pre>
</div>
<p>既存の値122から20を引き、新しい値102を<code>age</code>に格納します。</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-3" class="callout-inner">
<h3 class="callout-title">チャレンジ 3</h3>
<div class="callout-content">
<p>前のチャレンジのコードを実行し、massとageを比較するコマンドを書きなさい。massはageより大きいですか？</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> チャレンジ3の解答 </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>この質問に答える方法の1つとして、次のように<code>&gt;</code>を使用できます：</p>
<div class="codewrapper sourceCode" id="cb68">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mass</span> <span class="op">&gt;</span> <span class="va">age</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<p>このコードは、109.25が102より大きいため、論理値<code>TRUE</code>を返すはずです。</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-4" class="callout-inner">
<h3 class="callout-title">チャレンジ 4</h3>
<div class="callout-content">
<p>作業環境を整理し、massとageの変数を削除しなさい。</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> チャレンジ4の解答 </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>このタスクを達成するには、<code>rm</code>コマンドを使用します：</p>
<div class="codewrapper sourceCode" id="cb70">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rm</span><span class="op">(</span><span class="va">age</span>, <span class="va">mass</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ-5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-5" class="callout-inner">
<h3 class="callout-title">チャレンジ 5</h3>
<div class="callout-content">
<p>以下のパッケージをインストールしなさい：<code>ggplot2</code>,
<code>plyr</code>, <code>gapminder</code></p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> チャレンジ5の解答 </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>必要なパッケージをインストールするには、<code>install.packages()</code>コマンドを使用します。</p>
<div class="codewrapper sourceCode" id="cb71">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"plyr"</span><span class="op">)</span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"gapminder"</span><span class="op">)</span></span></code></pre>
</div>
<p>1つの<code>install.packages()</code>コマンドで複数のパッケージ</p>
<p>をインストールする別の方法は次のとおりです：</p>
<div class="codewrapper sourceCode" id="cb72">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"ggplot2"</span>, <span class="st">"plyr"</span>, <span class="st">"gapminder"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p><code>ggplot2</code>をインストールする際、一部のユーザーは依存関係フラグを使用する必要がある場合があります。これは既知のバグではなく、ワークショップの実施中に確認されたエラーを解決するための推奨事項です：</p>
<div class="codewrapper sourceCode" id="cb73">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"ggplot2"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>RStudioを使用してRプログラムを作成および実行します。</li>
<li>Rには通常の算術演算子と数学関数があります。</li>
<li>
<code>&lt;-</code>を使用して変数に値を代入します。</li>
<li>
<code>ls()</code>を使用してプログラム内の変数を一覧表示します。</li>
<li>
<code>rm()</code>を使用してプログラム内のオブジェクトを削除します。</li>
<li>
<code>install.packages()</code>を使用してパッケージ（ライブラリ）をインストールします。</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-02-project-intro"><p>Content from <a href="02-project-intro.html">RStudio を使ったプロジェクト管理</a></p>
<hr>
<p>Last updated on 2024-11-21 |

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/episodes/02-project-intro.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>R でプロジェクトをどのように管理できますか？</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>RStudio で自己完結型のプロジェクトを作成する</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="はじめに">はじめに<a class="anchor" aria-label="anchor" href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"></a>
</h2>
<hr class="half-width">
<p>科学的なプロセスは本質的に段階的なものであり、多くのプロジェクトはランダムなメモ、一部のコード、次に原稿と進行し、最終的にはすべてが混ざり合ってしまうことがよくあります。</p>
<blockquote class="twitter-tweet">
<p>
プロジェクトを再現可能な方法で管理することは、科学を再現可能にするだけでなく、生活をより簡単にします。
</p>
— Vince Buffalo (<span class="citation">@vsbuffalo</span>)
<a href="https://twitter.com/vsbuffalo/status/323638476153167872" class="external-link">2013年4月15日</a>
</blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script><p>ほとんどの人はプロジェクトを次のように整理しがちです：</p>
<figure><img src="../fig/bad_layout.png" alt="悪いプロジェクト構成を示すファイルマネージャーのスクリーンショット" class="figure mx-auto d-block"></figure><p>このような方法を<em>絶対に</em>避けるべき理由は数多くあります：</p>
<ol style="list-style-type: decimal">
<li>データのどのバージョンがオリジナルで、どれが修正済みなのかを区別するのが非常に難しい。</li>
<li>様々な拡張子のファイルが混在して、非常に散らかる。</li>
<li>必要なものを見つけたり、正確なコードで生成した正しい図表を関連付けたりするのに非常に時間がかかる。</li>
</ol>
<p>良いプロジェクト構成は、最終的に生活をより簡単にします：</p>
<ul>
<li>データの整合性を確保しやすくなる。</li>
<li>他の人（研究室の同僚、共同研究者、指導教員）とコードを共有するのが簡単になる。</li>
<li>原稿の投稿時にコードを簡単にアップロードできる。</li>
<li>しばらく休んだ後にプロジェクトを再開しやすくなる。</li>
</ul></section><section><h2 class="section-heading" id="考えられる解決策">考えられる解決策<a class="anchor" aria-label="anchor" href="#%E8%80%83%E3%81%88%E3%82%89%E3%82%8C%E3%82%8B%E8%A7%A3%E6%B1%BA%E7%AD%96"></a>
</h2>
<hr class="half-width">
<p>幸いなことに、作業を効果的に管理するためのツールやパッケージが存在します。</p>
<p>RStudio
の最も強力で便利な機能の一つがプロジェクト管理機能です。本日はこれを使って自己完結型の再現可能なプロジェクトを作成します。</p>
<div id="チャレンジ-1-自己完結型プロジェクトの作成" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="チャレンジ-1-自己完結型プロジェクトの作成" class="callout-inner">
<h3 class="callout-title">チャレンジ 1: 自己完結型プロジェクトの作成</h3>
<div class="callout-content">
<p>RStudio で新しいプロジェクトを作成します：</p>
<ol style="list-style-type: decimal">
<li>「File」メニューをクリックし、「New Project」を選択します。</li>
<li>「New Directory」をクリックします。</li>
<li>「New Project」をクリックします。</li>
<li>プロジェクトを保存するディレクトリの名前（例：<code>my_project</code>）を入力します。</li>
<li>「Create a git
repository」のチェックボックスが表示される場合は選択します。</li>
<li>「Create Project」ボタンをクリックします。</li>
</ol>
</div>
</div>
</div>
<p>作成した RStudio
プロジェクトを開く最も簡単な方法は、ファイルシステムをたどって保存したディレクトリに移動し、<code>.Rproj</code>
ファイルをダブルクリックすることです。これにより RStudio が開き、R
セッションが <code>.Rproj</code>
ファイルと同じディレクトリで開始します。データ、プロット、スクリプトはすべてプロジェクトディレクトリに関連付けられます。さらに、RStudio
プロジェクトは複数のプロジェクトを同時に開くことが可能で、それぞれのプロジェクトディレクトリに分離されます。これにより、複数のプロジェクトを開いても相互に干渉しません。</p>
<div id="チャレンジ-2-ファイルシステムを使った-rstudio-プロジェクトの開き方" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="チャレンジ-2-ファイルシステムを使った-rstudio-プロジェクトの開き方" class="callout-inner">
<h3 class="callout-title">チャレンジ 2: ファイルシステムを使った RStudio プロジェクトの開き方</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>RStudio を終了します。</li>
<li>チャレンジ 1 で作成したプロジェクトのディレクトリに移動します。</li>
<li>そのディレクトリ内の <code>.Rproj</code>
ファイルをダブルクリックします。</li>
</ol>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="プロジェクト管理のベストプラクティス">プロジェクト管理のベストプラクティス<a class="anchor" aria-label="anchor" href="#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E7%AE%A1%E7%90%86%E3%81%AE%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9"></a>
</h2>
<hr class="half-width">
<p>プロジェクトを整理するための「ベスト」な方法はありませんが、管理を容易にするために従うべきいくつかの一般原則があります：</p>
<div class="section level3">
<h3 id="データを読み取り専用として扱う">データを読み取り専用として扱う<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E8%AA%AD%E3%81%BF%E5%8F%96%E3%82%8A%E5%B0%82%E7%94%A8%E3%81%A8%E3%81%97%E3%81%A6%E6%89%B1%E3%81%86"></a>
</h3>
<p>プロジェクトを設定する際の最も重要な目標はこれです。データの収集は通常、時間と費用がかかります。データをインタラクティブに操作する（例：Excel
で）と、データの出所や収集後にどのように変更されたかを把握できなくなります。そのため、データを「読み取り専用」として扱うのが良い考えです。</p>
</div>
<div class="section level3">
<h3 id="データのクリーニング">データのクリーニング<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0"></a>
</h3>
<p>多くの場合、データは「汚れて」おり、R（または他のプログラミング言語）で有用な形式にするために大幅な前処理が必要です。このタスクは「データマンジング」と呼ばれることもあります。これらのスクリプトを別のフォルダに保存し、クリーンなデータセットを保持する「読み取り専用」データフォルダを作成することで、両者の混同を防ぐことができます。</p>
</div>
<div class="section level3">
<h3 id="生成された出力を使い捨てとみなす">生成された出力を使い捨てとみなす<a class="anchor" aria-label="anchor" href="#%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%81%9F%E5%87%BA%E5%8A%9B%E3%82%92%E4%BD%BF%E3%81%84%E6%8D%A8%E3%81%A6%E3%81%A8%E3%81%BF%E3%81%AA%E3%81%99"></a>
</h3>
<p>スクリプトによって生成されたものはすべて使い捨てとみなすべきです：スクリプトからすべてを再生成できる必要があります。</p>
<p>出力を管理する方法はたくさんあります。各分析ごとに異なるサブディレクトリを持つ出力フォルダを用意すると、後で便利です。多くの分析は探索的で最終プロジェクトに使用されないことが多く、一部の分析はプロジェクト間で共有されることもあります。</p>
<div id="ヒント-科学的コンピューティングのための十分に良い実践" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント-科学的コンピューティングのための十分に良い実践" class="callout-inner">
<h3 class="callout-title">ヒント: 科学的コンピューティングのための「十分に良い」実践</h3>
<div class="callout-content">
<p><a href="https://github.com/swcarpentry/good-enough-practices-in-scientific-computing/blob/gh-pages/good-enough-practices-for-scientific-computing.pdf" class="external-link">科学的コンピューティングのための「十分に良い」実践</a>
では、プロジェクトの構成について以下の推奨事項を挙げています：</p>
<ol style="list-style-type: decimal">
<li>各プロジェクトを専用のディレクトリに配置し、そのディレクトリにプロジェクト名を付ける。</li>
<li>プロジェクトに関連するテキスト文書を <code>doc</code>
ディレクトリに配置する。</li>
<li>生データとメタデータを <code>data</code>
ディレクトリに、クリーンアップや分析中に生成されたファイルを
<code>results</code> ディレクトリに配置する。</li>
<li>プロジェクトのスクリプトやプログラムのソースを <code>src</code>
ディレクトリに配置し、他から持ち込んだプログラムやローカルでコンパイルしたプログラムを
<code>bin</code> ディレクトリに配置する。</li>
<li>すべてのファイルに内容や機能を反映した名前を付ける。</li>
</ol>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="関数の定義と適用を分離する">関数の定義と適用を分離する<a class="anchor" aria-label="anchor" href="#%E9%96%A2%E6%95%B0%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%81%A8%E9%81%A9%E7%94%A8%E3%82%92%E5%88%86%E9%9B%A2%E3%81%99%E3%82%8B"></a>
</h3>
<p>R を効率的に使用する最も効果的な方法の一つは、最初に .R
スクリプトに実行したいコードを書き、RStudio
のキーボードショートカットを使用するか「Run」ボタンをクリックして、選択した行をインタラクティブな
R コンソールで実行することです。</p>
<p>プロジェクトの初期段階では、最初の .R
スクリプトファイルに多くの直接実行されるコード行が含まれることがよくあります。プロジェクトが進むにつれて、再利用可能なコードチャンクが独自の関数に分離されます。これらの関数を保存するためのフォルダと分析スクリプトを保存するためのフォルダを分けるのが良いアイデアです。</p>
</div>
<div class="section level3">
<h3 id="データを-data-ディレクトリに保存する">データを data ディレクトリに保存する<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92-data-%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AB%E4%BF%9D%E5%AD%98%E3%81%99%E3%82%8B"></a>
</h3>
<p>良好なディレクト</p>
<p>リ構造ができたら、データファイルを <code>data/</code>
ディレクトリに保存します。</p>
<div id="チャレンジ-3" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="チャレンジ-3" class="callout-inner">
<h3 class="callout-title">チャレンジ 3</h3>
<div class="callout-content">
<p><a href="../data/gapminder_data.csv">このリンクから CSV
ファイルをダウンロード</a>してください。</p>
<ol style="list-style-type: decimal">
<li>ファイルをダウンロードします（上記リンクを右クリック -&gt;
「リンク先を名前を付けて保存」/「名前を付けて保存」、またはリンクをクリックしページが読み込まれた後に
<kbd>Ctrl</kbd>+<kbd>S</kbd> を押すか、メニューの「ファイル」 -&gt;
「ページを名前を付けて保存」を選択）。</li>
<li>
<code>gapminder_data.csv</code>
という名前で保存されていることを確認します。</li>
<li>ファイルをプロジェクト内の <code>data/</code>
フォルダに保存します。</li>
</ol>
<p>後ほどこのデータを読み込み、確認します。</p>
</div>
</div>
</div>
<div id="チャレンジ-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-4" class="callout-inner">
<h3 class="callout-title">チャレンジ 4</h3>
<div class="callout-content">
<p>R
に読み込む前に、コマンドラインからデータセットについての一般的な情報を得ることは有益です。これにより、R
に読み込む際の判断に役立ちます。コマンドラインシェルを使用して以下の質問に答えてください：</p>
<ol style="list-style-type: decimal">
<li>ファイルのサイズはどれくらいですか？</li>
<li>このファイルには何行のデータがありますか？</li>
<li>このファイルにはどのような値が含まれていますか？</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ 4 の解答
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>次のコマンドをシェルで実行します：</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lh</span> data/gapminder_data.csv</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>-rw-r--r-- 1 runner docker 80K Nov 21 06:56 data/gapminder_data.csv</code></pre>
</div>
<p>ファイルサイズは 80K です。</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> data/gapminder_data.csv</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>1705 data/gapminder_data.csv</code></pre>
</div>
<p>行数は 1705 行です。データの内容は次のようになります：</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">head</span> data/gapminder_data.csv</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>country,year,pop,continent,lifeExp,gdpPercap
Afghanistan,1952,8425333,Asia,28.801,779.4453145
Afghanistan,1957,9240934,Asia,30.332,820.8530296
Afghanistan,1962,10267083,Asia,31.997,853.10071
Afghanistan,1967,11537966,Asia,34.02,836.1971382
Afghanistan,1972,13079460,Asia,36.088,739.9811058
Afghanistan,1977,14880372,Asia,38.438,786.11336
Afghanistan,1982,12881816,Asia,39.854,978.0114388
Afghanistan,1987,13867957,Asia,40.822,852.3959448
Afghanistan,1992,16317921,Asia,41.674,649.3413952</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="ヒント-rstudio-のコマンドライン" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント-rstudio-のコマンドライン" class="callout-inner">
<h3 class="callout-title">ヒント: RStudio のコマンドライン</h3>
<div class="callout-content">
<p>RStudio のコンソールペインにある「Terminal」タブを使用すると、RStudio
内で直接コマンドラインを操作できます。</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="作業ディレクトリ">作業ディレクトリ<a class="anchor" aria-label="anchor" href="#%E4%BD%9C%E6%A5%AD%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA"></a>
</h3>
<p>R
の現在の作業ディレクトリを知ることは重要です。なぜなら、他のファイルにアクセスする必要があるとき（例：データファイルをインポートする場合）、R
は現在の作業ディレクトリを基準にそれらのファイルを探すからです。</p>
<p>新しい RStudio
プロジェクトを作成するたびに、そのプロジェクトの新しいディレクトリが作成されます。既存の
<code>.Rproj</code> ファイルを開くと、そのプロジェクトが開き、R
の作業ディレクトリがそのファイルがあるフォルダに設定されます。</p>
<div id="チャレンジ-5" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="チャレンジ-5" class="callout-inner">
<h3 class="callout-title">チャレンジ 5</h3>
<div class="callout-content">
<p><code>getwd()</code> コマンドを使用するか、RStudio
のメニューを使って現在の作業ディレクトリを確認します。</p>
<ol style="list-style-type: decimal">
<li>コンソールで <code>getwd()</code>（“wd” は “working directory”
の略）と入力し、Enter を押します。</li>
<li>ファイルペインで、<code>data</code>
フォルダをダブルクリックして開く（または他の任意のフォルダに移動）。作業ディレクトリに戻るには、ファイルペインの「More」をクリックし、「Go
To Working Directory」を選択します。</li>
</ol>
<p><code>setwd()</code> コマンドを使用するか、RStudio
のメニューを使って作業ディレクトリを変更します。</p>
<ol style="list-style-type: decimal">
<li>コンソールで <code>setwd("data")</code> と入力し、Enter
を押します。その後、<code>getwd()</code> と入力して Enter
を押し、新しい作業ディレクトリを確認します。</li>
<li>RStudio ウィンドウ上部のメニューで「Session」をクリックし、「Set
Working Directory」を選択して「Choose
Directory」をクリックします。その後、開いたウィンドウでプロジェクトディレクトリに戻り、「Open」をクリックします。コンソールに
<code>setwd</code> コマンドが自動的に表示されます。</li>
</ol>
</div>
</div>
</div>
<div id="ヒント-ファイルが存在しないエラー" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント-ファイルが存在しないエラー" class="callout-inner">
<h3 class="callout-title">ヒント: ファイルが存在しないエラー</h3>
<div class="callout-content">
<p>R
コードでファイルを参照しようとして「ファイルが存在しない」というエラーが出た場合は、作業ディレクトリを確認するのが良いです。
ファイルへの絶対パスを指定するか、作業ディレクトリ内（またはそのサブフォルダ）にファイルを保存し、相対パスを指定する必要があります。</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="バージョン管理">バージョン管理<a class="anchor" aria-label="anchor" href="#%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86"></a>
</h3>
<p>プロジェクトではバージョン管理を使用することが重要です。<a href="https://swcarpentry.github.io/git-novice/14-supplemental-rstudio.html" class="external-link">RStudio
で Git
を使用する方法についての良いレッスンはこちら</a>を参照してください。</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>RStudio
を使用して一貫したレイアウトでプロジェクトを作成および管理する。</li>
<li>生データを読み取り専用として扱う。</li>
<li>生成された出力を使い捨てとみなす。</li>
<li>関数の定義と適用を分離する。</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-03-seeking-help"><p>Content from <a href="03-seeking-help.html">ヘルプの利用</a></p>
<hr>
<p>Last updated on 2024-11-21 |

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/episodes/03-seeking-help.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>R でどのようにしてヘルプを得ることができますか？</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>関数や特殊な演算子に関する R
のヘルプファイルを読むことができる。</li>
<li>問題を解決するためのパッケージを特定するために CRAN
タスクビューを利用できる。</li>
<li>仲間に助けを求める方法を理解する。</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="ヘルプファイルを読む">ヘルプファイルを読む<a class="anchor" aria-label="anchor" href="#%E3%83%98%E3%83%AB%E3%83%97%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E8%AA%AD%E3%82%80"></a>
</h2>
<hr class="half-width">
<p>R
および各パッケージには関数用のヘルプファイルが用意されています。特定のパッケージに含まれる関数についてヘルプを検索する際の一般的な構文は次の通りです：</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">function_name</span></span>
<span><span class="fu">help</span><span class="op">(</span><span class="va">function_name</span><span class="op">)</span></span></code></pre>
</div>
<p>たとえば、<code>write.table()</code>
のヘルプファイルを見てみましょう。この関数に似た機能を持つ関数を今後のエピソードで使用します。</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="fu">write.table</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>これにより、RStudio ではヘルプページが表示され、R
本体ではプレーンテキストとして表示されます。</p>
<p>各ヘルプページは次のようなセクションに分かれています：</p>
<ul>
<li>
<strong>Description（説明）</strong>:
関数が何をするかの詳細な説明。</li>
<li>
<strong>Usage（使用法）</strong>:
関数の引数とそのデフォルト値（変更可能）。</li>
<li>
<strong>Arguments（引数）</strong>:
各引数が期待するデータの説明。</li>
<li>
<strong>Details（詳細）</strong>: 注意すべき重要な点。</li>
<li>
<strong>Value（戻り値）</strong>: 関数が返すデータ。</li>
<li>
<strong>See Also（関連項目）</strong>: 有用な関連関数。</li>
<li>
<strong>Examples（例）</strong>: 関数の使用例。</li>
</ul>
<p>関数によってはセクションが異なる場合がありますが、これらが主なポイントです。</p>
<p>関連する関数が同じヘルプファイルを参照する場合があることに注意してください：</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="fu">write.table</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">?</span><span class="fu">write.csv</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>これらの関数は非常に似た用途を持ち、引数も共通しているため、パッケージ作者が同じヘルプファイルで文書化していることがよくあります。</p>
<div id="ヒント-実例を実行する" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント-実例を実行する" class="callout-inner">
<h3 class="callout-title">ヒント: 実例を実行する</h3>
<div class="callout-content">
<p>ヘルプページ内の Examples セクションからコードをハイライトして
<kbd>Ctrl</kbd>+<kbd>Return</kbd> を押すと、RStudio
コンソールで実行されます。 関数の動作を素早く理解する方法です。</p>
</div>
</div>
</div>
<div id="ヒント-ヘルプファイルを読む" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント-ヘルプファイルを読む" class="callout-inner">
<h3 class="callout-title">ヒント: ヘルプファイルを読む</h3>
<div class="callout-content">
<p>R の大きな課題の一つは、利用可能な関数の数が膨大であることです。
すべての関数の正しい使用法を記憶するのは現実的ではありません。
しかし、ヘルプファイルを利用すれば、記憶する必要はありません！</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="特殊な演算子">特殊な演算子<a class="anchor" aria-label="anchor" href="#%E7%89%B9%E6%AE%8A%E3%81%AA%E6%BC%94%E7%AE%97%E5%AD%90"></a>
</h2>
<hr class="half-width">
<p>特殊な演算子に関するヘルプを検索するには、引用符またはバッククォートを使用します：</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="st">"&lt;-"</span></span>
<span><span class="op">?</span><span class="va">`&lt;-`</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="パッケージに関するヘルプ">パッケージに関するヘルプ<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E3%83%98%E3%83%AB%E3%83%97"></a>
</h2>
<hr class="half-width">
<p>多くのパッケージには「ビネット」と呼ばれるチュートリアルや拡張的な例のドキュメントが含まれています。
引数なしで <code>vignette()</code>
を実行すると、インストール済みのすべてのパッケージのビネットが表示されます。
特定のパッケージについては <code>vignette(package="パッケージ名")</code>
を使用します。 特定のビネットを開くには
<code>vignette("ビネット名")</code> を実行します。</p>
<p>パッケージにビネットがない場合は、通常、次のコマンドでヘルプを探せます：</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">help</span><span class="op">(</span><span class="st">"パッケージ名"</span><span class="op">)</span></span></code></pre>
</div>
<p>また、RStudio には多くのパッケージ向けに優れた <a href="https://rstudio.com/resources/cheatsheets/" class="external-link">チートシート</a>
があります。</p>
</section><section><h2 class="section-heading" id="関数名の一部を覚えている場合">関数名の一部を覚えている場合<a class="anchor" aria-label="anchor" href="#%E9%96%A2%E6%95%B0%E5%90%8D%E3%81%AE%E4%B8%80%E9%83%A8%E3%82%92%E8%A6%9A%E3%81%88%E3%81%A6%E3%81%84%E3%82%8B%E5%A0%B4%E5%90%88"></a>
</h2>
<hr class="half-width">
<p>関数がどのパッケージに属しているか、または正確なスペルがわからない場合、ファジー検索が可能です：</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="op">?</span><span class="va">function_name</span></span></code></pre>
</div>
<p>ファジー検索では文字列の近似一致を検索します。たとえば、作業ディレクトリを設定する関数に「set」が含まれていることを覚えている場合、次のように検索できます：</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="op">?</span><span class="va">set</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="どこから始めるべきかわからない場合">どこから始めるべきかわからない場合<a class="anchor" aria-label="anchor" href="#%E3%81%A9%E3%81%93%E3%81%8B%E3%82%89%E5%A7%8B%E3%82%81%E3%82%8B%E3%81%B9%E3%81%8D%E3%81%8B%E3%82%8F%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88"></a>
</h2>
<hr class="half-width">
<p>どの関数やパッケージを使用すべきかわからない場合、 <a href="https://cran.at.r-project.org/web/views" class="external-link">CRAN Task Views</a>
を利用するとよいでしょう。
これは、パッケージを分野別にグループ化した特別なリストで、出発点として適しています。</p>
</section><section><h2 class="section-heading" id="コードが動作しない場合-仲間に助けを求める">コードが動作しない場合: 仲間に助けを求める<a class="anchor" aria-label="anchor" href="#%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8C%E5%8B%95%E4%BD%9C%E3%81%97%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88-%E4%BB%B2%E9%96%93%E3%81%AB%E5%8A%A9%E3%81%91%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>関数の使用に問題がある場合、その答えのほとんどはすでに <a href="https://stackoverflow.com/" class="external-link">Stack Overflow</a>
で回答されています。 <code>[r]</code>
タグを使って検索してください。質問の仕方については、Stack Overflow の <a href="https://stackoverflow.com/help/how-to-ask" class="external-link">良い質問の仕方</a>のページを参照してください。</p>
<p>答えが見つからない場合、以下の便利な関数を使って仲間に助けを求めるとよいでしょう：</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">dput</span></span></code></pre>
</div>
<p>この関数は、使用しているデータを他の人が自分の R
セッションでコピー＆ペーストできる形式に出力します。</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessionInfo</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>R version 4.4.2 (2024-10-31)
Platform: x86_64-pc-linux-gnu
Running under: Ubuntu 22.04.5 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.0
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0

locale:
 [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8
 [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8
 [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C
[10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C

time zone: UTC
tzcode source: system (glibc)

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] compiler_4.4.2 tools_4.4.2    yaml_2.3.10    knitr_1.48     xfun_0.49
[6] renv_1.0.11    evaluate_1.0.1</code></pre>
</div>
<p>この関数は、R
の現在のバージョンやロードしているパッケージを表示します。
これは他の人が問題を再現し、デバッグするのに役立ちます。</p>
<div id="チャレンジ-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-1" class="callout-inner">
<h3 class="callout-title">チャレンジ 1</h3>
<div class="callout-content">
<p><code>c</code>
関数のヘルプページを見てください。次のコードを評価した場合、どのようなベクトルが作成されると思いますか？</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">c</span><span class="op">(</span><span class="st">'d'</span>, <span class="st">'e'</span>, <span class="st">'f'</span><span class="op">)</span></span>
<span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="st">'f'</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ 1 の解答
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p><code>c()</code>
関数はすべての要素が同じ型のベクトルを作成します。最初の場合、要素は数値型、
2 番目の場合は文字型、そして 3
番目の場合も文字型です。数値型の値は文字型に「強制変換」されます。</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-2" class="callout-inner">
<h3 class="callout-title">チャレンジ 2</h3>
<div class="callout-content">
<p><code>paste</code>
関数のヘルプを見てください。この関数を後ほど使用します。
<code>sep</code> 引数と <code>collapse</code> 引数の違いは何ですか？</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  チャレンジ 2 の解答
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p><code>paste()</code> 関数のヘルプを見るには以下を実行します：</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">help</span><span class="op">(</span><span class="st">"paste"</span><span class="op">)</span></span>
<span><span class="op">?</span><span class="va">paste</span></span></code></pre>
</div>
<p><code>sep</code> と <code>collapse</code>
の違いは少し複雑です。<code>paste</code>
関数は任意の数の引数を受け取り、それぞれが任意の長さのベクトルであることができます。
<code>sep</code>
引数は連結される各項目の間に使用される文字列を指定します（デフォルトはスペース）。
結果は、<code>paste</code>
に渡された最も長い引数と同じ長さのベクトルです。
一方、<code>collapse</code>
引数は、連結後の要素を指定された区切り文字を使用して「まとめて結合」することを示します。
その結果、単一の文字列になります。</p>
<p>引数を明示的に指定することが重要です。たとえば <code>sep = ","</code>
と入力すると、関数は区切り文字として “,”
を使用し、結合する項目としてではないと認識します。</p>
<p>例：</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span><span class="op">)</span>, <span class="st">"c"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a c" "b c"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span><span class="op">)</span>, <span class="st">"c"</span>, <span class="st">","</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a c ," "b c ,"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span><span class="op">)</span>, <span class="st">"c"</span>, sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a,c" "b,c"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span><span class="op">)</span>, <span class="st">"c"</span>, collapse <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a c|b c"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span><span class="op">)</span>, <span class="st">"c"</span>, sep <span class="op">=</span> <span class="st">","</span>, collapse <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a,c|b,c"</code></pre>
</div>
<p>（詳細については、<code>?paste</code>
ヘルプページの末尾の例を参照するか、<code>example('paste')</code>
を試してください。）</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-3" class="callout-inner">
<h3 class="callout-title">チャレンジ 3</h3>
<div class="callout-content">
<p>ヘルプを使用して、タブ区切り（<code>\t</code>）の列と小数点が
“.”（ピリオド）で表される表形式のファイルを読み込むために使用できる関数（および関連するパラメータ）を見つけてください。
特に国際的な同僚と協力している場合、小数点の表記（例：コンマ対ピリオド）は異なる場合があるため、この確認が重要です。
ヒント：<code>??"read table"</code>
を使用して表形式データの読み込みに関連する関数を調べてください。</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  チャレンジ 3 の解答
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>タブ区切りファイルを小数点がピリオドで表される形式で読み込む標準的な
R 関数は <code>read.delim()</code> です。
また、<code>read.table(file, sep="\t")</code>
を使用することもできます（<code>read.table()</code>
のデフォルトの小数点はピリオドです）。
ただし、データファイルにハッシュ（#）文字が含まれている場合は、<code>comment.char</code>
引数を変更する必要があるかもしれません。</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="その他のリソース">その他のリソース<a class="anchor" aria-label="anchor" href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9"></a>
</h2>
<hr class="half-width">
<ul>
<li><a href="https://www.statmethods.net/" class="external-link">Quick R</a></li>
<li><a href="https://www.rstudio.com/resources/cheatsheets/" class="external-link">RStudio
チートシート</a></li>
<li><a href="https://www.cookbook-r.com/" class="external-link">Cookbook for R</a></li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>R のオンラインヘルプを取得するには <code>help()</code>
を使用します。</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-04-data-structures-part1"><p>Content from <a href="04-data-structures-part1.html">データ構造</a></p>
<hr>
<p>Last updated on 2024-11-21 |

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/episodes/04-data-structures-part1.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 55 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>R でデータをどのように読み取ることができますか？</li>
<li>R の基本的なデータ型は何ですか？</li>
<li>R でカテゴリ情報をどのように表現しますか？</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>5 つの主なデータ型を特定できるようになる。</li>
<li>データフレームを探索し始め、ベクトルやリストとの関連を理解する。</li>
<li>R
からオブジェクトの型、クラス、構造に関する質問ができるようになる。</li>
<li>“names”、“class”、“dim” 属性の情報を理解する。</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>R の最も強力な機能の 1 つは、スプレッドシートや CSV
ファイルにすでに保存されているような表形式データを処理する能力です。まずは、<code>data/</code>
ディレクトリに <code>feline-data.csv</code>
という名前の小さなデータセットを作成しましょう：</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>coat <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"calico"</span>, <span class="st">"black"</span>, <span class="st">"tabby"</span><span class="op">)</span>,</span>
<span>                    weight <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2.1</span>, <span class="fl">5.0</span>, <span class="fl">3.2</span><span class="op">)</span>,</span>
<span>                    likes_catnip <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>次に、<code>cats</code> を CSV
ファイルとして保存します。引数名を明示的に指定することは良い習慣であり、関数が変更されたデフォルト値を認識できます。この場合は
<code>row.names = FALSE</code>
を設定しています。引数名やそのデフォルト値を確認するには、<code>?write.csv</code>
を使用してヘルプファイルを表示してください。</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write.csv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cats</span>, file <span class="op">=</span> <span class="st">"data/feline-data.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</div>
<p>新しいファイル <code>feline-data.csv</code>
の内容は次の通りです：</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>coat,weight,likes_catnip</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>calico,<span class="fl">2.1</span>,<span class="dv">1</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>black,<span class="fl">5.0</span>,<span class="dv">0</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>tabby,<span class="fl">3.2</span>,<span class="dv">1</span></span></code></pre>
</div>
<div id="ヒント-r-でテキストファイルを編集する" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント-r-でテキストファイルを編集する" class="callout-inner">
<h3 class="callout-title">ヒント: R でテキストファイルを編集する</h3>
<div class="callout-content">
<p>または、テキストエディタ（Nano）や RStudio の <strong>File -&gt; New
File -&gt; Text File</strong> メニュー項目を使用して
<code>data/feline-data.csv</code> を作成することもできます。</p>
</div>
</div>
</div>
<p>このデータを R に読み込むには、以下のコマンドを使用します：</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/feline-data.csv"</span><span class="op">)</span></span>
<span><span class="va">cats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_catnip
1 calico    2.1            1
2  black    5.0            0
3  tabby    3.2            1</code></pre>
</div>
<p><code>read.table</code> 関数は、CSV ファイル（csv = comma-separated
values）などのテキストファイルに保存された表形式データを読み取るために使用されます。タブやカンマは、CSV
ファイルでデータポイントを区切るために最も一般的に使用される記号です。R
では <code>read.table</code> の便利なバージョンとして
<code>read.csv</code>（データがカンマで区切られている場合）と
<code>read.delim</code>（データがタブで区切られている場合）が用意されています。この
3 つの中で、<code>read.csv</code>
が最も一般的に使用されます。必要に応じて、デフォルトの区切り記号を変更することもできます。</p>
<div id="データが因子かどうかを確認する" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="データが因子かどうかを確認する" class="callout-inner">
<h3 class="callout-title">データが因子かどうかを確認する</h3>
<div class="callout-content">
<p>最近、R がテキストデータを処理する方法が変更されました。以前は、R
はテキストデータを自動的に “因子” という形式に変換していましたが、現在は
“文字列”
という形式で処理されるようになりました。因子の使用用途については後ほど学びますが、ほとんどの場合は必要なく、使用することで複雑になるだけです。そのため、新しい
R バージョンではテキストデータが “文字列”
として読み取られます。因子が自動的に作成されているかを確認し、必要に応じて文字列形式に変換してください：</p>
<ol style="list-style-type: decimal">
<li>入力データの型を確認するには、<code>str(cats)</code>
を入力します。</li>
<li>出力で、コロンの後にある 3
文字のコードを確認します：<code>num</code> と <code>chr</code>
のみが表示される場合は、レッスンを続けることができます。このボックスはスキップしてください。<code>fct</code>
が見つかった場合は、次の手順に進んでください。</li>
<li>R
が因子データを自動的に作成しないようにするには、以下のコードを実行します：<code>options(stringsAsFactors = FALSE)</code>。その後、<code>cats</code>
テーブルを再読み込みして変更を反映させます。</li>
<li>R
を再起動するたびに、このオプションを設定する必要があります。忘れないように、データを読み込む前にスクリプトの最初の行のいずれかに含めてください。</li>
<li>R バージョン 4.0.0
以降では、テキストデータは因子に変換されなくなりました。問題を回避するためにこのバージョン以降をインストールすることを検討してください。研究所や会社のコンピュータを使用している場合は、管理者に依頼してください。</li>
</ol>
</div>
</div>
</div>
<p>データセットをすぐに探索し始めることができます。たとえば、<code>$</code>
演算子を使用して列を指定します：</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2.1 5.0 3.2</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">coat</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "calico" "black"  "tabby" </code></pre>
</div>
<p>列に対して操作を実行することもできます：</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## たとえば、スケールが 2kg 軽いことが判明した場合：</span></span>
<span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span> <span class="op">+</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4.1 7.0 5.2</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="st">"My cat is"</span>, <span class="va">cats</span><span class="op">$</span><span class="va">coat</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "My cat is calico" "My cat is black"  "My cat is tabby" </code></pre>
</div>
<p>しかし、次のコードではどうでしょうか？</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span> <span class="op">+</span> <span class="va">cats</span><span class="op">$</span><span class="va">coat</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in cats$weight + cats$coat: non-numeric argument to binary operator</code></pre>
</div>
<p>ここで何が起こったのかを理解することが、R
でデータを成功裏に分析する鍵です。</p>
<div class="section level3">
<h3 id="データ型">データ型<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E5%9E%8B"></a>
</h3>
<p>最後のコマンドがエラーを返す理由が <code>2.1</code> と
<code>"black"</code>
を加算するのは無意味だからだと推測したなら、あなたは正しいです！これはプログラミングにおける重要な概念である
<em>データ型</em>
に関する直感をすでに持っているということです。データの型を調べるには、次のように入力します：</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "double"</code></pre>
</div>
<p>主なデータ型は次の 5
種類です：<code>double</code>、<code>integer</code>、<code>complex</code>、<code>logical</code>、<code>character</code>。
歴史的な理由で、<code>double</code> は <code>numeric</code>
とも呼ばれます。</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="fl">3.14</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "double"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span> <span class="co"># L サフィックスを付けると数値を整数に強制します（R はデフォルトで浮動小数点数を使用）</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "integer"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fl">1i</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "complex"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "logical"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="st">'banana'</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "character"</code></pre>
</div>
<p>分析がどれだけ複雑であっても、R
ではすべてのデータがこれらの基本的なデータ型のいずれかとして解釈されます。この厳格さには非常に重要な意味があります。</p>
<p>別の猫の詳細を追加した情報が、ファイル
<code>data/feline-data_v2.csv</code> に保存されています。</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">file.show</span><span class="op">(</span><span class="st">"data/feline-data_v2.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>coat,weight,likes_catnip</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>calico,<span class="fl">2.1</span>,<span class="dv">1</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>black,<span class="fl">5.0</span>,<span class="dv">0</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>tabby,<span class="fl">3.2</span>,<span class="dv">1</span></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>tabby,<span class="fl">2.3</span> or <span class="fl">2.4</span>,<span class="dv">1</span></span></code></pre>
</div>
<p>この新しい猫データを以前と同じ方法で読み込み、<code>weight</code>
列にどのようなデータ型が含まれているか確認します：</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span>file<span class="op">=</span><span class="st">"data/feline-data_v2.csv"</span><span class="op">)</span></span>
<span><span class="fu">typeof</span><span class="op">(</span><span class="va">cats</span></span>
<span></span>
<span><span class="op">$</span><span class="va">weight</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "character"</code></pre>
</div>
<p>あらら、<code>weight</code> 列の型が <code>double</code>
ではなくなっています！以前と同じ計算を試みると、問題が発生します：</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span> <span class="op">+</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in cats$weight + 2: non-numeric argument to binary operator</code></pre>
</div>
<p>何が起こったのでしょうか？ 私たちが扱っている <code>cats</code>
データは <em>データフレーム</em> と呼ばれるものです。データフレームは、R
で最も一般的で多用途な <em>データ構造</em> の 1 つです。
データフレームの特定の列には異なるデータ型を混在させることはできません。
この場合、R はデータフレーム列 <code>weight</code> のすべてを
<em>double</em>
として読み取らなかったため、列全体のデータ型がその列内のすべてに適した型に変わります。</p>
<p>R が CSV ファイルを読み取ると、それは <em>データフレーム</em>
として読み込まれます。そのため、<code>cats</code> CSV
ファイルを読み込むと、データフレームとして保存されます。データフレームは
<code>str()</code> 関数によって表示される最初の行で認識できます：</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	4 obs. of  3 variables:
 $ coat        : chr  "calico" "black" "tabby" "tabby"
 $ weight      : chr  "2.1" "5" "3.2" "2.3 or 2.4"
 $ likes_string: int  1 0 1 1</code></pre>
</div>
<p><em>データフレーム</em>
は行と列で構成され、各列は同じ数の行を持ちます。データフレームの異なる列は異なるデータ型で構成できます（これがデータフレームを非常に柔軟にする理由です）が、特定の列内ではすべてが同じ型である必要があります（例：ベクトル、因子、リストなど）。</p>
<p>この振る舞いをさらに調査する間、猫のデータから余分な行を削除し、それを再読み込みしましょう：</p>
<p>feline-data.csv:</p>
<pre><code>coat,weight,likes_catnip
calico,2.1,1
black,5.0,0
tabby,3.2,1</code></pre>
<p>そして RStudio 内で：</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span>file<span class="op">=</span><span class="st">"data/feline-data.csv"</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="ベクトルと型の強制変換">ベクトルと型の強制変換<a class="anchor" aria-label="anchor" href="#%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB%E3%81%A8%E5%9E%8B%E3%81%AE%E5%BC%B7%E5%88%B6%E5%A4%89%E6%8F%9B"></a>
</h3>
<p>この挙動をよりよく理解するために、別のデータ構造である
<em>ベクトル</em> を紹介します。</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_vector</span> <span class="op">&lt;-</span> <span class="fu">vector</span><span class="op">(</span>length <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">my_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE FALSE FALSE</code></pre>
</div>
<p>R
におけるベクトルは、基本的に順序付けられた要素のリストです。ただし、特別な条件として、<em>ベクトル内のすべての要素は同じ基本データ型である必要があります</em>。データ型を指定しない場合、デフォルトで
<code>logical</code>
型になります。また、任意の型の空のベクトルを宣言することも可能です。</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">another_vector</span> <span class="op">&lt;-</span> <span class="fu">vector</span><span class="op">(</span>mode<span class="op">=</span><span class="st">'character'</span>, length<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">another_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "" "" ""</code></pre>
</div>
<p>あるオブジェクトがベクトルかどうかを確認することもできます：</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">another_vector</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:3] "" "" ""</code></pre>
</div>
<p>このコマンドのやや難解な出力は、このベクトルに含まれる基本データ型（この場合は
<code>chr</code>、文字型）を示し、ベクトル内の要素数（この場合は
<code>[1:3]</code>）、および実際に含まれる要素（この場合は空の文字列）を示します。同様に次のコマンドを実行すると、</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> num [1:3] 2.1 5 3.2</code></pre>
</div>
<p><code>cats$weight</code> もベクトルであることがわかります。<em>R
のデータフレームに読み込まれる列はすべてベクトルです</em>。これが、R
が列内のすべての要素を同じ基本データ型に強制する理由の根本です。</p>
<div id="討論-1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="討論-1" class="callout-inner">
<h3 class="callout-title">討論 1</h3>
<div class="callout-content">
<p>なぜ R は列に含まれるデータに対してこれほど厳格なのでしょうか？
この厳格さは私たちにどのように役立つのでしょうか？</p>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  討論 1 の解答
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>列内のすべてのデータが同じであることで、データに対して単純な仮定を行うことができます。たとえば、列の
1
つの要素を数値として解釈できるなら、列内の<em>すべて</em>の要素を数値として解釈できます。そのため、毎回確認する必要がなくなります。この一貫性こそが、人々が「クリーンデータ」と呼ぶものです。長い目で見ると、この厳格な一貫性は
R におけるデータ操作を非常に簡単にしてくれます。</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="ベクトルを結合する際の型の強制変換">ベクトルを結合する際の型の強制変換<a class="anchor" aria-label="anchor" href="#%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB%E3%82%92%E7%B5%90%E5%90%88%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AE%E5%9E%8B%E3%81%AE%E5%BC%B7%E5%88%B6%E5%A4%89%E6%8F%9B"></a>
</h4>
<p>明示的な内容を持つベクトルを <code>c()</code>
関数で作成できます：</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combine_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">combine_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2 6 3</code></pre>
</div>
<p>これまで学んだ内容を考えると、次のコードは何を生成すると思いますか？</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quiz_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>,<span class="fl">6</span>,<span class="st">'3'</span><span class="op">)</span></span></code></pre>
</div>
<p>これは <em>型の強制変換</em>
と呼ばれるもので、予想外の結果をもたらすことがあり、基本データ型と R
がそれをどのように解釈するかを理解する必要があります。R
は、異なる型（ここでは <code>double</code> と
<code>character</code>）が単一のベクトルに結合される場合、それらをすべて同じ型に強制します。例を見てみましょう：</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coercion_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">coercion_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a"    "TRUE"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">another_coercion_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">another_coercion_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0 1</code></pre>
</div>
</div>
<div class="section level4">
<h4 id="型の階層">型の階層<a class="anchor" aria-label="anchor" href="#%E5%9E%8B%E3%81%AE%E9%9A%8E%E5%B1%A4"></a>
</h4>
<p>型の強制変換ルールは次の通りです：<br><code>logical</code> -&gt; <code>integer</code> -&gt;
<code>double</code> (“<code>numeric</code>”) -&gt; <code>complex</code>
-&gt; <code>character</code><br>
この矢印は「<em>変換される</em>」と読めます。たとえば、<code>logical</code>
と <code>character</code> を結合すると、結果は <code>character</code>
に変換されます：</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a"    "TRUE"</code></pre>
</div>
<p><code>character</code>
ベクトルは、印刷時にクォートで囲まれていることで簡単に認識できます。</p>
<p>逆方向の強制変換を試みる場合は、<code>as.</code>
関数を使用します：</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">character_vector_example</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'0'</span>,<span class="st">'2'</span>,<span class="st">'4'</span><span class="op">)</span></span>
<span><span class="va">character_vector_example</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "0" "2" "4"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">character_coerced_to_double</span> <span class="op">&lt;-</span> <span class="fu">as.double</span><span class="op">(</span><span class="va">character_vector_example</span><span class="op">)</span></span>
<span><span class="va">character_coerced_to_double</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0 2 4</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">double_coerced_to_logical</span> <span class="op">&lt;-</span> <span class="fu">as.logical</span><span class="op">(</span><span class="va">character_coerced_to_double</span><span class="op">)</span></span>
<span><span class="va">double_coerced_to_logical</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE  TRUE  TRUE</code></pre>
</div>
<p>R
が基本データ型を他の型に強制する際に驚くべきことが起こる場合があります！型の強制変換の細かい点はさておき、重要なのは：データが予想していた形式と異なる場合、それは型の強制変換が原因である可能性が高いです。ベクトルやデータフレームの列内のすべてのデータが同じ型であることを確認してください。さもなければ、予想外の問題が発生する可能性があります！</p>
<p>しかし、強制変換は非常に便利な場合もあります！たとえば、<code>cats</code>
データの <code>likes_catnip</code> 列は数値型ですが、実際には 1 と 0
がそれぞれ <code>TRUE</code> と <code>FALSE</code>
を表しています。このデータには <code>logical</code>
型を使用すべきです。この型は <code>TRUE</code> または <code>FALSE</code>
の 2 状態を持ち、データの意味に完全に一致します。この列を
<code>logical</code> に「強制変換」するには、<code>as.logical</code>
関数を使用します：</p>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">likes_catnip</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 0 1</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">likes_catnip</span> <span class="op">&lt;-</span> <span class="fu">as.logical</span><span class="op">(</span><span class="va">cats</span><span class="op">$</span><span class="va">likes_catnip</span><span class="op">)</span></span>
<span><span class="va">cats</span><span class="op">$</span><span class="va">likes_catnip</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  TRUE FALSE  TRUE</code></pre>
</div>
<div id="チャレンジ-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-1" class="callout-inner">
<h3 class="callout-title">チャレンジ 1</h3>
<div class="callout-content">
<p>データ分析の重要な部分は、入力データのクリーンアップです。入力データがすべて同じ形式（例：数値）であることを知っていると、分析がはるかに簡単になります！型の強制変換に関する章で扱った猫のデータセットをクリーンアップしましょう。</p>
<div class="section level4">
<h4 id="コードテンプレートをコピー">コードテンプレートをコピー<a class="anchor" aria-label="anchor" href="#%E3%82%B3%E3%83%BC%E3%83%89%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E3%82%B3%E3%83%94%E3%83%BC"></a>
</h4>
<p>RStudio
で新しいスクリプトを作成し、以下のコードをコピー＆ペーストしてください。その後、以下のタスクを参考にギャップ（______）を埋めてください。</p>
<pre><code># データを読み込み
cats &lt;- read.csv("data/feline-data_v2.csv")

# 1. データを表示
_____

# 2. 表の概要をデータ型と共に表示
_____(cats)

# 3. "weight" 列の現在のデータ型 __________。
#    正しいデータ型は： ____________。

# 4. 4 番目の "weight" データポイントを指定された 2 つの値の平均に修正
cats$weight[4] &lt;- 2.35
#    効果を確認するためにデータを再表示
cats

# 5. "weight" を正しいデータ型に変換
cats$weight &lt;- ______________(cats$weight)

#    自分でテストするために平均を計算
mean(cats$weight)

# 正しい平均値（NA ではない）が表示されたら、演習は完了です！</code></pre>
</div>
<div class="section level3">
<h3 id="タスクの手順">タスクの手順<a class="anchor" aria-label="anchor" href="#%E3%82%BF%E3%82%B9%E3%82%AF%E3%81%AE%E6%89%8B%E9%A0%86"></a>
</h3>
<div class="section level4">
<h4 id="データを表示する">1. データを表示する<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B"></a>
</h4>
<p>最初のステートメント（<code>read.csv(...)</code>）を実行します。その後、データをコンソールに表示します。</p>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  ヒント 1.1
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>任意の変数の内容を表示するには、その名前を入力します。</p>
<div class="section level3">
<h3 id="チャレンジ-1-1-の解答">チャレンジ 1.1 の解答<a class="anchor" aria-label="anchor" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-1-1-%E3%81%AE%E8%A7%A3%E7%AD%94"></a>
</h3>
<p>2 つの正しい解答：</p>
<div class="codewrapper sourceCode" id="cb66">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_catnip
1 calico    2.1         TRUE
2  black    5.0        FALSE
3  tabby    3.2         TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb68">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">print</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_catnip
1 calico    2.1         TRUE
2  black    5.0        FALSE
3  tabby    3.2         TRUE</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="データ型の概要を表示する" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="データ型の概要を表示する" class="callout-inner">
<h3 class="callout-title">2. データ型の概要を表示する</h3>
<div class="callout-content">
<p>データ型はデータ自体と同じくらい重要です。以前見た関数を使用して、<code>cats</code>
テーブルのすべての列のデータ型を表示します。</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  ヒント 1.2
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>「データ型」の章で、データ型を表示する 2 つの関数を見ました。1
つはデータ型の名前だけを出力し、もう 1
つは短い形式のデータ型と最初の値を出力しました。ここでは後者を使用します。</p>
<div class="section level3">
<h3 id="チャレンジ-1-2-の解答">チャレンジ 1.2 の解答<a class="anchor" aria-label="anchor" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-1-2-%E3%81%AE%E8%A7%A3%E7%AD%94"></a>
</h3>
<div class="codewrapper sourceCode" id="cb70">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	3 obs. of  3 variables:
 $ coat        : chr  "calico" "black" "tabby"
 $ weight      : num  2.1 5 3.2
 $ likes_catnip: logi  TRUE FALSE TRUE</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="必要" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="必要" class="callout-inner">
<h3 class="callout-title">3. 必要</h3>
<div class="callout-content">
<p>なデータ型はどれですか？</p>
<p>表示されるデータ型は、このデータ（猫の体重）には適していません。必要なデータ型はどれですか？</p>
<ul>
<li>なぜ <code>read.csv()</code>
関数は正しいデータ型を選ばなかったのでしょうか？</li>
<li>コメントのギャップに猫の体重に適したデータ型を埋めてください！</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  ヒント 1.3
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p><a href="#the-type-hierarchy">型の階層</a>
のセクションに戻り、利用可能なデータ型を確認してください。</p>
<div class="section level3">
<h3 id="チャレンジ-1-3-の解答">チャレンジ 1.3 の解答<a class="anchor" aria-label="anchor" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-1-3-%E3%81%AE%E8%A7%A3%E7%AD%94"></a>
</h3>
<ul>
<li>体重は連続スケール（実数）で表されます。この場合の R のデータ型は
“double”（“numeric” とも呼ばれます）です。</li>
<li>4 行目の値は “2.3 or 2.4”
であり、数値ではなく英単語が含まれています。そのため、“character”
型が選ばれます。同じ列内のすべての値が同じデータ型である必要があるため、列全体がテキスト型になっています。</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="問題のある値を修正する" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="問題のある値を修正する" class="callout-inner">
<h3 class="callout-title">4. 問題のある値を修正する</h3>
<div class="callout-content">
<p>問題のある 4
行目に新しい体重値を割り当てるコードが提供されています。実行する前に考えてみてください。この例のように数値を割り当てた後のデータ型はどうなりますか？
実行後にデータ型を確認して、自分の予測が正しいか確認してください。</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  ヒント 1.4
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>2
つの異なるデータ型が組み合わされた場合の型の階層を再確認してください。</p>
<div class="section level3">
<h3 id="チャレンジ-1-4-の解答">チャレンジ 1.4 の解答<a class="anchor" aria-label="anchor" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-1-4-%E3%81%AE%E8%A7%A3%E7%AD%94"></a>
</h3>
<p>列 “weight” のデータ型は “character” です。割り当てるデータ型は
“double”
です。異なるデータ型を組み合わせると、次の階層でより高いデータ型に変換されます：</p>
<pre><code>logical &lt; integer &lt; double &lt; complex &lt; character</code></pre>
<p>したがって、列はまだ “character” 型です！これを “double”
型に手動で変換する必要があります。</p>
</div>
</div>
</div>
</div>
</div>
<div id="列-weight-を正しいデータ型に変換する" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="列-weight-を正しいデータ型に変換する" class="callout-inner">
<h3 class="callout-title">5. 列 “weight” を正しいデータ型に変換する</h3>
<div class="callout-content">
<p>猫の体重は数値です。しかし、列にはまだ適切なデータ型が設定されていません。この列を浮動小数点数に強制変換してください。</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">
  ヒント 1.5
  </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<p>データ型を変換する関数は <code>as.</code>
で始まります。このスクリプトの上部で関数を確認するか、RStudio
のオートコンプリート機能を使用してください。 “<code>as.</code>”
と入力し、TAB キーを押します。</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ-1.5-の解答" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="チャレンジ-1.5-の解答" class="callout-inner">
<h3 class="callout-title">チャレンジ 1.5 の解答</h3>
<div class="callout-content">
<p>歴史的な理由で、2 つの同義の関数があります：</p>
<div class="codewrapper sourceCode" id="cb73">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fu">as.double</span><span class="op">(</span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span></span>
<span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="基本的なベクトル関数">基本的なベクトル関数<a class="anchor" aria-label="anchor" href="#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB%E9%96%A2%E6%95%B0"></a>
</h3>
<p><code>c()</code>
関数を使用すると、既存のベクトルに新しい要素を追加することができます：</p>
<div class="codewrapper sourceCode" id="cb74">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ab_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span><span class="op">)</span></span>
<span><span class="va">ab_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a" "b"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb76">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combine_example</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">ab_vector</span>, <span class="st">'SWC'</span><span class="op">)</span></span>
<span><span class="va">combine_example</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a"   "b"   "SWC"</code></pre>
</div>
<p>また、数列を生成することも可能です：</p>
<div class="codewrapper sourceCode" id="cb78">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mySeries</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">mySeries</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb80">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">seq</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb82">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">seq</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, by<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  1.0  1.1  1.2  1.3  1.4  1.5  1.6  1.7  1.8  1.9  2.0  2.1  2.2  2.3  2.4
[16]  2.5  2.6  2.7  2.8  2.9  3.0  3.1  3.2  3.3  3.4  3.5  3.6  3.7  3.8  3.9
[31]  4.0  4.1  4.2  4.3  4.4  4.5  4.6  4.7  4.8  4.9  5.0  5.1  5.2  5.3  5.4
[46]  5.5  5.6  5.7  5.8  5.9  6.0  6.1  6.2  6.3  6.4  6.5  6.6  6.7  6.8  6.9
[61]  7.0  7.1  7.2  7.3  7.4  7.5  7.6  7.7  7.8  7.9  8.0  8.1  8.2  8.3  8.4
[76]  8.5  8.6  8.7  8.8  8.9  9.0  9.1  9.2  9.3  9.4  9.5  9.6  9.7  9.8  9.9
[91] 10.0</code></pre>
</div>
<p>ベクトルについていくつかの質問をすることもできます：</p>
<div class="codewrapper sourceCode" id="cb84">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sequence_example</span> <span class="op">&lt;-</span> <span class="fl">20</span><span class="op">:</span><span class="fl">25</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">sequence_example</span>, n<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 20 21</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb86">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tail</span><span class="op">(</span><span class="va">sequence_example</span>, n<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 22 23 24 25</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb88">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">length</span><span class="op">(</span><span class="va">sequence_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 6</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb90">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">sequence_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "integer"</code></pre>
</div>
<p>ベクトルの特定の要素を取得するには、角括弧記法を使用します：</p>
<div class="codewrapper sourceCode" id="cb92">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_element</span> <span class="op">&lt;-</span> <span class="va">sequence_example</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">first_element</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 20</code></pre>
</div>
<p>特定の要素を変更するには、角括弧を矢印の右側に使用します：</p>
<div class="codewrapper sourceCode" id="cb94">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sequence_example</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">sequence_example</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 30 21 22 23 24 25</code></pre>
</div>
<div id="チャレンジ-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-2" class="callout-inner">
<h3 class="callout-title">チャレンジ 2</h3>
<div class="callout-content">
<p>1 から 26 までの数を含むベクトルを作成します。その後、このベクトルを
2 倍にします。</p>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7">
  チャレンジ 2 の解答
  </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" data-bs-parent="#accordionSolution7" aria-labelledby="headingSolution7">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb96">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">26</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="リスト">リスト<a class="anchor" aria-label="anchor" href="#%E3%83%AA%E3%82%B9%E3%83%88"></a>
</h3>
<p>次に紹介するデータ構造は <code>list</code>
です。リストは他のデータ型よりもシンプルで、<em>何でも入れることができる</em>のが特徴です。ベクトルでは要素の基本データ型を統一する必要がありましたが、リストは異なるデータ型を持つことができます：</p>
<div class="codewrapper sourceCode" id="cb97">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_example</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"a"</span>, <span class="cn">TRUE</span>, <span class="fl">1</span><span class="op">+</span><span class="fl">4i</span><span class="op">)</span></span>
<span><span class="va">list_example</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[1]]
[1] 1

[[2]]
[1] "a"

[[3]]
[1] TRUE

[[4]]
[1] 1+4i</code></pre>
</div>
<p><code>str()</code>
を使用してオブジェクトの構造を表示すると、すべての要素のデータ型を確認できます：</p>
<div class="codewrapper sourceCode" id="cb99">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">list_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>List of 4
 $ : num 1
 $ : chr "a"
 $ : logi TRUE
 $ : cplx 1+4i</code></pre>
</div>
<p>リストの用途は何でしょうか？例えば、異なるデータ型を持つ関連データを整理できます。これは、Excel
のスプレッドシートのように複数の表をまとめるのと似ています。他にも多くの用途があります。</p>
<p>次の章で、驚くかもしれない別の例を紹介します。</p>
<p>リストの特定の要素を取得するには <strong>二重角括弧</strong>
を使用します：</p>
<div class="codewrapper sourceCode" id="cb101">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_example</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a"</code></pre>
</div>
<p>リストの要素には <strong>名前</strong>
を付けることもできます。名前を値の前に等号で指定します：</p>
<div class="codewrapper sourceCode" id="cb103">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">another_list</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Numbers"</span>, numbers <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, data <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span>
<span><span class="va">another_list</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$title
[1] "Numbers"

$numbers
 [1]  1  2  3  4  5  6  7  8  9 10

$data
[1] TRUE</code></pre>
</div>
<p>これにより <strong>名前付きリスト</strong>
が生成されます。これで新しいアクセス方法が追加されます！</p>
<div class="codewrapper sourceCode" id="cb105">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">another_list</span><span class="op">$</span><span class="va">title</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Numbers"</code></pre>
</div>
</div>
<section><h2 class="section-heading" id="名前">名前<a class="anchor" aria-label="anchor" href="#%E5%90%8D%E5%89%8D"></a>
</h2>
<hr class="half-width">
<p>名前を使用すると、要素に意味を持たせることができます。これにより、データだけでなく説明情報も持つことができます。これはオブジェクトに貼り付けられるラベルのような
<em>メタデータ</em> です。R ではこれは <strong>属性</strong>
と呼ばれます。属性により、オブジェクトをさらに操作することが可能になります。ここでは、定義された名前で要素にアクセスすることができます。</p>
<div class="section level3">
<h3 id="名前を使用してベクトルやリストにアクセスする">名前を使用してベクトルやリストにアクセスする<a class="anchor" aria-label="anchor" href="#%E5%90%8D%E5%89%8D%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB%E3%82%84%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%99%E3%82%8B"></a>
</h3>
<p>名前付きリストの生成方法はすでに学びました。名前付きベクトルを生成する方法も非常に似ています。以前このような関数を見たことがあるはずです：</p>
<div class="codewrapper sourceCode" id="cb107">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pizza_price</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span> pizzasubito <span class="op">=</span> <span class="fl">5.64</span>, pizzafresh <span class="op">=</span> <span class="fl">6.60</span>, callapizza <span class="op">=</span> <span class="fl">4.50</span> <span class="op">)</span></span></code></pre>
</div>
<p>しかし、要素の取得方法はリストとは異なります：</p>
<div class="codewrapper sourceCode" id="cb108">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pizza_price</span><span class="op">[</span><span class="st">"pizzasubito"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">pizzasubito</span></span>
<span>       <span class="fl">5.64</span> </span></code></pre>
</div>
<p>リストのアプローチは機能しません：</p>
<div class="codewrapper sourceCode" id="cb110">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pizza_price</span><span class="op">$</span><span class="va">pizzafresh</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in pizza_price$pizzafresh: $ operator is invalid for atomic vectors</code></pre>
</div>
<p>このエラーメッセージを覚えておくと役立ちます。同じようなエラーに遭遇することが多いですが、これはリストと勘違いしてベクトルの要素にアクセスしようとした場合に発生します。</p>
</div>
<div class="section level3">
<h3 id="名前の取得と変更">名前の取得と変更<a class="anchor" aria-label="anchor" href="#%E5%90%8D%E5%89%8D%E3%81%AE%E5%8F%96%E5%BE%97%E3%81%A8%E5%A4%89%E6%9B%B4"></a>
</h3>
<p>名前だけに興味がある場合は、<code>names()</code>
関数を使用します：</p>
<div class="codewrapper sourceCode" id="cb112">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">pizza_price</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "pizzasubito" "pizzafresh"  "callapizza" </code></pre>
</div>
<p>ベクトルの要素にアクセスしたり変更したりする方法を学びました。同じことが名前についても可能です：</p>
<div class="codewrapper sourceCode" id="cb114">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">pizza_price</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "callapizza"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb116">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">pizza_price</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"call-a-pizza"</span></span>
<span><span class="va">pizza_price</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> pizzasubito   pizzafresh call-a-pizza
        5.64         6.60         4.50 </code></pre>
</div>
<div id="チャレンジ-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-3" class="callout-inner">
<h3 class="callout-title">チャレンジ 3</h3>
<div class="callout-content">
<ul>
<li>
<code>pizza_price</code>
の名前のデータ型は何ですか？<code>str()</code> または
<code>typeof()</code> 関数を使用して調べてください。</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8">
  チャレンジ 3 の解答
  </h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" data-bs-parent="#accordionSolution8" aria-labelledby="headingSolution8">
<div class="accordion-body">
<p>オブジェクトの名前を取得するには、その名前を <code>names(...)</code>
で囲みます。同様に、名前のデータ型を取得するには、全体をさらに
<code>typeof(...)</code> で囲みます：</p>
<pre><code><span><span class="fu">typeof</span><span class="op">(</span><span class="fu">names</span><span class="op">(</span><span class="va">pizza</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>または、コードをわかりやすくするために新しい変数を使用します：</p>
<pre><code><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu">names</span><span class="op">(</span><span class="va">pizza</span><span class="op">)</span></span>
<span><span class="fu">typeof</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="チャレンジ-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-4" class="callout-inner">
<h3 class="callout-title">チャレンジ 4</h3>
<div class="callout-content">
<p>既存のベクトルやリストの一部の名前を変更する代わりに、オブジェクトのすべての名前を設定することも可能です。次のコード形式を使用します（すべての大文字部分を置き換えてください）：</p>
<pre><code><span><span class="fu">names</span><span class="op">(</span> <span class="va">OBJECT</span> <span class="op">)</span> <span class="op">&lt;-</span>  <span class="va">CHARACTER_VECTOR</span></span></code></pre>
<p>アルファベットの各文字に番号を割り当てるベクトルを作成しましょう！</p>
<ol style="list-style-type: decimal">
<li>1 から 26 の数列を持つ <code>letter_no</code>
というベクトルを作成します。</li>
<li>R には <code>LETTERS</code>
という組み込みオブジェクトがあります。これは A から Z までの 26
文字を含むベクトルです。この 26 文字を <code>letter_no</code>
の名前として設定します。</li>
<li>
<code>letter_no["B"]</code> を呼び出して、値が 2
であることを確認してください！</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution9" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution9" aria-expanded="false" aria-controls="collapseSolution9">
  <h4 class="accordion-header" id="headingSolution9">
  チャレンジ 4 の解答
  </h4>
</button>
<div id="collapseSolution9" class="accordion-collapse collapse" data-bs-parent="#accordionSolution9" aria-labelledby="headingSolution9">
<div class="accordion-body">
<pre><code><span><span class="va">letter_no</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">26</span>   <span class="co"># or seq(1,26)</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">letter_no</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">LETTERS</span></span>
<span><span class="va">letter_no</span><span class="op">[</span><span class="st">"B"</span><span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="データフレーム">データフレーム<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0"></a>
</h2>
<hr class="half-width">
<p>このレッスンの冒頭でデータフレームについて簡単に触れましたが、それはデータの表形式を表しています。例として示した猫のデータフレームについては詳細に掘り下げていませんでした：</p>
<div class="codewrapper sourceCode" id="cb122">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_catnip
1 calico    2.1         TRUE
2  black    5.0        FALSE
3  tabby    3.2         TRUE</code></pre>
</div>
<p>ここで少し驚くべきことに気づくかもしれません。次のコマンドを実行してみましょう：</p>
<div class="codewrapper sourceCode" id="cb124">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "list"</code></pre>
</div>
<p>データフレームが「内部的にはリストのように見える」ことがわかります。以前、リストについて次のように説明しました：</p>
<blockquote>
<p>リストは異なる型のデータを整理するためのもの</p>
</blockquote>
<p>データフレームの列は、それぞれが異なる型のベクトルであり、同じ表に属することで整理されています。</p>
<p>データフレームは実際にはベクトルのリストです。データフレームが特別なのは、すべてのベクトルが同じ長さでなければならない点です。</p>
<p>この「特別さ」はどのようにオブジェクトに組み込まれているのでしょうか？R
がそれを単なるリストではなく、表として扱うのはなぜでしょう？</p>
<div class="codewrapper sourceCode" id="cb126">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "data.frame"</code></pre>
</div>
<p><strong>クラス</strong>
は名前と同様に、オブジェクトに付加される属性です。この属性は、そのオブジェクトが人間にとって何を意味するのかを示します。</p>
<p>ここで疑問に思うかもしれません：なぜオブジェクトの型を判断するための関数がもう一つ必要なのでしょうか？すでに
<code>typeof()</code> がありますよね？<br><code>typeof()</code>
はオブジェクトが<strong>コンピュータ内でどのように構築されているか</strong>を教えてくれます。一方、<code>class()</code>
はオブジェクトの<strong>人間にとっての意味</strong>を示します。したがって、<code>typeof()</code>
の出力は R で固定されています（主に 5
種類のデータ型）が、<code>class()</code> の出力は R
パッケージによって多様で拡張可能です。</p>
<p><code>cats</code>
の例では、整数型、倍精度数値型、論理型の変数が含まれています。すでに見たように、データフレームの各列はベクトルです：</p>
<div class="codewrapper sourceCode" id="cb128">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">coat</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "calico" "black"  "tabby" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb130">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "calico" "black"  "tabby" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb132">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">cats</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "character"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb134">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">cats</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:3] "calico" "black" "tabby"</code></pre>
</div>
<p>一方、各行は異なる変数の<em>観測値</em>であり、それ自体がデータフレームであり、異なる型の要素で構成されることができます：</p>
<div class="codewrapper sourceCode" id="cb136">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_catnip
1 calico    2.1         TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb138">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">cats</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "list"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb140">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">cats</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	1 obs. of  3 variables:
 $ coat        : chr "calico"
 $ weight      : num 2.1
 $ likes_catnip: logi TRUE</code></pre>
</div>
<div id="チャレンジ-5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-5" class="callout-inner">
<h3 class="callout-title">チャレンジ 5</h3>
<div class="callout-content">
<p>データフレームから変数、観測値、要素を取得する方法はいくつかあります：</p>
<ul>
<li><code>cats[1]</code></li>
<li><code>cats[[1]]</code></li>
<li><code>cats$coat</code></li>
<li><code>cats["coat"]</code></li>
<li><code>cats[1, 1]</code></li>
<li><code>cats[, 1]</code></li>
<li><code>cats[1, ]</code></li>
</ul>
<p>これらの例を試して、それぞれが何を返すのかを説明してください。</p>
<p><em>ヒント:</em> 返されるものを調べるには、<code>typeof()</code>
関数を使用してください。</p>
</div>
</div>
</div>
<div id="accordionSolution10" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution10" aria-expanded="false" aria-controls="collapseSolution10">
  <h4 class="accordion-header" id="headingSolution10">
  チャレンジ 5 の解答
  </h4>
</button>
<div id="collapseSolution10" class="accordion-collapse collapse" data-bs-parent="#accordionSolution10" aria-labelledby="headingSolution10">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb142">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat
1 calico
2  black
3  tabby</code></pre>
</div>
<p>データフレームはベクトルのリストと考えられます。単一ブラケット
<code>[1]</code>
はリストの最初のスライスを別のリストとして返します。この場合、それはデータフレームの最初の列です。</p>
<div class="codewrapper sourceCode" id="cb144">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "calico" "black"  "tabby" </code></pre>
</div>
<p>二重ブラケット <code>[[1]]</code>
はリスト項目の内容を返します。この場合、最初の列の内容である
<em>character</em> 型のベクトルです。</p>
<div class="codewrapper sourceCode" id="cb146">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">coat</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "calico" "black"  "tabby" </code></pre>
</div>
<p><code>$</code>
を使用して名前で項目にアクセスします。<code>coat</code>
はデータフレームの最初の列であり、<em>character</em>
型のベクトルです。</p>
<div class="codewrapper sourceCode" id="cb148">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span><span class="st">"coat"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat
1 calico
2  black
3  tabby</code></pre>
</div>
<p>単一ブラケット <code>["coat"]</code>
を使用し、インデックス番号の代わりに列名を指定します。例 1
と同様に、返されるオブジェクトは <em>list</em> です。</p>
<div class="codewrapper sourceCode" id="cb150">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "calico"</code></pre>
</div>
<p>単一ブラケットを使用し、行と列の座標を指定します。この場合、1 行目 1
列目の値が返されます。オブジェクトは <em>character</em>
型のベクトルです。</p>
<div class="codewrapper sourceCode" id="cb152">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "calico" "black"  "tabby" </code></pre>
</div>
<p>前の例と同様に単一ブラケットを使用し、行と列の座標を指定しますが、行座標が指定されていません。この場合、R
は欠損値をその列のすべての要素として解釈し、<em>ベクトル</em>
として返します。</p>
<div class="codewrapper sourceCode" id="cb154">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_catnip
1 calico    2.1         TRUE</code></pre>
</div>
<p>再び単一ブラケットを使用し、行と列の座標を指定しますが、今回は列座標が指定されていません。返される値は
1 行目のすべての値を含む <em>list</em> です。</p>
</div>
</div>
</div>
</div>
<div id="ヒント-データフレーム列の名前変更" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント-データフレーム列の名前変更" class="callout-inner">
<h3 class="callout-title">ヒント: データフレーム列の名前変更</h3>
<div class="callout-content">
<p>データフレームには列名があり、<code>names()</code>
関数でアクセスできます：</p>
<div class="codewrapper sourceCode" id="cb156">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "coat"         "weight"       "likes_catnip"</code></pre>
</div>
<p><code>cats</code> の 2
番目の列の名前を変更したい場合は、<code>names(cats)</code> の 2
番目の要素に新しい名前を割り当てます：</p>
<div class="codewrapper sourceCode" id="cb158">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"weight_kg"</span></span>
<span><span class="va">cats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight_kg likes_catnip
1 calico       2.1         TRUE
2  black       5.0        FALSE
3  tabby       3.2         TRUE</code></pre>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="行列matrix">行列（Matrix）<a class="anchor" aria-label="anchor" href="#%E8%A1%8C%E5%88%97matrix"></a>
</h3>
<p>最後に紹介するのは行列です。ゼロで満たされた行列を宣言してみましょう：</p>
<div class="codewrapper sourceCode" id="cb160">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matrix_example</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">0</span>, ncol<span class="op">=</span><span class="fl">6</span>, nrow<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">matrix_example</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    0    0    0    0    0    0
[2,]    0    0    0    0    0    0
[3,]    0    0    0    0    0    0</code></pre>
</div>
<p>行列を特別なものにしているのは <code>dim()</code> 属性です：</p>
<div class="codewrapper sourceCode" id="cb162">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dim</span><span class="op">(</span><span class="va">matrix_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3 6</code></pre>
</div>
<p>他のデータ構造と同様に、行列について質問することも可能です：</p>
<div class="codewrapper sourceCode" id="cb164">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">matrix_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "double"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb166">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">matrix_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "matrix" "array" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb168">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">matrix_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> num [1:3, 1:6] 0 0 0 0 0 0 0 0 0 0 ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb170">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">matrix_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb172">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">matrix_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 6</code></pre>
</div>
<div id="チャレンジ-6" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-6" class="callout-inner">
<h3 class="callout-title">チャレンジ 6</h3>
<div class="callout-content">
<p>次のコードの結果はどうなるでしょうか？</p>
<div class="codewrapper sourceCode" id="cb174">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">length</span><span class="op">(</span><span class="va">matrix_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 18</code></pre>
</div>
<p>実行して確認してください。予想は当たりましたか？なぜそのような結果になるのでしょうか？</p>
</div>
</div>
</div>
<div id="accordionSolution11" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution11" aria-expanded="false" aria-controls="collapseSolution11">
  <h4 class="accordion-header" id="headingSolution11">
  チャレンジ 6 の解答
  </h4>
</button>
<div id="collapseSolution11" class="accordion-collapse collapse" data-bs-parent="#accordionSolution11" aria-labelledby="headingSolution11">
<div class="accordion-body">
<p>行列は次元属性を持つベクトルであるため、<code>length</code>
は行列内の要素の総数を返します：</p>
<div class="codewrapper sourceCode" id="cb176">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matrix_example</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">0</span>, ncol<span class="op">=</span><span class="fl">6</span>, nrow<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">length</span><span class="op">(</span><span class="va">matrix_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 18</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ-7" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-7" class="callout-inner">
<h3 class="callout-title">チャレンジ 7</h3>
<div class="callout-content">
<p>1 から 50 の数値を含む、列数 5、行数 10 の行列を作成します。
デフォルトの動作として、この行列は列ごとに値が埋められますか、それとも行ごとですか？
その動作を変更する方法を調べてください。（ヒント：<code>matrix</code>
のドキュメントを参照）</p>
</div>
</div>
</div>
<div id="accordionSolution12" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution12" aria-expanded="false" aria-controls="collapseSolution12">
  <h4 class="accordion-header" id="headingSolution12">
  チャレンジ 7 の解答
  </h4>
</button>
<div id="collapseSolution12" class="accordion-collapse collapse" data-bs-parent="#accordionSolution12" aria-labelledby="headingSolution12">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb178">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, ncol<span class="op">=</span><span class="fl">5</span>, nrow<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, ncol<span class="op">=</span><span class="fl">5</span>, nrow<span class="op">=</span><span class="fl">10</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># 行ごとに埋める</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ-8" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-8" class="callout-inner">
<h3 class="callout-title">チャレンジ 8</h3>
<div class="callout-content">
<p>このワークショップの次のセクションに対応する 2
つの要素を持つリストを作成します：</p>
<ul>
<li>データ型</li>
<li>データ構造</li>
</ul>
<p>各データ型およびデータ構造の名前を文字型ベクトルに格納してください。</p>
</div>
</div>
</div>
<div id="accordionSolution13" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution13" aria-expanded="false" aria-controls="collapseSolution13">
  <h4 class="accordion-header" id="headingSolution13">
  チャレンジ 8 の解答
  </h4>
</button>
<div id="collapseSolution13" class="accordion-collapse collapse" data-bs-parent="#accordionSolution13" aria-labelledby="headingSolution13">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb179">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataTypes</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'double'</span>, <span class="st">'complex'</span>, <span class="st">'integer'</span>, <span class="st">'character'</span>, <span class="st">'logical'</span><span class="op">)</span></span>
<span><span class="va">dataStructures</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'data.frame'</span>, <span class="st">'vector'</span>, <span class="st">'list'</span>, <span class="st">'matrix'</span><span class="op">)</span></span>
<span><span class="va">answer</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span><span class="va">dataTypes</span>, <span class="va">dataStructures</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ-9" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-9" class="callout-inner">
<h3 class="callout-title">チャレンジ 9</h3>
<div class="callout-content">
<p>以下の行列の R 出力を考えてみてください：</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2]
[1,]    4    1
[2,]    9    5
[3,]   10    7</code></pre>
</div>
<p>この行列を作成するために使用された正しいコマンドはどれでしょうか？各コマンドを確認し、入力する前に正しいものを考えてください。<br>
他のコマンドでどのような行列が作成されるかを考えてみてください。</p>
<ol style="list-style-type: decimal">
<li><code>matrix(c(4, 1, 9, 5, 10, 7), nrow = 3)</code></li>
<li><code>matrix(c(4, 9, 10, 1, 5, 7), ncol = 2, byrow = TRUE)</code></li>
<li><code>matrix(c(4, 9, 10, 1, 5, 7), nrow = 2)</code></li>
<li><code>matrix(c(4, 1, 9, 5, 10, 7), ncol = 2, byrow = TRUE)</code></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution14" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution14" aria-expanded="false" aria-controls="collapseSolution14">
  <h4 class="accordion-header" id="headingSolution14">
  チャレンジ 9 の解答
  </h4>
</button>
<div id="collapseSolution14" class="accordion-collapse collapse" data-bs-parent="#accordionSolution14" aria-labelledby="headingSolution14">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb181">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">matrix</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">9</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">7</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>
<code>read.csv</code> を使用して R
で表形式データを読み取ります。</li>
<li>R の基本データ型は、double、integer、complex、logical、character
です。</li>
<li>データフレームや行列のようなデータ構造は、リストやベクトルを基にし、いくつかの属性が追加されています。</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-05-data-structures-part2"><p>Content from <a href="05-data-structures-part2.html">データフレームの操作</a></p>
<hr>
<p>Last updated on 2024-11-21 |

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/episodes/05-data-structures-part2.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>データフレームをどのように操作できますか？</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>行や列を追加または削除する。</li>
<li>2 つのデータフレームを結合する。</li>
<li>データフレームのサイズ、列のクラス、名前、最初の数行などの基本的なプロパティを表示する。</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>これまでに、R
の基本的なデータ型とデータ構造について学びました。以降の作業は、それらのツールを操作することに集約されます。最も頻繁に登場するのは、CSV
ファイルから情報を読み込んで作成するデータフレームです。このレッスンでは、データフレームの操作についてさらに学びます。</p>
<section><h2 class="section-heading" id="データフレームに列や行を追加する">データフレームに列や行を追加する<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AB%E5%88%97%E3%82%84%E8%A1%8C%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>データフレームの列はベクトルであるため、列全体でデータ型が一貫しています。そのため、新しい列を追加したい場合は、まず新しいベクトルを作成します：</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">cats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_catnip
1 calico    2.1            1
2  black    5.0            0
3  tabby    3.2            1</code></pre>
</div>
<p>これを列として追加するには、次のようにします：</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cbind</span><span class="op">(</span><span class="va">cats</span>, <span class="va">age</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_catnip age
1 calico    2.1            1   2
2  black    5.0            0   3
3  tabby    3.2            1   5</code></pre>
</div>
<p>ただし、データフレームの行数と異なる要素数を持つベクトルを追加しようとすると失敗します：</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">12</span><span class="op">)</span></span>
<span><span class="fu">cbind</span><span class="op">(</span><span class="va">cats</span>, <span class="va">age</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in data.frame(..., check.names = FALSE): arguments imply differing number of rows: 3, 4</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">cbind</span><span class="op">(</span><span class="va">cats</span>, <span class="va">age</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in data.frame(..., check.names = FALSE): arguments imply differing number of rows: 3, 2</code></pre>
</div>
<p>なぜ失敗するのでしょうか？R は、新しい列の各行に 1
つの要素が必要だと考えています：</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">length</span><span class="op">(</span><span class="va">age</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2</code></pre>
</div>
<p>したがって、<code>nrow(cats)</code> と <code>length(age)</code>
が等しい必要があります。新しいデータフレームを作成して、<code>cats</code>
に上書きしてみましょう。</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">cats</span> <span class="op">&lt;-</span> <span class="fu">cbind</span><span class="op">(</span><span class="va">cats</span>, <span class="va">age</span><span class="op">)</span></span></code></pre>
</div>
<p>次に、行を追加してみましょう。データフレームの行はリストであることを既に学びました：</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newRow</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span><span class="st">"tortoiseshell"</span>, <span class="fl">3.3</span>, <span class="cn">TRUE</span>, <span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">cats</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">cats</span>, <span class="va">newRow</span><span class="op">)</span></span></code></pre>
</div>
<p>新しい行が正しく追加されたことを確認します。</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>           coat weight likes_catnip age
1        calico    2.1            1   2
2         black    5.0            0   3
3         tabby    3.2            1   5
4 tortoiseshell    3.3            1   9</code></pre>
</div>
</section><section><h2 class="section-heading" id="行を削除する">行を削除する<a class="anchor" aria-label="anchor" href="#%E8%A1%8C%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>データフレームに行や列を追加する方法を学びました。次に、行を削除する方法を見てみましょう。</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>           coat weight likes_catnip age
1        calico    2.1            1   2
2         black    5.0            0   3
3         tabby    3.2            1   5
4 tortoiseshell    3.3            1   9</code></pre>
</div>
<p>最後の行を削除したデータフレームを取得するには：</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span><span class="op">-</span><span class="fl">4</span>, <span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_catnip age
1 calico    2.1            1   2
2  black    5.0            0   3
3  tabby    3.2            1   5</code></pre>
</div>
<p>コンマの後に何も指定しないことで、4
行目全体を削除することを示します。</p>
<p>複数の行を削除することもできます。たとえば、次のようにベクトル内に行番号を指定します：<code>cats[c(-3,-4), ]</code></p>
</section><section><h2 class="section-heading" id="列を削除する">列を削除する<a class="anchor" aria-label="anchor" href="#%E5%88%97%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>データフレームの列を削除することもできます。「age」列を削除する場合、変数番号またはインデックスを使用する方法があります。</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span>,<span class="op">-</span><span class="fl">4</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>           coat weight likes_catnip
1        calico    2.1            1
2         black    5.0            0
3         tabby    3.2            1
4 tortoiseshell    3.3            1</code></pre>
</div>
<p>コンマの前に何も指定しないことで、すべての行を保持することを示します。</p>
<p>または、インデックス名と <code>%in%</code>
演算子を使用して列を削除することもできます。<code>%in%</code>
演算子は、左側の引数（ここでは <code>cats</code>
の名前）の各要素について「この要素は右側の引数に含まれますか？」と尋ねます。</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">drop</span> <span class="op">&lt;-</span> <span class="fu">names</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span></span>
<span><span class="va">cats</span><span class="op">[</span>,<span class="op">!</span><span class="va">drop</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>           coat weight likes_catnip
1        calico    2.1            1
2         black    5.0            0
3         tabby    3.2            1
4 tortoiseshell    3.3            1</code></pre>
</div>
<p>論理演算子（<code>%in%</code>
など）による部分集合化については、次のエピソードで詳しく説明します。詳細は
<a href="06-data-subsetting.html">論理演算を使用した部分集合化</a>
を参照してください。</p>
</section><section><h2 class="section-heading" id="データフレームの結合">データフレームの結合<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AE%E7%B5%90%E5%90%88"></a>
</h2>
<hr class="half-width">
<p>データフレームにデータを追加する際に覚えておくべき重要な点は、<em>列はベクトル、行はリスト</em>であることです。2
つのデータフレームを <code>rbind</code>
を使用して結合することもできます：</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">cats</span>, <span class="va">cats</span><span class="op">)</span></span>
<span><span class="va">cats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>           coat weight likes_catnip age
1        calico    2.1            1   2
2         black    5.0            0   3
3         tabby    3.2            1   5
4 tortoiseshell    3.3            1   9
5        calico    2.1            1   2
6         black    5.0            0   3
7         tabby    3.2            1   5
8 tortoiseshell    3.3            1   9</code></pre>
</div>
<div id="チャレンジ-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-1" class="callout-inner">
<h3 class="callout-title">チャレンジ 1</h3>
<div class="callout-content">
<p>次の構文を使用して、新しいデータフレームを R 内で作成できます：</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>id <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span>,</span>
<span>                 x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>                 y <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>以下の情報を持つデータフレームを作成してください：</p>
<ul>
<li>名</li>
<li>姓</li>
<li>ラッキーナンバー</li>
</ul>
<p>次に、<code>rbind</code>
を使用して隣の人のエントリを追加します。最後に、<code>cbind</code>
を使用して「コーヒーブレイクの時間ですか？」という質問への各人の回答を含む列を追加してください。</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ 1 の解答
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>first <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Grace"</span><span class="op">)</span>,</span>
<span>                 last <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Hopper"</span><span class="op">)</span>,</span>
<span>                 lucky_number <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">df</span>, <span class="fu">list</span><span class="op">(</span><span class="st">"Marie"</span>, <span class="st">"Curie"</span>, <span class="fl">238</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">cbind</span><span class="op">(</span><span class="va">df</span>, coffeetime <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="実用的な例">実用的な例<a class="anchor" aria-label="anchor" href="#%E5%AE%9F%E7%94%A8%E7%9A%84%E3%81%AA%E4%BE%8B"></a>
</h2>
<hr class="half-width">
<p>これまで、猫データを使ってデータフレーム操作の基本を学びました。次に、これらのスキルを使用して、より現実的なデータセットを扱います。以前ダウンロードした
<code>gapminder</code> データセットを読み込んでみましょう：</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div id="その他のヒント" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="その他のヒント" class="callout-inner">
<h3 class="callout-title">その他のヒント</h3>
<div class="callout-content">
<ul>
<li><p>タブ区切り値ファイル（.tsv）を扱う場合は、区切り文字として
<code>"\\t"</code> を指定するか、<code>read.delim()</code>
を使用します。</p></li>
<li><p>ファイルをインターネットから直接ダウンロードしてコンピュータの指定したローカルフォルダに保存するには、<code>download.file</code>
関数を使用できます。保存されたファイルを <code>read.csv</code>
関数で読み込む例：</p></li>
</ul>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">download.file</span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/main/episodes/data/gapminder_data.csv"</span>, destfile <span class="op">=</span> <span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span>
<span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span></code></pre>
</div>
<ul>
<li>また、ファイルパスの代わりに Web アドレスを <code>read.csv</code>
に指定して、ファイルを直接 R
に読み込むこともできます。この場合、ローカルにファイルを保存する必要はありません。例：</li>
</ul>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/main/episodes/data/gapminder_data.csv"</span><span class="op">)</span></span></code></pre>
</div>
<ul>
<li><p><a href="https://cran.r-project.org/package=readxl" class="external-link">readxl
パッケージ</a> を使用すると、Excel
スプレッドシートをプレーンテキストに変換せずに直接読み込むことができます。</p></li>
<li><p><code>"stringsAsFactors"</code>
引数を使用すると、文字列を因子として読み込むか文字列として読み込むかを指定できます。R
バージョン 4.0
以降では、デフォルトで文字列は文字型として読み込まれますが、古いバージョンでは因子として読み込まれるのがデフォルトでした。詳細は<a href="https://swcarpentry.github.io/r-novice-gapminder/04-data-structures-part1.html#check-your-data-for-factors" class="external-link">前のエピソード</a>のコールアウトを参照してください。</p></li>
</ul>
</div>
</div>
</div>
<p><code>gapminder</code>
データセットを調べてみましょう。最初に行うべきことは、<code>str</code>
を使用してデータの構造を確認することです：</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	1704 obs. of  6 variables:
 $ country  : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr  "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num  779 821 853 836 740 ...</code></pre>
</div>
<p><code>gapminder</code>
の構造を調べる別の方法として、<code>summary</code>
関数を使用します。この関数は R
のさまざまなオブジェクトで使用できます。データフレームの場合、<code>summary</code>
は各列の数値的、表形式、または記述的な概要を提供します。数値または整数型の列は記述統計（四分位数や平均値）で、文字列型の列はその長さ、クラス、モードで説明されます。</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   country               year           pop             continent
 Length:1704        Min.   :1952   Min.   :6.001e+04   Length:1704
 Class :character   1st Qu.:1966   1st Qu.:2.794e+06   Class :character
 Mode  :character   Median :1980   Median :7.024e+06   Mode  :character
                    Mean   :1980   Mean   :2.960e+07
                    3rd Qu.:1993   3rd Qu.:1.959e+07
                    Max.   :2007   Max.   :1.319e+09
    lifeExp        gdpPercap
 Min.   :23.60   Min.   :   241.2
 1st Qu.:48.20   1st Qu.:  1202.1
 Median :60.71   Median :  3531.8
 Mean   :59.47   Mean   :  7215.3
 3rd Qu.:70.85   3rd Qu.:  9325.5
 Max.   :82.60   Max.   :113523.1  </code></pre>
</div>
<p><code>str</code> や <code>summary</code>
関数と合わせて、<code>typeof</code>
関数を使ってデータフレームの個々の列を調べることもできます：</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "integer"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "character"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:1704] "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...</code></pre>
</div>
<p>データフレームの次元に関する情報も調べることができます。<br><code>str(gapminder)</code> の出力によると、<code>gapminder</code> には
6 つの変数の 1704
個の観測値があります。このことを覚えた上で、次のコードが何を返すか考えてみてください：</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">length</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 6</code></pre>
</div>
<p>データフレームの長さが行数（1704）であると考えるのが妥当ですが、実際にはそうではありません。データフレームは<em>ベクトルや因子のリスト</em>で構成されていることを思い出してください：</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "list"</code></pre>
</div>
<p><code>length</code> が 6 を返した理由は、<code>gapminder</code> が 6
列のリストで構築されているためです。データセットの行数と列数を取得するには次のようにします：</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1704</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 6</code></pre>
</div>
<p>あるいは、両方を一度に取得するには：</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dim</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1704    6</code></pre>
</div>
<p>すべての列のタイトルを調べることもできます。後でアクセスする際に便利です：</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">colnames</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "country"   "year"      "pop"       "continent" "lifeExp"   "gdpPercap"</code></pre>
</div>
<p>ここで、R
が報告する構造が自分の直感や予想と一致しているかどうかを確認することが重要です。各列のデータ型が妥当かどうかを確認してください。そうでない場合は、これまで学んだ
R
のデータ解釈の仕組みや、一貫性の重要性に基づいて問題を解決する必要があります。</p>
<p>データ型や構造が合理的であることを確認したら、データの探索を開始しましょう。最初の数行を確認します：</p>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap
1 Afghanistan 1952  8425333      Asia  28.801  779.4453
2 Afghanistan 1957  9240934      Asia  30.332  820.8530
3 Afghanistan 1962 10267083      Asia  31.997  853.1007
4 Afghanistan 1967 11537966      Asia  34.020  836.1971
5 Afghanistan 1972 13079460      Asia  36.088  739.9811
6 Afghanistan 1977 14880372      Asia  38.438  786.1134</code></pre>
</div>
<div id="チャレンジ-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-2" class="callout-inner">
<h3 class="callout-title">チャレンジ 2</h3>
<div class="callout-content">
<p>データの最後の数行や中間のいくつかの行も確認するのが良い習慣です。これをどのように行いますか？</p>
<p>特に中間の行を探すのは難しくありませんが、ランダムな行をいくつか取得することもできます。これをどのようにコード化しますか？</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  チャレンジ 2 の解答
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>最後の数行を確認するには、R に既にある関数を使用すれば簡単です：</p>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tail</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span>
<span><span class="fu">tail</span><span class="op">(</span><span class="va">gapminder</span>, n <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code></pre>
</div>
<p>では、途中の任意の行を確認するにはどうすればよいでしょうか？</p>
<div class="section level2">
<h2 id="ヒント-いくつかの方法で達成できます">ヒント: いくつかの方法で達成できます<a class="anchor" aria-label="anchor" href="#%E3%83%92%E3%83%B3%E3%83%88-%E3%81%84%E3%81%8F%E3%81%A4%E3%81%8B%E3%81%AE%E6%96%B9%E6%B3%95%E3%81%A7%E9%81%94%E6%88%90%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99"></a>
</h2>
<p>ここではネストされた関数（関数を別の関数の引数として渡す）を使用する一例を示します。この考え方は新しいように思えるかもしれませんが、既に使用しています。<br>
例えば、<code>my_dataframe[rows, cols]</code>
は指定された行と列のデータフレームを表示します。データフレームの最後の行を取得するにはどうしますか？R
にはそのための関数があります。また、（擬似ランダムな）サンプルを取得するにはどうすればよいでしょうか？</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="fu">sample</span><span class="op">(</span><span class="fu">nrow</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>, <span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<p>再現性のある分析を確保するために、コードをスクリプトファイルに保存し、後で再利用できるようにしましょう。</p>
<div id="チャレンジ-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-3" class="callout-inner">
<h3 class="callout-title">チャレンジ 3</h3>
<div class="callout-content">
<p>File -&gt; New File -&gt; R Script に移動し、<code>gapminder</code>
データセットを読み込むための R スクリプトを作成します。このスクリプトを
<code>scripts/</code>
ディレクトリに保存し、バージョン管理に追加してください。</p>
<p>その後、<code>source</code>
関数を使用してスクリプトを実行します。ファイルパスを引数として指定するか、RStudio
の「Source」ボタンを押します。</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  チャレンジ 3 の解答
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p><code>source</code>
関数はスクリプト内で別のスクリプトを使用するために使用できます。同じ種類のファイルを何度も読み込む必要がある場合、一度スクリプトとして保存すれば、以降はそれを繰り返し利用できます。</p>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">download.file</span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/main/episodes/data/gapminder_data.csv"</span>, destfile <span class="op">=</span> <span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span>
<span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span></code></pre>
</div>
<p>データを <code>gapminder</code>
変数に読み込むには次のようにします：</p>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">source</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"scripts/load-gapminder.R"</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-4" class="callout-inner">
<h3 class="callout-title">チャレンジ 4</h3>
<div class="callout-content">
<p><code>str(gapminder)</code>
の出力をもう一度読み、リストやベクトルについて学んだこと、および
<code>colnames</code> や <code>dim</code>
の出力を活用して、<code>str</code>
が表示する内容を説明してください。理解できない部分があれば、隣の人と相談してみてください。</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  チャレンジ 4 の解答
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>オブジェクト <code>gapminder</code>
はデータフレームで、列は次のようになっています：</p>
<ul>
<li>
<code>country</code> と <code>continent</code>
は文字列（character）。</li>
<li>
<code>year</code> は整数型のベクトル。</li>
<li>
<code>pop</code>、<code>lifeExp</code>、<code>gdpPercap</code>
は数値型のベクトル。</li>
</ul>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>新しい列をデータフレームに追加するには <code>cbind()</code>
を使用します。</li>
<li>新しい行をデータフレームに追加するには <code>rbind()</code>
を使用します。</li>
<li>データフレームから行を削除します。</li>
<li>データフレームの構造を理解するために、<code>str()</code>、<code>summary()</code>、<code>nrow()</code>、<code>ncol()</code>、<code>dim()</code>、<code>colnames()</code>、<code>head()</code>、<code>typeof()</code>
を使用します。</li>
<li>
<code>read.csv()</code> を使用して CSV ファイルを読み込みます。</li>
<li>データフレームの <code>length()</code>
が何を表しているのか理解します。</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-06-data-subsetting"><p>Content from <a href="06-data-subsetting.html">データの部分集合化</a></p>
<hr>
<p>Last updated on 2024-11-26 |

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/episodes/06-data-subsetting.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 50 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>R でデータの部分集合をどのように扱うことができますか？</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>ベクトル、因子、行列、リスト、データフレームの部分集合化を学ぶ</li>
<li>インデックス、名前、比較演算を使って個々の要素や複数の要素を抽出する方法を理解する</li>
<li>さまざまなデータ構造から要素をスキップまたは削除する方法を習得する</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>R
には強力な部分集合化のための演算子が数多く用意されています。それらを習得することで、あらゆる種類のデータセットで複雑な操作を簡単に行えるようになります。</p>
<p>あらゆる種類のオブジェクトを部分集合化するために 6
つの異なる方法があり、データ構造ごとに 3
種類の部分集合化演算子があります。</p>
<p>では、R の基本となる数値ベクトルを使って始めましょう。</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">5.4</span>, <span class="fl">6.2</span>, <span class="fl">7.1</span>, <span class="fl">4.8</span>, <span class="fl">7.5</span><span class="op">)</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span><span class="op">)</span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   c   d   e
5.4 6.2 7.1 4.8 7.5 </code></pre>
</div>
<div id="アトミックベクトル" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="アトミックベクトル" class="callout-inner">
<h3 class="callout-title">アトミックベクトル</h3>
<div class="callout-content">
<p>R では、文字列、数値、または論理値を含む単純なベクトルを
<em>アトミックベクトル</em>
と呼びます。これは、さらに単純化できないためです。</p>
</div>
</div>
</div>
<p>このようにダミーベクトルを作成しました。この中身をどのように取得するのでしょうか？</p>
<section><h2 class="section-heading" id="インデックスを使用した要素のアクセス">インデックスを使用した要素のアクセス<a class="anchor" aria-label="anchor" href="#%E3%82%A4%E3%83%B3%E3%83%87%E3%83%83%E3%82%AF%E3%82%B9%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E8%A6%81%E7%B4%A0%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9"></a>
</h2>
<hr class="half-width">
<p>ベクトルの要素を抽出するには、対応するインデックスを指定します（1
から始まります）：</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span>  <span class="va">a</span></span>
<span><span class="fl">5.4</span> </span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span>  <span class="va">d</span></span>
<span><span class="fl">4.8</span> </span></code></pre>
</div>
<p>角括弧 <code>[]</code> 演算子は関数であり、ベクトルや行列に対して「n
番目の要素を取得する」という意味を持ちます。</p>
<p>複数の要素を一度に取得することもできます：</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   c
5.4 7.1 </code></pre>
</div>
<p>またはベクトルの一部（スライス）を取得することも可能です：</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   c   d
5.4 6.2 7.1 4.8 </code></pre>
</div>
<p><code>:</code>
演算子は左の値から右の値までの数値のシーケンスを生成します。</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 4</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 4</code></pre>
</div>
<p>同じ要素を複数回取得することもできます：</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   a   c
5.4 5.4 7.1 </code></pre>
</div>
<p>ベクトルの長さを超えるインデックスを指定すると、R
は欠損値を返します：</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;NA&gt;
  NA </code></pre>
</div>
<p>これは <code>NA</code> を含む長さ 1 のベクトルであり、名前も
<code>NA</code> です。</p>
<p>0 番目の要素を要求すると、空のベクトルが返されます：</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>named numeric(0)</code></pre>
</div>
<div id="r-のベクトルの番号付けは-1-から始まる" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="r-のベクトルの番号付けは-1-から始まる" class="callout-inner">
<h3 class="callout-title">R のベクトルの番号付けは 1 から始まる</h3>
<div class="callout-content">
<p>多くのプログラミング言語（C や Python
など）では、ベクトルの最初の要素のインデックスは 0 です。一方、R
では最初の要素は 1 です。</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="要素のスキップと削除">要素のスキップと削除<a class="anchor" aria-label="anchor" href="#%E8%A6%81%E7%B4%A0%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%83%E3%83%97%E3%81%A8%E5%89%8A%E9%99%A4"></a>
</h2>
<hr class="half-width">
<p>ベクトルのインデックスに負の数を使用すると、指定した要素を除くすべての要素が返されます：</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   c   d   e
5.4 7.1 4.8 7.5 </code></pre>
</div>
<p>複数の要素をスキップすることも可能です：</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">5</span><span class="op">)</span><span class="op">]</span>  <span class="co"># または x[-c(1,5)]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d
6.2 7.1 4.8 </code></pre>
</div>
<div id="ヒント-演算の順序" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント-演算の順序" class="callout-inner">
<h3 class="callout-title">ヒント: 演算の順序</h3>
<div class="callout-content">
<p>ベクトルの一部をスキップしようとすると、新しい人はよく間違えます。例えば：</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre>
</div>
<p>このコードは次のようなエラーを返します：</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in x[-1:3]: only 0's may be mixed with negative subscripts</code></pre>
</div>
<p>これは演算の順序が関係しています。<code>:</code>
は実際には関数であり、最初の引数を <code>-1</code>、2 番目の引数を
<code>3</code>
としてシーケンスを生成します：<code>c(-1, 0, 1, 2, 3)</code>。</p>
<p>正しい解決策は、この関数呼び出しを括弧で囲み、<code>-</code>
演算子を結果に適用することです：</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  d   e
4.8 7.5 </code></pre>
</div>
</div>
</div>
</div>
<p>ベクトルから要素を削除するには、結果を変数に再割り当てする必要があります：</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   c   e
5.4 6.2 7.1 7.5 </code></pre>
</div>
<div id="チャレンジ-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-1" class="callout-inner">
<h3 class="callout-title">チャレンジ 1</h3>
<div class="callout-content">
<p>次のコードが与えられた場合：</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">5.4</span>, <span class="fl">6.2</span>, <span class="fl">7.1</span>, <span class="fl">4.8</span>, <span class="fl">7.5</span><span class="op">)</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span><span class="op">)</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   c   d   e
5.4 6.2 7.1 4.8 7.5 </code></pre>
</div>
<p>次の出力を生成する少なくとも 2
つの異なるコマンドを考え出してください：</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d
6.2 7.1 4.8 </code></pre>
</div>
<p>2
つの異なるコマンドを見つけたら、隣の人と比較してみてください。異なる戦略を持っていましたか？</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ 1 の解答
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d
6.2 7.1 4.8 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d
6.2 7.1 4.8 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d
6.2 7.1 4.8 </code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="名前によるサブセット">名前によるサブセット<a class="anchor" aria-label="anchor" href="#%E5%90%8D%E5%89%8D%E3%81%AB%E3%82%88%E3%82%8B%E3%82%B5%E3%83%96%E3%82%BB%E3%83%83%E3%83%88"></a>
</h2>
<hr class="half-width">
<p>インデックスではなく名前を使って要素を抽出することができます：</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span>a<span class="op">=</span><span class="fl">5.4</span>, b<span class="op">=</span><span class="fl">6.2</span>, c<span class="op">=</span><span class="fl">7.1</span>, d<span class="op">=</span><span class="fl">4.8</span>, e<span class="op">=</span><span class="fl">7.5</span><span class="op">)</span> <span class="co"># ベクトルにその場で名前を付ける</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   c
5.4 7.1 </code></pre>
</div>
<p>これは、オブジェクトをサブセットする際に、通常より信頼性の高い方法です。<br>
サブセット操作を連続して行う場合、要素の位置が変わることがありますが、名前は常に変わりません！</p>
</section><section><h2 class="section-heading" id="logical-operations">他の論理演算を用いたサブセット<a class="anchor" aria-label="anchor" href="#logical-operations"></a>
</h2>
<hr class="half-width">
<p>論理ベクトルを使ってサブセットを取ることもできます：</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  c   e
7.1 7.5 </code></pre>
</div>
<p>比較演算子（例：<code>&gt;</code>、<code>&lt;</code>、<code>==</code>）は論理ベクトルを生成するため、それを使ってベクトルを簡潔にサブセットできます。以下のステートメントは、前の例と同じ結果を返します。</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">7</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  c   e
7.1 7.5 </code></pre>
</div>
<p>このステートメントを分解すると、まず <code>x&gt;7</code>
が評価されて論理ベクトル <code>c(FALSE, FALSE, TRUE, FALSE, TRUE)</code>
が生成され、それに基づいて <code>x</code> の要素が選択されます。</p>
<p>名前によるインデックス操作を模倣するには、<code>==</code>
を使うことができます（比較には <code>=</code> ではなく <code>==</code>
を使用する必要がある点に注意）：</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="st">"a"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span>  <span class="va">a</span></span>
<span><span class="fl">5.4</span> </span></code></pre>
</div>
<div id="ヒント-複数の論理条件の結合" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント-複数の論理条件の結合" class="callout-inner">
<h3 class="callout-title">ヒント: 複数の論理条件の結合</h3>
<div class="callout-content">
<p>複数の論理条件を結合したい場合があります。たとえば、特定の範囲内の寿命を持つアジアまたはヨーロッパに位置するすべての国を見つけたいとします。このような場合、R
では論理ベクトルを結合するための以下の演算子を使用できます：</p>
<ul>
<li>
<code>&amp;</code>（論理AND）: 左右がともに <code>TRUE</code>
の場合に <code>TRUE</code> を返します。</li>
<li>
<code>|</code>（論理OR）: 左右のいずれか、または両方が
<code>TRUE</code> の場合に <code>TRUE</code> を返します。</li>
</ul>
<p><code>&amp;</code> や <code>|</code> の代わりに
<code>&amp;&amp;</code> や <code>||</code>
が使われることもありますが、これらはベクトルの最初の要素だけを見て残りを無視します。データ解析では、通常1文字の演算子（<code>&amp;</code>
や
<code>|</code>）を使用し、2文字の演算子はプログラミング（ステートメントの実行を決定する際など）で使用してください。</p>
<ul>
<li>
<code>!</code>（論理NOT）: <code>TRUE</code> を <code>FALSE</code>
に、<code>FALSE</code> を <code>TRUE</code>
に変換します。単一の条件（例：<code>!TRUE</code> は <code>FALSE</code>
になる）や、ベクトル全体（例：<code>!c(TRUE, FALSE)</code> は
<code>c(FALSE, TRUE)</code> になる）を否定できます。</li>
</ul>
<p>また、単一のベクトル内の要素を比較するために、<code>all</code>（すべての要素が
<code>TRUE</code> の場合に <code>TRUE</code> を返す）や
<code>any</code>（1つ以上の要素が <code>TRUE</code> の場合に
<code>TRUE</code> を返す）関数を使用できます。</p>
</div>
</div>
</div>
<div id="チャレンジ-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-2" class="callout-inner">
<h3 class="callout-title">チャレンジ 2</h3>
<div class="callout-content">
<p>以下のコードを用いて：</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">5.4</span>, <span class="fl">6.2</span>, <span class="fl">7.1</span>, <span class="fl">4.8</span>, <span class="fl">7.5</span><span class="op">)</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span><span class="op">)</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   c   d   e
5.4 6.2 7.1 4.8 7.5 </code></pre>
</div>
<p><code>x</code> から 4 より大きく 7
未満の値を返すサブセットコマンドを書いてください。</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  チャレンジ 2 の解答
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_subset</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">&lt;</span><span class="fl">7</span> <span class="op">&amp;</span> <span class="va">x</span><span class="op">&gt;</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">x_subset</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   d
5.4 6.2 4.8 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="ヒント-重複する名前" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント-重複する名前" class="callout-inner">
<h3 class="callout-title">ヒント: 重複する名前</h3>
<div class="callout-content">
<p>1つのベクトル内で複数の要素が同じ名前を持つことも可能です（データフレームでは、列名が重複することはありますが、行名は一意である必要があります）。以下の例を考えてみてください：</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'a'</span>, <span class="st">'a'</span><span class="op">)</span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>a a a
1 2 3 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="st">'a'</span><span class="op">]</span>  <span class="co"># 最初の値のみを返す</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">a</span></span>
<span><span class="fl">1</span> </span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="st">'a'</span><span class="op">]</span>  <span class="co"># すべての値を返す</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>a a a
1 2 3 </code></pre>
</div>
</div>
</div>
</div>
<div id="ヒント-演算子に関するヘルプを得る方法" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント-演算子に関するヘルプを得る方法" class="callout-inner">
<h3 class="callout-title">ヒント: 演算子に関するヘルプを得る方法</h3>
<div class="callout-content">
<p>演算子を引用符で囲むことで、ヘルプを検索できます：<br><code>help("%in%")</code> または <code>?"%in%"</code>。</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="名前付き要素をスキップする">名前付き要素をスキップする<a class="anchor" aria-label="anchor" href="#%E5%90%8D%E5%89%8D%E4%BB%98%E3%81%8D%E8%A6%81%E7%B4%A0%E3%82%92%E3%82%B9%E3%82%AD%E3%83%83%E3%83%97%E3%81%99%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>名前付き要素をスキップまたは削除するのは少し難しいです。文字列を否定してスキップしようとすると、R
は「文字列を否定する方法が分からない」というやや分かりにくいエラーを出します：</p>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span>a<span class="op">=</span><span class="fl">5.4</span>, b<span class="op">=</span><span class="fl">6.2</span>, c<span class="op">=</span><span class="fl">7.1</span>, d<span class="op">=</span><span class="fl">4.8</span>, e<span class="op">=</span><span class="fl">7.5</span><span class="op">)</span> <span class="co"># もう一度その場でベクトルに名前を付ける</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="st">"a"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in -"a": invalid argument to unary operator</code></pre>
</div>
<p>しかし、<code>!=</code>（等しくない）演算子を使用して論理ベクトルを構築すれば、望む動作を実現できます：</p>
<div class="codewrapper sourceCode" id="cb62">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"a"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d   e
6.2 7.1 4.8 7.5 </code></pre>
</div>
<p>複数の名前付きインデックスをスキップするのはさらに難しいです。例えば、<code>"a"</code>
と <code>"c"</code> を削除しようとして次のように試みます：</p>
<div class="codewrapper sourceCode" id="cb64">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">!=</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"c"</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning in names(x) != c("a", "c"): longer object length is not a multiple of
shorter object length</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d   e
6.2 7.1 4.8 7.5 </code></pre>
</div>
<p>R は <em>何か</em> をしましたが、警告を出しており、それが示す通り
<em>間違った結果</em> を返しました（<code>"c"</code>
要素がまだベクトルに含まれています）。</p>
<p><code>!=</code>
がこの場合に何を実際にしているのかは、非常に良い質問です。</p>
<div class="section level3">
<h3 id="リサイクル">リサイクル<a class="anchor" aria-label="anchor" href="#%E3%83%AA%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB"></a>
</h3>
<p>このコードの比較部分を見てみましょう：</p>
<div class="codewrapper sourceCode" id="cb67">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning in names(x) != c("a", "c"): longer object length is not a multiple of
shorter object length</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE  TRUE  TRUE  TRUE  TRUE</code></pre>
</div>
<p><code>names(x)[3] != "c"</code> は明らかに偽なのに、なぜ R
はこのベクトルの3番目の要素に <code>TRUE</code>
を返すのでしょうか？<br><code>!=</code> を使用すると、R
は左辺の各要素を右辺の対応する要素と比較しようとします。左辺と右辺の長さが異なる場合はどうなりますか？</p>
<figure><img src="../fig/06-rmd-inequality.1.png" alt="不等式テスト" class="figure mx-auto d-block"></figure><p>一方のベクトルがもう一方より短い場合、短いベクトルは
<em>リサイクル</em> されます：</p>
<figure><img src="../fig/06-rmd-inequality.2.png" alt="リサイクルによる不等式テストの結果" class="figure mx-auto d-block"></figure><p>この場合、R は <code>c("a", "c")</code> を必要な回数だけ繰り返して
<code>names(x)</code>
と一致させます（例：<code>c("a","c","a","c","a")</code>）。<br>
再利用された <code>"a"</code> が <code>names(x)</code>
の3番目の要素と一致しないため、<code>!=</code> の結果が
<code>TRUE</code> になります。</p>
<p>リサイクルによりこのような間違いが発生するのを防ぐには
<code>%in%</code>
演算子を使用します。この演算子は左辺の各要素について、右辺の中にその要素が存在するかどうかを確認します。今回は値を除外したいので、<code>!</code>
演算子も使用します：</p>
<div class="codewrapper sourceCode" id="cb70">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="op">!</span> <span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"c"</span><span class="op">)</span> <span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   d   e
6.2 4.8 7.5 </code></pre>
</div>
<div id="チャレンジ-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-3" class="callout-inner">
<h3 class="callout-title">チャレンジ 3</h3>
<div class="callout-content">
<p>ベクトルの要素を、特定のリスト内のいずれかと一致させる操作は、データ解析で非常に一般的なタスクです。例えば、gapminder
データセットには <code>country</code> と <code>continent</code>
の変数がありますが、これらの間の情報は含まれていません。東南アジアの情報を抽出したいとします。このとき、どのようにして東南アジアのすべての国について
<code>TRUE</code>、それ以外を <code>FALSE</code>
とする論理ベクトルを作成しますか？</p>
<p>以下のデータを使用します：</p>
<div class="codewrapper sourceCode" id="cb72">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seAsia</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Myanmar"</span>,<span class="st">"Thailand"</span>,<span class="st">"Cambodia"</span>,<span class="st">"Vietnam"</span>,<span class="st">"Laos"</span><span class="op">)</span></span>
<span><span class="co">## エピソード2でダウンロードした gapminder データを読み込む</span></span>
<span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_data.csv"</span>, header<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## データフレームから `country` 列を抽出（詳細は後述）；</span></span>
<span><span class="co">## factor を文字列に変換；</span></span>
<span><span class="co">## 重複しない要素のみ取得</span></span>
<span><span class="va">countries</span> <span class="op">&lt;-</span> <span class="fu">unique</span><span class="op">(</span><span class="fu">as.character</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>以下の3つの方法を試し、それぞれがどのように（正しくない、または正しい方法で）動作するのか説明してください：</p>
<ol style="list-style-type: decimal">
<li>
<strong>間違った方法</strong>（<code>==</code> のみを使用）<br>
</li>
<li>
<strong>不格好な方法</strong>（論理演算子 <code>==</code> と
<code>|</code> を使用）<br>
</li>
<li>
<strong>エレガントな方法</strong>（<code>%in%</code> を使用）</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  チャレンジ 3 の解答
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<ul>
<li><p><strong>間違った方法</strong><br><code>countries==seAsia</code><br>
この方法では、警告（<code>"In countries == seAsia : 長いオブジェクトの長さが短いオブジェクトの長さの倍数ではありません"</code>）が表示され、誤った結果（すべて
<code>FALSE</code> のベクトル）が返されます。これは、<code>seAsia</code>
の再利用された値が正しい位置に一致しないためです。</p></li>
<li><p><strong>不格好な方法</strong><br>
以下のコードでは正しい値を得ることができますが、非常に冗長で扱いにくいです：</p></li>
</ul>
<div class="codewrapper sourceCode" id="cb73">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="op">(</span><span class="va">countries</span><span class="op">==</span><span class="st">"Myanmar"</span> <span class="op">|</span> <span class="va">countries</span><span class="op">==</span><span class="st">"Thailand"</span> <span class="op">|</span></span>
<span> <span class="va">countries</span><span class="op">==</span><span class="st">"Cambodia"</span> <span class="op">|</span> <span class="va">countries</span> <span class="op">==</span> <span class="st">"Vietnam"</span> <span class="op">|</span> <span class="va">countries</span><span class="op">==</span><span class="st">"Laos"</span><span class="op">)</span></span></code></pre>
</div>
<p>または、<code>countries==seAsia[1] | countries==seAsia[2] | ...</code>
のように記述します。<br>
リストが長い場合、さらに複雑になります。</p>
<ul>
<li>
<strong>エレガントな方法</strong><br><code>countries %in% seAsia</code><br>
この方法は正確で、記述が簡単で可読性も高いです。</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="特殊値の扱い">特殊値の扱い<a class="anchor" aria-label="anchor" href="#%E7%89%B9%E6%AE%8A%E5%80%A4%E3%81%AE%E6%89%B1%E3%81%84"></a>
</h2>
<hr class="half-width">
<p>R
では、欠損値、無限値、未定義値を処理できない関数に出会うことがあります。<br>
そのようなデータをフィルタリングするために、以下の特殊な関数を使用できます：</p>
<ul>
<li>
<code>is.na</code>：ベクトル、行列、またはデータフレーム内の
<code>NA</code>（または <code>NaN</code>）を含む位置を返します。</li>
<li>同様に、<code>is.nan</code> と <code>is.infinite</code> は、それぞれ
<code>NaN</code> と <code>Inf</code> に対応します。</li>
<li>
<code>is.finite</code>：<code>NA</code>、<code>NaN</code>、<code>Inf</code>
を含まない位置を返します。</li>
<li>
<code>na.omit</code>：ベクトルからすべての欠損値を除外します。</li>
</ul></section><section><h2 class="section-heading" id="因子のサブセット">因子のサブセット<a class="anchor" aria-label="anchor" href="#%E5%9B%A0%E5%AD%90%E3%81%AE%E3%82%B5%E3%83%96%E3%82%BB%E3%83%83%E3%83%88"></a>
</h2>
<hr class="half-width">
<p>ベクトルのサブセット方法を学んだところで、他のデータ構造のサブセットについて考えてみましょう。<br>
因子のサブセットは、ベクトルのサブセットと同じ方法で行えます。</p>
<div class="codewrapper sourceCode" id="cb74">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"d"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">f</span><span class="op">[</span><span class="va">f</span> <span class="op">==</span> <span class="st">"a"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] a a
Levels: a b c d</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb76">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span><span class="op">[</span><span class="va">f</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] b c c
Levels: a b c d</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb78">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] a a b
Levels: a b c d</code></pre>
</div>
<p>要素をスキップしても、そのカテゴリが因子レベルから削除されるわけではありません：</p>
<div class="codewrapper sourceCode" id="cb80">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span><span class="op">[</span><span class="op">-</span><span class="fl">3</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] a a c c d
Levels: a b c d</code></pre>
</div>
</section><section><h2 class="section-heading" id="行列のサブセット">行列のサブセット<a class="anchor" aria-label="anchor" href="#%E8%A1%8C%E5%88%97%E3%81%AE%E3%82%B5%E3%83%96%E3%82%BB%E3%83%83%E3%83%88"></a>
</h2>
<hr class="half-width">
<p>行列は <code>[</code>
関数を使用してサブセットします。この場合、2つの引数を取り、1つ目は行、2つ目は列に適用されます：</p>
<div class="codewrapper sourceCode" id="cb82">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">rnorm</span><span class="op">(</span><span class="fl">6</span><span class="op">*</span><span class="fl">4</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">4</span>, nrow<span class="op">=</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">m</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>            [,1]       [,2]
[1,]  1.12493092 -0.8356286
[2,] -0.04493361  1.5952808</code></pre>
</div>
<p>行または列全体を取得する場合は、1つ目または2つ目の引数を空白のままにします：</p>
<div class="codewrapper sourceCode" id="cb84">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">[</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>            [,1]        [,2]
[1,] -0.62124058  0.82122120
[2,] -2.21469989  0.59390132
[3,]  1.12493092  0.91897737
[4,] -0.04493361  0.78213630
[5,] -0.01619026  0.07456498
[6,]  0.94383621 -1.98935170</code></pre>
</div>
<p>1つの行または列のみを取得すると、結果が自動的にベクトルに変換されます：</p>
<div class="codewrapper sourceCode" id="cb86">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -0.8356286  0.5757814  1.1249309  0.9189774</code></pre>
</div>
<p>結果を行列として保持するには、<em>第3引数</em> を指定して
<code>drop = FALSE</code> を設定します：</p>
<div class="codewrapper sourceCode" id="cb88">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">[</span><span class="fl">3</span>, , drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>           [,1]      [,2]     [,3]      [,4]
[1,] -0.8356286 0.5757814 1.124931 0.9189774</code></pre>
</div>
<p>行または列の外側をアクセスしようとすると、R
はエラーをスローします：</p>
<div class="codewrapper sourceCode" id="cb90">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">[</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">3</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in m[, c(3, 6)]: subscript out of bounds</code></pre>
</div>
<div id="ヒント-高次元配列" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント-高次元配列" class="callout-inner">
<h3 class="callout-title">ヒント: 高次元配列</h3>
<div class="callout-content">
<p>多次元配列の場合、<code>[</code>
の各引数が次元に対応します。例えば、3次元配列の場合、最初の3つの引数が行、列、および深さ次元に対応します。</p>
</div>
</div>
</div>
<p>行列はベクトルであるため、1つの引数だけを使用してサブセットを取ることもできます：</p>
<div class="codewrapper sourceCode" id="cb92">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.3295078</code></pre>
</div>
<p>これは通常あまり有用ではなく、読み取りづらい場合があります。ただし、行列がデフォルトで
<em>列優先フォーマット</em>
に配置されていることを理解するのに役立ちます。つまり、ベクトルの要素は列ごとに配置されます：</p>
<div class="codewrapper sourceCode" id="cb94">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, nrow<span class="op">=</span><span class="fl">2</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3]
[1,]    1    3    5
[2,]    2    4    6</code></pre>
</div>
<p>行ごとに行列を埋めたい場合は、<code>byrow=TRUE</code>
を使用します：</p>
<div class="codewrapper sourceCode" id="cb96">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, nrow<span class="op">=</span><span class="fl">2</span>, ncol<span class="op">=</span><span class="fl">3</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    4    5    6</code></pre>
</div>
<p>行列は、行および列のインデックスの代わりに、その行名および列名を使用してサブセットを取ることもできます。</p>
<div id="チャレンジ-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-4" class="callout-inner">
<h3 class="callout-title">チャレンジ 4</h3>
<div class="callout-content">
<p>以下のコードを用いて：</p>
<div class="codewrapper sourceCode" id="cb98">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">18</span>, nrow<span class="op">=</span><span class="fl">3</span>, ncol<span class="op">=</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    1    4    7   10   13   16
[2,]    2    5    8   11   14   17
[3,]    3    6    9   12   15   18</code></pre>
</div>
<ol style="list-style-type: decimal">
<li>以下のコマンドのうち、11 と 14 を抽出するものはどれでしょうか？</li>
</ol>
<p>A. <code>m[2,4,2,5]</code><br>
B. <code>m[2:5]</code><br>
C. <code>m[4:5,2]</code><br>
D. <code>m[2,c(4,5)]</code></p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  チャレンジ 4 の解答
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>D</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="リストのサブセット">リストのサブセット<a class="anchor" aria-label="anchor" href="#%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AE%E3%82%B5%E3%83%96%E3%82%BB%E3%83%83%E3%83%88"></a>
</h2>
<hr class="half-width">
<p>ここでは新しいサブセット演算子を紹介します。リストをサブセットするためには、3つの関数を使用します。これらは、原子ベクトルや行列を学ぶ際にも登場しました：<code>[</code>,
<code>[[</code>, <code>$</code> です。</p>
<p><code>[</code>
を使用すると、常にリストが返されます。リストから要素を「抽出」するのではなく「サブセット」したい場合に使用します。</p>
<div class="codewrapper sourceCode" id="cb100">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>a <span class="op">=</span> <span class="st">"Software Carpentry"</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, data <span class="op">=</span> <span class="fu">head</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">xlist</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$a
[1] "Software Carpentry"</code></pre>
</div>
<p>このコードは、<em>1つの要素を含むリスト</em> を返します。</p>
<p>リストの要素は、原子ベクトルと同じ方法でサブセットできます。ただし、比較演算は再帰的ではなく、リスト内のデータ構造に基づいて条件が評価されるため、リスト内の個々の要素には適用されません。</p>
<div class="codewrapper sourceCode" id="cb102">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$a
[1] "Software Carpentry"

$b
 [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<p>リストの個々の要素を抽出するには、二重角括弧関数 <code>[[</code>
を使用する必要があります。</p>
<div class="codewrapper sourceCode" id="cb104">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Software Carpentry"</code></pre>
</div>
<p>この結果はリストではなくベクトルであることに注意してください。</p>
<p>複数の要素を一度に抽出することはできません：</p>
<div class="codewrapper sourceCode" id="cb106">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in xlist[[1:2]]: subscript out of bounds</code></pre>
</div>
<p>また、要素をスキップすることもできません：</p>
<div class="codewrapper sourceCode" id="cb108">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">[[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in xlist[[-1]]: invalid negative subscript in get1index &lt;real&gt;</code></pre>
</div>
<p>ただし、名前を使用して要素をサブセットおよび抽出することは可能です：</p>
<div class="codewrapper sourceCode" id="cb110">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">[[</span><span class="st">"a"</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Software Carpentry"</code></pre>
</div>
<p><code>$</code>
演算子は、名前で要素を抽出するための簡潔な記法を提供します：</p>
<div class="codewrapper sourceCode" id="cb112">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">$</span><span class="va">data</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
</div>
<div id="チャレンジ-5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-5" class="callout-inner">
<h3 class="callout-title">チャレンジ 5</h3>
<div class="callout-content">
<p>以下のリストが与えられています：</p>
<div class="codewrapper sourceCode" id="cb114">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>a <span class="op">=</span> <span class="st">"Software Carpentry"</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, data <span class="op">=</span> <span class="fu">head</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>リストとベクトルのサブセット方法を用いて、<code>xlist</code>
から数字の 2 を抽出してください。<br>
ヒント：数字の 2 はリスト内の <code>"b"</code> に含まれています。</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  チャレンジ 5 の解答
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb115">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">$</span><span class="va">b</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb117">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb119">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">[[</span><span class="st">"b"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ-6" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-6" class="callout-inner">
<h3 class="callout-title">チャレンジ 6</h3>
<div class="callout-content">
<p>以下の線形モデルが与えられています：</p>
<div class="codewrapper sourceCode" id="cb121">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">aov</span><span class="op">(</span><span class="va">pop</span> <span class="op">~</span> <span class="va">lifeExp</span>, data<span class="op">=</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<p>残差の自由度を抽出してください（ヒント：<code>attributes()</code>
が役立ちます）。</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">
  チャレンジ 6 の解答
  </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb122">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">attributes</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="co">## `df.residual` は `mod` の名前の1つです</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb123">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span><span class="op">$</span><span class="va">df.residual</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="データフレーム">データフレーム<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0"></a>
</h2>
<hr class="half-width">
<p>データフレームは内部的にはリストであることを覚えておきましょう。そのため、同様のルールが適用されます。ただし、データフレームは2次元のオブジェクトでもあります：</p>
<p><code>[</code>
に1つの引数を与える場合、リストと同様に動作し、それぞれのリスト要素が列に対応します。結果として得られるオブジェクトはデータフレームになります：</p>
<div class="codewrapper sourceCode" id="cb124">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>       pop
1  8425333
2  9240934
3 10267083
4 11537966
5 13079460
6 14880372</code></pre>
</div>
<p>同様に、<code>[[</code> を使用すると、<em>単一の列</em>
を抽出します：</p>
<div class="codewrapper sourceCode" id="cb126">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[[</span><span class="st">"lifeExp"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28.801 30.332 31.997 34.020 36.088 38.438</code></pre>
</div>
<p><code>$</code>
演算子は、列を名前で抽出するための便利なショートカットを提供します：</p>
<div class="codewrapper sourceCode" id="cb128">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1952 1957 1962 1967 1972 1977</code></pre>
</div>
<p>2つの引数を与えると、<code>[</code>
は行列と同じように動作します：</p>
<div class="codewrapper sourceCode" id="cb130">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap
1 Afghanistan 1952  8425333      Asia  28.801  779.4453
2 Afghanistan 1957  9240934      Asia  30.332  820.8530
3 Afghanistan 1962 10267083      Asia  31.997  853.1007</code></pre>
</div>
<p>単一行をサブセットすると、結果はデータフレームになります（要素が混合型のためです）：</p>
<div class="codewrapper sourceCode" id="cb132">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap
3 Afghanistan 1962 10267083      Asia  31.997  853.1007</code></pre>
</div>
<p>ただし、単一列をサブセットすると結果はベクトルになります（第3引数
<code>drop = FALSE</code> を指定することで変更可能）。</p>
<div id="チャレンジ-7" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-7" class="callout-inner">
<h3 class="callout-title">チャレンジ 7</h3>
<div class="callout-content">
<p>以下の一般的なデータフレームサブセットエラーを修正してください：</p>
<ol style="list-style-type: decimal">
<li>年 1957 の観測値を抽出する</li>
</ol>
<div class="codewrapper sourceCode" id="cb134">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" tabindex="-1"></a>gapminder[gapminder<span class="sc">$</span>year <span class="ot">=</span> <span class="dv">1957</span>,]</span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>1列目から4列目以外のすべての列を抽出する</li>
</ol>
<div class="codewrapper sourceCode" id="cb135">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>寿命が80年以上の行を抽出する</li>
</ol>
<div class="codewrapper sourceCode" id="cb136">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">80</span><span class="op">]</span></span></code></pre>
</div>
<ol start="4" style="list-style-type: decimal">
<li>1行目と4列目、5列目（<code>continent</code> と
<code>lifeExp</code>）を抽出する</li>
</ol>
<div class="codewrapper sourceCode" id="cb137">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">]</span></span></code></pre>
</div>
<ol start="5" style="list-style-type: decimal">
<li>応用：年 2002 年と 2007 年の情報を含む行を抽出する</li>
</ol>
<div class="codewrapper sourceCode" id="cb138">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span> <span class="op">|</span> <span class="fl">2007</span>,<span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7">
  チャレンジ 7 の解答
  </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" data-bs-parent="#accordionSolution7" aria-labelledby="headingSolution7">
<div class="accordion-body">
<p>以下の一般的なデータフレームサブセットエラーを修正：</p>
<ol style="list-style-type: decimal">
<li>年 1957 の観測値を抽出する</li>
</ol>
<div class="codewrapper sourceCode" id="cb139">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gapminder[gapminder$year = 1957,]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">1957</span>,<span class="op">]</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>1列目から4列目以外のすべての列を抽出する</li>
</ol>
<div class="codewrapper sourceCode" id="cb140">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gapminder[,-1:4]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span>,<span class="op">-</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>寿命が80年以上の行を抽出する</li>
</ol>
<div class="codewrapper sourceCode" id="cb141">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gapminder[gapminder$lifeExp &gt; 80]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">80</span>,<span class="op">]</span></span></code></pre>
</div>
<ol start="4" style="list-style-type: decimal">
<li>1行目と4列目、5列目（<code>continent</code> と
<code>lifeExp</code>）を抽出する</li>
</ol>
<div class="codewrapper sourceCode" id="cb142">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gapminder[1, 4, 5]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span><span class="fl">1</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<ol start="5" style="list-style-type: decimal">
<li>応用：年 2002 年と 2007 年の情報を含む行を抽出する</li>
</ol>
<div class="codewrapper sourceCode" id="cb143">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gapminder[gapminder$year == 2002 | 2007,]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span> <span class="op">|</span> <span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span>,<span class="op">]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2002</span>, <span class="fl">2007</span><span class="op">)</span>,<span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-8" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-8" class="callout-inner">
<h3 class="callout-title">Challenge 8</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li><p>Why does <code>gapminder[1:20]</code> return an error? How does
it differ from <code>gapminder[1:20, ]</code>?</p></li>
<li><p>Create a new <code>data.frame</code> called
<code>gapminder_small</code> that only contains rows 1 through 9 and 19
through 23. You can do this in one or two steps.</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8">
  Solution to challenge 8
  </h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" data-bs-parent="#accordionSolution8" aria-labelledby="headingSolution8">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li><p><code>gapminder</code> is a data.frame so needs to be subsetted
on two dimensions. <code>gapminder[1:20, ]</code> subsets the data to
give the first 20 rows and all columns.</p></li>
<li>
</li>
</ol>
<div class="codewrapper sourceCode" id="cb144">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder_small</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, <span class="fl">19</span><span class="op">:</span><span class="fl">23</span><span class="op">)</span>,<span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Indexing in R starts at 1, not 0.</li>
<li>Access individual values by location using <code>[]</code>.</li>
<li>Access slices of data using <code>[low:high]</code>.</li>
<li>Access arbitrary sets of data using <code>[c(...)]</code>.</li>
<li>Use logical operations and logical vectors to access subsets of
data.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-07-control-flow"><p>Content from <a href="07-control-flow.html">Control Flow</a></p>
<hr>
<p>Last updated on 2024-11-26 |

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/episodes/07-control-flow.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 65 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I make data-dependent choices in R?</li>
<li>How can I repeat operations in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Write conditional statements with <code>if...else</code> statements
and <code>ifelse()</code>.</li>
<li>Write and understand <code>for()</code> loops.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Often when we’re coding we want to control the flow of our actions.
This can be done by setting actions to occur only if a condition or a
set of conditions are met. Alternatively, we can also set an action to
occur a particular number of times.</p>
<p>There are several ways you can control flow in R. For conditional
statements, the most commonly used approaches are the constructs:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># if</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="cf">if</span> (condition is true) {</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  perform action</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>}</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co"># if ... else</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="cf">if</span> (condition is true) {</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  perform action</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>} <span class="cf">else</span> {  <span class="co"># that is, if the condition is false,</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  perform alternative action</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>}</span></code></pre>
</div>
<p>Say, for example, that we want R to print a message if a variable
<code>x</code> has a particular value:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"x is greater than or equal to 10"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 8</code></pre>
</div>
<p>The print statement does not appear in the console because x is not
greater than 10. To print a different message for numbers less than 10,
we can add an <code>else</code> statement.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"x is greater than or equal to 10"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"x is less than 10"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "x is less than 10"</code></pre>
</div>
<p>You can also test multiple conditions by using
<code>else if</code>.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"x is greater than or equal to 10"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"x is greater than 5, but less than 10"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"x is less than 5"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "x is greater than 5, but less than 10"</code></pre>
</div>
<p><strong>Important:</strong> when R evaluates the condition inside
<code>if()</code> statements, it is looking for a logical element, i.e.,
<code>TRUE</code> or <code>FALSE</code>. This can cause some headaches
for beginners. For example:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span>  <span class="op">&lt;-</span>  <span class="fl">4</span> <span class="op">==</span> <span class="fl">3</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="st">"4 equals 3"</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="st">"4 does not equal 3"</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "4 does not equal 3"</code></pre>
</div>
<p>As we can see, the not equal message was printed because the vector x
is <code>FALSE</code></p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">4</span> <span class="op">==</span> <span class="fl">3</span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE</code></pre>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1</h3>
<div class="callout-content">
<p>Use an <code>if()</code> statement to print a suitable message
reporting whether there are any records from 2002 in the
<code>gapminder</code> dataset. Now do the same for 2012.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to Challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>We will first see a solution to Challenge 1 which does not use the
<code>any()</code> function. We first obtain a logical vector describing
which element of <code>gapminder$year</code> is equal to
<code>2002</code>:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span><span class="op">)</span>,<span class="op">]</span></span></code></pre>
</div>
<p>Then, we count the number of rows of the data.frame
<code>gapminder</code> that correspond to the 2002:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rows2002_number</span> <span class="op">&lt;-</span> <span class="fu">nrow</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<p>The presence of any record for the year 2002 is equivalent to the
request that <code>rows2002_number</code> is one or more:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rows2002_number</span> <span class="op">&gt;=</span> <span class="fl">1</span></span></code></pre>
</div>
<p>Putting all together, we obtain:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="fu">nrow</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>   <span class="fu">print</span><span class="op">(</span><span class="st">"Record(s) for the year 2002 found."</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>All this can be done more quickly with <code>any()</code>. The
logical condition can be expressed as:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="fu">any</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>   <span class="fu">print</span><span class="op">(</span><span class="st">"Record(s) for the year 2002 found."</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Did anyone get a warning message like this?</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in if (gapminder$year == 2012) {: the condition has length &gt; 1</code></pre>
</div>
<p>The <code>if()</code> function only accepts singular (of length 1)
inputs, and therefore returns an error when you use it with a vector.
The <code>if()</code> function will still run, but will only evaluate
the condition in the first element of the vector. Therefore, to use the
<code>if()</code> function, you need to make sure your input is singular
(of length 1).</p>
<div id="tip-built-in-ifelse-function" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-built-in-ifelse-function" class="callout-inner">
<h3 class="callout-title">Tip: Built in <code>ifelse()</code>
function</h3>
<div class="callout-content">
<p><code>R</code> accepts both <code>if()</code> and
<code>else if()</code> statements structured as outlined above, but also
statements using <code>R</code>’s built-in <code>ifelse()</code>
function. This function accepts both singular and vector inputs and is
structured as follows:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># ifelse function</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">ifelse</span>(condition is true, perform action, perform alternative action)</span></code></pre>
</div>
<p>where the first argument is the condition or a set of conditions to
be met, the second argument is the statement that is evaluated when the
condition is <code>TRUE</code>, and the third statement is the statement
that is evaluated when the condition is <code>FALSE</code>.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">3</span></span>
<span><span class="fu">ifelse</span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="st">"y is a negative number"</span>, <span class="st">"y is either positive or zero"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "y is a negative number"</code></pre>
</div>
</div>
</div>
</div>
<div id="tip-any-and-all" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-any-and-all" class="callout-inner">
<h3 class="callout-title">Tip: <code>any()</code> and
<code>all()</code>
</h3>
<div class="callout-content">
<p>The <code>any()</code> function will return <code>TRUE</code> if at
least one <code>TRUE</code> value is found within a vector, otherwise it
will return <code>FALSE</code>. This can be used in a similar way to the
<code>%in%</code> operator. The function <code>all()</code>, as the name
suggests, will only return <code>TRUE</code> if all values in the vector
are <code>TRUE</code>.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="repeating-operations">Repeating operations<a class="anchor" aria-label="anchor" href="#repeating-operations"></a>
</h2>
<hr class="half-width">
<p>If you want to iterate over a set of values, when the order of
iteration is important, and perform the same operation on each, a
<code>for()</code> loop will do the job. We saw <code>for()</code> loops
in the <a href="https://swcarpentry.github.io/shell-novice/05-loop.html" class="external-link">shell
lessons earlier</a>. This is the most flexible of looping operations,
but therefore also the hardest to use correctly. In general, the advice
of many <code>R</code> users would be to learn about <code>for()</code>
loops, but to avoid using <code>for()</code> loops unless the order of
iteration is important: i.e. the calculation at each iteration depends
on the results of previous iterations. If the order of iteration is not
important, then you should learn about vectorized alternatives, such as
the <code>purrr</code> package, as they pay off in computational
efficiency.</p>
<p>The basic structure of a <code>for()</code> loop is:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="cf">for</span> (iterator <span class="cf">in</span> set of values) {</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  do a thing</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>}</span></code></pre>
</div>
<p>For example:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1
[1] 2
[1] 3
[1] 4
[1] 5
[1] 6
[1] 7
[1] 8
[1] 9
[1] 10</code></pre>
</div>
<p>The <code>1:10</code> bit creates a vector on the fly; you can
iterate over any other vector as well.</p>
<p>We can use a <code>for()</code> loop nested within another
<code>for()</code> loop to iterate over two things at once.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">print</span><span class="op">(</span><span class="fu">paste</span><span class="op">(</span><span class="va">i</span>,<span class="va">j</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "1 a"
[1] "1 b"
[1] "1 c"
[1] "1 d"
[1] "1 e"
[1] "2 a"
[1] "2 b"
[1] "2 c"
[1] "2 d"
[1] "2 e"
[1] "3 a"
[1] "3 b"
[1] "3 c"
[1] "3 d"
[1] "3 e"
[1] "4 a"
[1] "4 b"
[1] "4 c"
[1] "4 d"
[1] "4 e"
[1] "5 a"
[1] "5 b"
[1] "5 c"
[1] "5 d"
[1] "5 e"</code></pre>
</div>
<p>We notice in the output that when the first index (<code>i</code>) is
set to 1, the second index (<code>j</code>) iterates through its full
set of indices. Once the indices of <code>j</code> have been iterated
through, then <code>i</code> is incremented. This process continues
until the last index has been used for each <code>for()</code> loop.</p>
<p>Rather than printing the results, we could write the loop output to a
new object.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">temp_output</span> <span class="op">&lt;-</span> <span class="fu">paste</span><span class="op">(</span><span class="va">i</span>, <span class="va">j</span><span class="op">)</span></span>
<span>    <span class="va">output_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">output_vector</span>, <span class="va">temp_output</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">output_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "1 a" "1 b" "1 c" "1 d" "1 e" "2 a" "2 b" "2 c" "2 d" "2 e" "3 a" "3 b"
[13] "3 c" "3 d" "3 e" "4 a" "4 b" "4 c" "4 d" "4 e" "5 a" "5 b" "5 c" "5 d"
[25] "5 e"</code></pre>
</div>
<p>This approach can be useful, but ‘growing your results’ (building the
result object incrementally) is computationally inefficient, so avoid it
when you are iterating through a lot of values.</p>
<div id="tip-dont-grow-your-results" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-dont-grow-your-results" class="callout-inner">
<h3 class="callout-title">Tip: don’t grow your results</h3>
<div class="callout-content">
<p>One of the biggest things that trips up novices and experienced R
users alike, is building a results object (vector, list, matrix, data
frame) as your for loop progresses. Computers are very bad at handling
this, so your calculations can very quickly slow to a crawl. It’s much
better to define an empty results object before hand of appropriate
dimensions, rather than initializing an empty object without dimensions.
So if you know the end result will be stored in a matrix like above,
create an empty matrix with 5 row and 5 columns, then at each iteration
store the results in the appropriate location.</p>
</div>
</div>
</div>
<p>A better way is to define your (empty) output object before filling
in the values. For this example, it looks more involved, but is still
more efficient.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_matrix</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">5</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">j_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">temp_j_value</span> <span class="op">&lt;-</span> <span class="va">j_vector</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>    <span class="va">temp_output</span> <span class="op">&lt;-</span> <span class="fu">paste</span><span class="op">(</span><span class="va">i</span>, <span class="va">temp_j_value</span><span class="op">)</span></span>
<span>    <span class="va">output_matrix</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp_output</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">output_vector2</span> <span class="op">&lt;-</span> <span class="fu">as.vector</span><span class="op">(</span><span class="va">output_matrix</span><span class="op">)</span></span>
<span><span class="va">output_vector2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "1 a" "2 a" "3 a" "4 a" "5 a" "1 b" "2 b" "3 b" "4 b" "5 b" "1 c" "2 c"
[13] "3 c" "4 c" "5 c" "1 d" "2 d" "3 d" "4 d" "5 d" "1 e" "2 e" "3 e" "4 e"
[25] "5 e"</code></pre>
</div>
<div id="tip-while-loops" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-while-loops" class="callout-inner">
<h3 class="callout-title">Tip: While loops</h3>
<div class="callout-content">
<p>Sometimes you will find yourself needing to repeat an operation as
long as a certain condition is met. You can do this with a
<code>while()</code> loop.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="cf">while</span>(this condition is true){</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>  do a thing</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>}</span></code></pre>
</div>
<p>R will interpret a condition being met as “TRUE”.</p>
<p>As an example, here’s a while loop that generates random numbers from
a uniform distribution (the <code>runif()</code> function) between 0 and
1 until it gets one that’s less than 0.1.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="kw">while</span><span class="op">(</span><span class="va">z</span> <span class="op">&gt;</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">runif</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu">cat</span><span class="op">(</span><span class="va">z</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p><code>while()</code> loops will not always be appropriate. You have
to be particularly careful that you don’t end up stuck in an infinite
loop because your condition is always met and hence the while statement
never terminates.</p>
</div>
</div>
</div>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2</h3>
<div class="callout-content">
<p>Compare the objects <code>output_vector</code> and
<code>output_vector2</code>. Are they the same? If not, why not? How
would you change the last block of code to make
<code>output_vector2</code> the same as <code>output_vector</code>?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to Challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>We can check whether the two vectors are identical using the
<code>all()</code> function:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">all</span><span class="op">(</span><span class="va">output_vector</span> <span class="op">==</span> <span class="va">output_vector2</span><span class="op">)</span></span></code></pre>
</div>
<p>However, all the elements of <code>output_vector</code> can be found
in <code>output_vector2</code>:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">all</span><span class="op">(</span><span class="va">output_vector</span> <span class="op">%in%</span> <span class="va">output_vector2</span><span class="op">)</span></span></code></pre>
</div>
<p>and vice versa:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">all</span><span class="op">(</span><span class="va">output_vector2</span> <span class="op">%in%</span> <span class="va">output_vector</span><span class="op">)</span></span></code></pre>
</div>
<p>therefore, the element in <code>output_vector</code> and
<code>output_vector2</code> are just sorted in a different order. This
is because <code>as.vector()</code> outputs the elements of an input
matrix going over its column. Taking a look at
<code>output_matrix</code>, we can notice that we want its elements by
rows. The solution is to transpose the <code>output_matrix</code>. We
can do it either by calling the transpose function <code>t()</code> or
by inputting the elements in the right order. The first solution
requires to change the original</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_vector2</span> <span class="op">&lt;-</span> <span class="fu">as.vector</span><span class="op">(</span><span class="va">output_matrix</span><span class="op">)</span></span></code></pre>
</div>
<p>into</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_vector2</span> <span class="op">&lt;-</span> <span class="fu">as.vector</span><span class="op">(</span><span class="fu">t</span><span class="op">(</span><span class="va">output_matrix</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>The second solution requires to change</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_matrix</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp_output</span></span></code></pre>
</div>
<p>into</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_matrix</span><span class="op">[</span><span class="va">j</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp_output</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3</h3>
<div class="callout-content">
<p>Write a script that loops through the <code>gapminder</code> data by
continent and prints out whether the mean life expectancy is smaller or
larger than 50 years.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Solution to Challenge 3
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p><strong>Step 1</strong>: We want to make sure we can extract all the
unique values of the continent vector</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span>
<span><span class="fu">unique</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span></code></pre>
</div>
<p><strong>Step 2</strong>: We also need to loop over each of these
continents and calculate the average life expectancy for each
<code>subset</code> of data. We can do that as follows:</p>
<ol style="list-style-type: decimal">
<li>Loop over each of the unique values of ‘continent’</li>
<li>For each value of continent, create a temporary variable storing
that subset</li>
<li>Return the calculated life expectancy to the user by printing the
output:</li>
</ol>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">iContinent</span> <span class="kw">in</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="va">iContinent</span>, <span class="op">]</span></span>
<span>  <span class="fu">cat</span><span class="op">(</span><span class="va">iContinent</span>, <span class="fu">mean</span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">lifeExp</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu">rm</span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p><strong>Step 3</strong>: The exercise only wants the output printed
if the average life expectancy is less than 50 or greater than 50. So we
need to add an <code>if()</code> condition before printing, which
evaluates whether the calculated average life expectancy is above or
below a threshold, and prints an output conditional on the result. We
need to amend (3) from above:</p>
<p>3a. If the calculated life expectancy is less than some threshold (50
years), return the continent and a statement that life expectancy is
less than threshold, otherwise return the continent and a statement that
life expectancy is greater than threshold:</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thresholdValue</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">iContinent</span> <span class="kw">in</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="va">iContinent</span>, <span class="st">"lifeExp"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>   <span class="kw">if</span> <span class="op">(</span><span class="va">tmp</span> <span class="op">&lt;</span> <span class="va">thresholdValue</span><span class="op">)</span><span class="op">{</span></span>
<span>       <span class="fu">cat</span><span class="op">(</span><span class="st">"Average Life Expectancy in"</span>, <span class="va">iContinent</span>, <span class="st">"is less than"</span>, <span class="va">thresholdValue</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>   <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>       <span class="fu">cat</span><span class="op">(</span><span class="st">"Average Life Expectancy in"</span>, <span class="va">iContinent</span>, <span class="st">"is greater than"</span>, <span class="va">thresholdValue</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>   <span class="op">}</span> <span class="co"># end if else condition</span></span>
<span>   <span class="fu">rm</span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="co"># end for loop</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4" class="callout-inner">
<h3 class="callout-title">Challenge 4</h3>
<div class="callout-content">
<p>Modify the script from Challenge 3 to loop over each country. This
time print out whether the life expectancy is smaller than 50, between
50 and 70, or greater than 70.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Solution to Challenge 4
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>We modify our solution to Challenge 3 by now adding two thresholds,
<code>lowerThreshold</code> and <code>upperThreshold</code> and
extending our if-else statements:</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">lowerThreshold</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span> <span class="va">upperThreshold</span> <span class="op">&lt;-</span> <span class="fl">70</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">iCountry</span> <span class="kw">in</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="va">iCountry</span>, <span class="st">"lifeExp"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">tmp</span> <span class="op">&lt;</span> <span class="va">lowerThreshold</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">cat</span><span class="op">(</span><span class="st">"Average Life Expectancy in"</span>, <span class="va">iCountry</span>, <span class="st">"is less than"</span>, <span class="va">lowerThreshold</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">tmp</span> <span class="op">&gt;</span> <span class="va">lowerThreshold</span> <span class="op">&amp;&amp;</span> <span class="va">tmp</span> <span class="op">&lt;</span> <span class="va">upperThreshold</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">cat</span><span class="op">(</span><span class="st">"Average Life Expectancy in"</span>, <span class="va">iCountry</span>, <span class="st">"is between"</span>, <span class="va">lowerThreshold</span>, <span class="st">"and"</span>, <span class="va">upperThreshold</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="fu">cat</span><span class="op">(</span><span class="st">"Average Life Expectancy in"</span>, <span class="va">iCountry</span>, <span class="st">"is greater than"</span>, <span class="va">upperThreshold</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu">rm</span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-5---advanced" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-5---advanced" class="callout-inner">
<h3 class="callout-title">Challenge 5 - Advanced</h3>
<div class="callout-content">
<p>Write a script that loops over each country in the
<code>gapminder</code> dataset, tests whether the country starts with a
‘B’, and graphs life expectancy against time as a line graph if the mean
life expectancy is under 50 years.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  Solution for Challenge 5
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>We will use the <code>grep()</code> command that was introduced in
the <a href="https://swcarpentry.github.io/shell-novice/07-find.html" class="external-link">Unix
Shell lesson</a> to find countries that start with “B.” Lets understand
how to do this first. Following from the Unix shell section we may be
tempted to try the following</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">grep</span><span class="op">(</span><span class="st">"^B"</span>, <span class="fu">unique</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>But when we evaluate this command it returns the indices of the
factor variable <code>country</code> that start with “B.” To get the
values, we must add the <code>value=TRUE</code> option to the
<code>grep()</code> command:</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">grep</span><span class="op">(</span><span class="st">"^B"</span>, <span class="fu">unique</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>We will now store these countries in a variable called
candidateCountries, and then loop over each entry in the variable.
Inside the loop, we evaluate the average life expectancy for each
country, and if the average life expectancy is less than 50 we use
base-plot to plot the evolution of average life expectancy using
<code>with()</code> and <code>subset()</code>:</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thresholdValue</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">candidateCountries</span> <span class="op">&lt;-</span> <span class="fu">grep</span><span class="op">(</span><span class="st">"^B"</span>, <span class="fu">unique</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">iCountry</span> <span class="kw">in</span> <span class="va">candidateCountries</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="va">iCountry</span>, <span class="st">"lifeExp"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmp</span> <span class="op">&lt;</span> <span class="va">thresholdValue</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">cat</span><span class="op">(</span><span class="st">"Average Life Expectancy in"</span>, <span class="va">iCountry</span>, <span class="st">"is less than"</span>, <span class="va">thresholdValue</span>, <span class="st">"plotting life expectancy graph... \n"</span><span class="op">)</span></span>
<span></span>
<span>        <span class="fu">with</span><span class="op">(</span><span class="fu">subset</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">country</span> <span class="op">==</span> <span class="va">iCountry</span><span class="op">)</span>,</span>
<span>                <span class="fu">plot</span><span class="op">(</span><span class="va">year</span>, <span class="va">lifeExp</span>,</span>
<span>                     type <span class="op">=</span> <span class="st">"o"</span>,</span>
<span>                     main <span class="op">=</span> <span class="fu">paste</span><span class="op">(</span><span class="st">"Life Expectancy in"</span>, <span class="va">iCountry</span>, <span class="st">"over time"</span><span class="op">)</span>,</span>
<span>                     ylab <span class="op">=</span> <span class="st">"Life Expectancy"</span>,</span>
<span>                     xlab <span class="op">=</span> <span class="st">"Year"</span></span>
<span>                     <span class="op">)</span> <span class="co"># end plot</span></span>
<span>             <span class="op">)</span> <span class="co"># end with</span></span>
<span>    <span class="op">}</span> <span class="co"># end if</span></span>
<span>    <span class="fu">rm</span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="co"># end for loop</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>if</code> and <code>else</code> to make choices.</li>
<li>Use <code>for</code> to repeat operations.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-08-plot-ggplot2"><p>Content from <a href="08-plot-ggplot2.html">Creating Publication-Quality Graphics with ggplot2</a></p>
<hr>
<p>Last updated on 2024-11-26 |

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/episodes/08-plot-ggplot2.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 80 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I create publication-quality graphics in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>To be able to use ggplot2 to generate publication-quality
graphics.</li>
<li>To apply geometry, aesthetic, and statistics layers to a ggplot
plot.</li>
<li>To manipulate the aesthetics of a plot using different colors,
shapes, and lines.</li>
<li>To improve data visualization through transforming scales and
paneling by group.</li>
<li>To save a plot created with ggplot to disk.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Plotting our data is one of the best ways to quickly explore it and
the various relationships between variables.</p>
<p>There are three main plotting systems in R, the <a href="https://www.statmethods.net/graphs/index.html" class="external-link">base plotting
system</a>, the <a href="https://www.statmethods.net/advgraphs/trellis.html" class="external-link">lattice</a>
package, and the <a href="https://www.statmethods.net/advgraphs/ggplot2.html" class="external-link">ggplot2</a>
package.</p>
<p>Today we’ll be learning about the ggplot2 package, because it is the
most effective for creating publication-quality graphics.</p>
<p>ggplot2 is built on the grammar of graphics, the idea that any plot
can be built from the same set of components: a <strong>data
set</strong>, <strong>mapping aesthetics</strong>, and graphical
<strong>layers</strong>:</p>
<ul>
<li><p><strong>Data sets</strong> are the data that you, the user,
provide.</p></li>
<li><p><strong>Mapping aesthetics</strong> are what connect the data to
the graphics. They tell ggplot2 how to use your data to affect how the
graph looks, such as changing what is plotted on the X or Y axis, or the
size or color of different data points.</p></li>
<li><p><strong>Layers</strong> are the actual graphical output from
ggplot2. Layers determine what kinds of plot are shown (scatterplot,
histogram, etc.), the coordinate system used (rectangular, polar,
others), and other important aspects of the plot. The idea of layers of
graphics may be familiar to you if you have used image editing programs
like Photoshop, Illustrator, or Inkscape.</p></li>
</ul>
<p>Let’s start off building an example using the gapminder data from
earlier. The most basic function is <code>ggplot</code>, which lets R
know that we’re creating a new plot. Any of the arguments we give the
<code>ggplot</code> function are the <em>global</em> options for the
plot: they apply to all layers on the plot.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-blank-ggplot-1.png" alt="Blank plot, before adding any mapping aesthetics to ggplot()." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Here we called <code>ggplot</code> and told it what data we want to
show on our figure. This is not enough information for
<code>ggplot</code> to actually draw anything. It only creates a blank
slate for other elements to be added to.</p>
<p>Now we’re going to add in the <strong>mapping aesthetics</strong>
using the <code>aes</code> function. <code>aes</code> tells
<code>ggplot</code> how variables in the <strong>data</strong> map to
<em>aesthetic</em> properties of the figure, such as which columns of
the data should be used for the <strong>x</strong> and
<strong>y</strong> locations.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-ggplot-with-aes-1.png" alt="Plotting area with axes for a scatter plot of life expectancy vs GDP, with no data points visible." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Here we told <code>ggplot</code> we want to plot the “gdpPercap”
column of the gapminder data frame on the x-axis, and the “lifeExp”
column on the y-axis. Notice that we didn’t need to explicitly pass
<code>aes</code> these columns
(e.g. <code>x = gapminder[, "gdpPercap"]</code>), this is because
<code>ggplot</code> is smart enough to know to look in the
<strong>data</strong> for that column!</p>
<p>The final part of making our plot is to tell <code>ggplot</code> how
we want to visually represent the data. We do this by adding a new
<strong>layer</strong> to the plot using one of the
<strong>geom</strong> functions.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lifeExp-vs-gdpPercap-scatter-1.png" alt="Scatter plot of life expectancy vs GDP per capita, now showing the data points." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Here we used <code>geom_point</code>, which tells <code>ggplot</code>
we want to visually represent the relationship between
<strong>x</strong> and <strong>y</strong> as a scatterplot of
points.</p>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1</h3>
<div class="callout-content">
<p>Modify the example so that the figure shows how life expectancy has
changed over time:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>Hint: the gapminder dataset has a column called “year”, which should
appear on the x-axis.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Here is one possible solution:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="../fig/08-plot-ggplot2-rendered-ch1-sol-1.png" alt="Binned scatterplot of life expectancy versus year showing how life expectancy has increased over time" class="figure mx-auto d-block"><figcaption>
Binned scatterplot of life expectancy versus year showing how life
expectancy has increased over time
</figcaption></figure>
</div>
</div>
</div>
</div>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2</h3>
<div class="callout-content">
<p>In the previous examples and challenge we’ve used the
<code>aes</code> function to tell the scatterplot <strong>geom</strong>
about the <strong>x</strong> and <strong>y</strong> locations of each
point. Another <em>aesthetic</em> property we can modify is the point
<em>color</em>. Modify the code from the previous challenge to
<strong>color</strong> the points by the “continent” column. What trends
do you see in the data? Are they what you expected?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>The solution presented below adds <code>color=continent</code> to the
call of the <code>aes</code> function. The general trend seems to
indicate an increased life expectancy over the years. On continents with
stronger economies we find a longer life expectancy.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="../fig/08-plot-ggplot2-rendered-ch2-sol-1.png" alt="Binned scatterplot of life expectancy vs year with color-coded continents showing value of 'aes' function" class="figure mx-auto d-block"><figcaption>
Binned scatterplot of life expectancy vs year with color-coded
continents showing value of ‘aes’ function
</figcaption></figure>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="layers">Layers<a class="anchor" aria-label="anchor" href="#layers"></a>
</h2>
<hr class="half-width">
<p>Using a scatterplot probably isn’t the best for visualizing change
over time. Instead, let’s tell <code>ggplot</code> to visualize the data
as a line plot:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">lifeExp</span>, color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lifeExp-line-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Instead of adding a <code>geom_point</code> layer, we’ve added a
<code>geom_line</code> layer.</p>
<p>However, the result doesn’t look quite as we might have expected: it
seems to be jumping around a lot in each continent. Let’s try to
separate the data by country, plotting one line for each country:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">lifeExp</span>, group<span class="op">=</span><span class="va">country</span>, color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lifeExp-line-by-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We’ve added the <strong>group</strong> <em>aesthetic</em>, which
tells <code>ggplot</code> to draw a line for each country.</p>
<p>But what if we want to visualize both lines and points on the plot?
We can add another layer to the plot:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">lifeExp</span>, group<span class="op">=</span><span class="va">country</span>, color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lifeExp-line-point-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>It’s important to note that each layer is drawn on top of the
previous layer. In this example, the points have been drawn <em>on top
of</em> the lines. Here’s a demonstration:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">lifeExp</span>, group<span class="op">=</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lifeExp-layer-example-1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>In this example, the <em>aesthetic</em> mapping of
<strong>color</strong> has been moved from the global plot options in
<code>ggplot</code> to the <code>geom_line</code> layer so it no longer
applies to the points. Now we can clearly see that the points are drawn
on top of the lines.</p>
<div id="tip-setting-an-aesthetic-to-a-value-instead-of-a-mapping" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-setting-an-aesthetic-to-a-value-instead-of-a-mapping" class="callout-inner">
<h3 class="callout-title">Tip: Setting an aesthetic to a value instead of a mapping</h3>
<div class="callout-content">
<p>So far, we’ve seen how to use an aesthetic (such as
<strong>color</strong>) as a <em>mapping</em> to a variable in the data.
For example, when we use
<code>geom_line(mapping = aes(color=continent))</code>, ggplot will give
a different color to each continent. But what if we want to change the
color of all lines to blue? You may think that
<code>geom_line(mapping = aes(color="blue"))</code> should work, but it
doesn’t. Since we don’t want to create a mapping to a specific variable,
we can move the color specification outside of the <code>aes()</code>
function, like this: <code>geom_line(color="blue")</code>.</p>
</div>
</div>
</div>
<div id="challenge-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3</h3>
<div class="callout-content">
<p>Switch the order of the point and line layers from the previous
example. What happened?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Solution to challenge 3
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>The lines now get drawn over the points!</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">lifeExp</span>, group<span class="op">=</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-ch3-sol-1.png" alt="Scatter plot of life expectancy vs GDP per capita with a trend line summarising the relationship between variables. The plot illustrates the possibilities for styling visualisations in ggplot2 with data points enlarged, coloured orange, and displayed without transparency." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="transformations-and-statistics">Transformations and statistics<a class="anchor" aria-label="anchor" href="#transformations-and-statistics"></a>
</h2>
<hr class="half-width">
<p>ggplot2 also makes it easy to overlay statistical models over the
data. To demonstrate we’ll go back to our first example:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lifeExp-vs-gdpPercap-scatter3-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Currently it’s hard to see the relationship between the points due to
some strong outliers in GDP per capita. We can change the scale of units
on the x axis using the <em>scale</em> functions. These control the
mapping between the data values and visual values of an aesthetic. We
can also modify the transparency of the points, using the <em>alpha</em>
function, which is especially helpful when you have a large amount of
data which is very clustered.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="../fig/08-plot-ggplot2-rendered-axis-scale-1.png" alt="Scatterplot of GDP vs life expectancy showing logarithmic x-axis data spread" class="figure mx-auto d-block"><figcaption>
Scatterplot of GDP vs life expectancy showing logarithmic x-axis data
spread
</figcaption></figure><p>The <code>scale_x_log10</code> function applied a transformation to
the coordinate system of the plot, so that each multiple of 10 is evenly
spaced from left to right. For example, a GDP per capita of 1,000 is the
same horizontal distance away from a value of 10,000 as the 10,000 value
is from 100,000. This helps to visualize the spread of the data along
the x-axis.</p>
<div id="tip-reminder-setting-an-aesthetic-to-a-value-instead-of-a-mapping" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-reminder-setting-an-aesthetic-to-a-value-instead-of-a-mapping" class="callout-inner">
<h3 class="callout-title">Tip Reminder: Setting an aesthetic to a value instead of a mapping</h3>
<div class="callout-content">
<p>Notice that we used <code>geom_point(alpha = 0.5)</code>. As the
previous tip mentioned, using a setting outside of the
<code>aes()</code> function will cause this value to be used for all
points, which is what we want in this case. But just like any other
aesthetic setting, <em>alpha</em> can also be mapped to a variable in
the data. For example, we can give a different transparency to each
continent with
<code>geom_point(mapping = aes(alpha = continent))</code>.</p>
</div>
</div>
</div>
<p>We can fit a simple relationship to the data by adding another layer,
<code>geom_smooth</code>:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_smooth</span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lm-fit-1.png" alt="Scatter plot of life expectancy vs GDP per capita with a blue trend line summarising the relationship between variables, and gray shaded area indicating 95% confidence intervals for that trend line." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can make the line thicker by <em>setting</em> the
<strong>linewidth</strong> aesthetic in the <code>geom_smooth</code>
layer:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_smooth</span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lm-fit2-1.png" alt="Scatter plot of life expectancy vs GDP per capita with a trend line summarising the relationship between variables. The blue trend line is slightly thicker than in the previous figure." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>There are two ways an <em>aesthetic</em> can be specified. Here we
<em>set</em> the <strong>linewidth</strong> aesthetic by passing it as
an argument to <code>geom_smooth</code> and it is applied the same to
the whole <code>geom</code>. Previously in the lesson we’ve used the
<code>aes</code> function to define a <em>mapping</em> between data
variables and their visual representation.</p>
<div id="challenge-4a" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4a" class="callout-inner">
<h3 class="callout-title">Challenge 4a</h3>
<div class="callout-content">
<p>Modify the color and size of the points on the point layer in the
previous example.</p>
<p>Hint: do not use the <code>aes</code> function.</p>
<p>Hint: the equivalent of <code>linewidth</code> for points is
<code>size</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Solution to challenge 4a
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>Here a possible solution: Notice that the <code>color</code> argument
is supplied outside of the <code>aes()</code> function. This means that
it applies to all data points on the graph and is not related to a
specific variable.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span>, color<span class="op">=</span><span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_smooth</span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-ch4a-sol-1.png" alt="Scatter plot of life expectancy vs GDP per capita with a trend line summarising the relationship between variables. The plot illustrates the possibilities for styling visualisations in ggplot2 with data points enlarged, coloured orange, and displayed without transparency." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="challenge-4b" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4b" class="callout-inner">
<h3 class="callout-title">Challenge 4b</h3>
<div class="callout-content">
<p>Modify your solution to Challenge 4a so that the points are now a
different shape and are colored by continent with new trendlines. Hint:
The color argument can be used inside the aesthetic.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  Solution to challenge 4b
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<p>Here is a possible solution: Notice that supplying the
<code>color</code> argument inside the <code>aes()</code> functions
enables you to connect it to a certain variable. The <code>shape</code>
argument, as you can see, modifies all data points the same way (it is
outside the <code>aes()</code> call) while the <code>color</code>
argument which is placed inside the <code>aes()</code> call modifies a
point’s color based on its continent value.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span>, shape<span class="op">=</span><span class="fl">17</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_smooth</span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-ch4b-sol-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="multi-panel-figures">Multi-panel figures<a class="anchor" aria-label="anchor" href="#multi-panel-figures"></a>
</h2>
<hr class="half-width">
<p>Earlier we visualized the change in life expectancy over time across
all countries in one plot. Alternatively, we can split this out over
multiple panels by adding a layer of <strong>facet</strong> panels.</p>
<div id="tip" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip" class="callout-inner">
<h3 class="callout-title">Tip</h3>
<div class="callout-content">
<p>We start by making a subset of data including only countries located
in the Americas. This includes 25 countries, which will begin to clutter
the figure. Note that we apply a “theme” definition to rotate the x-axis
labels to maintain readability. Nearly everything in ggplot2 is
customizable.</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">americas</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span>,<span class="op">]</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">americas</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">country</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-facet-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The <code>facet_wrap</code> layer took a “formula” as its argument,
denoted by the tilde (~). This tells R to draw a panel for each unique
value in the country column of the gapminder dataset.</p>
</section><section><h2 class="section-heading" id="modifying-text">Modifying text<a class="anchor" aria-label="anchor" href="#modifying-text"></a>
</h2>
<hr class="half-width">
<p>To clean this figure up for a publication we need to change some of
the text elements. The x-axis is too cluttered, and the y axis should
read “Life expectancy”, rather than the column name in the data
frame.</p>
<p>We can do this by adding a couple of different layers. The
<strong>theme</strong> layer controls the axis text, and overall text
size. Labels for the axes, plot title and any legend can be set using
the <code>labs</code> function. Legend titles are set using the same
names we used in the <code>aes</code> specification. Thus below the
color legend title is set using <code>color = "Continent"</code>, while
the title of a fill legend would be set using
<code>fill = "MyTitle"</code>.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">americas</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">country</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,              <span class="co"># x axis title</span></span>
<span>    y <span class="op">=</span> <span class="st">"Life expectancy"</span>,   <span class="co"># y axis title</span></span>
<span>    title <span class="op">=</span> <span class="st">"Figure 1"</span>,      <span class="co"># main title of figure</span></span>
<span>    color <span class="op">=</span> <span class="st">"Continent"</span>      <span class="co"># title of legend</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-theme-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="exporting-the-plot">Exporting the plot<a class="anchor" aria-label="anchor" href="#exporting-the-plot"></a>
</h2>
<hr class="half-width">
<p>The <code>ggsave()</code> function allows you to export a plot
created with ggplot. You can specify the dimension and resolution of
your plot by adjusting the appropriate arguments (<code>width</code>,
<code>height</code> and <code>dpi</code>) to create high quality
graphics for publication. In order to save the plot from above, we first
assign it to a variable <code>lifeExp_plot</code>, then tell
<code>ggsave</code> to save that plot in <code>png</code> format to a
directory called <code>results</code>. (Make sure you have a
<code>results/</code> folder in your working directory.)</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeExp_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">americas</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">country</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,              <span class="co"># x axis title</span></span>
<span>    y <span class="op">=</span> <span class="st">"Life expectancy"</span>,   <span class="co"># y axis title</span></span>
<span>    title <span class="op">=</span> <span class="st">"Figure 1"</span>,      <span class="co"># main title of figure</span></span>
<span>    color <span class="op">=</span> <span class="st">"Continent"</span>      <span class="co"># title of legend</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggsave</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"results/lifeExp.png"</span>, plot <span class="op">=</span> <span class="va">lifeExp_plot</span>, width <span class="op">=</span> <span class="fl">12</span>, height <span class="op">=</span> <span class="fl">10</span>, dpi <span class="op">=</span> <span class="fl">300</span>, units <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span></span></code></pre>
</div>
<p>There are two nice things about <code>ggsave</code>. First, it
defaults to the last plot, so if you omit the <code>plot</code> argument
it will automatically save the last plot you created with
<code>ggplot</code>. Secondly, it tries to determine the format you want
to save your plot in from the file extension you provide for the
filename (for example <code>.png</code> or <code>.pdf</code>). If you
need to, you can specify the format explicitly in the
<code>device</code> argument.</p>
<p>This is a taste of what you can do with ggplot2. RStudio provides a
really useful <a href="https://www.rstudio.org/links/data_visualization_cheat_sheet" class="external-link">cheat
sheet</a> of the different layers available, and more extensive
documentation is available on the <a href="https://ggplot2.tidyverse.org/reference/" class="external-link">ggplot2 website</a>. All
RStudio cheat sheets are available from the <a href="https://www.rstudio.com/resources/cheatsheets/" class="external-link">RStudio
website</a>. Finally, if you have no idea how to change something, a
quick Google search will usually send you to a relevant question and
answer on Stack Overflow with reusable code to modify!</p>
<div id="challenge-5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-5" class="callout-inner">
<h3 class="callout-title">Challenge 5</h3>
<div class="callout-content">
<p>Generate boxplots to compare life expectancy between the different
continents during the available years.</p>
<p>Advanced:</p>
<ul>
<li>Rename y axis as Life Expectancy.</li>
<li>Remove x axis labels.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">
  Solution to Challenge 5
  </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<p>Here a possible solution: <code>xlab()</code> and <code>ylab()</code>
set labels for the x and y axes, respectively The axis title, text and
ticks are attributes of the theme and must be modified within a
<code>theme()</code> call.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">continent</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, fill <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Life Expectancy"</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">theme</span><span class="op">(</span>axis.title.x<span class="op">=</span><span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       axis.ticks.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-ch5-sol-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>ggplot2</code> to create plots.</li>
<li>Think about graphics in layers: aesthetics, geometry, statistics,
scale transformation, and grouping.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-09-vectorization"><p>Content from <a href="09-vectorization.html">Vectorization</a></p>
<hr>
<p>Last updated on 2024-11-26 |

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/episodes/09-vectorization.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 25 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I operate on all the elements of a vector at once?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>To understand vectorized operations in R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Most of R’s functions are vectorized, meaning that the function will
operate on all elements of a vector without needing to loop through and
act on each element one at a time. This makes writing code more concise,
easy to read, and less error prone.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span>
<span><span class="va">x</span> <span class="op">*</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2 4 6 8</code></pre>
</div>
<p>The multiplication happened to each element of the vector.</p>
<p>We can also add two vectors together:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">6</span><span class="op">:</span><span class="fl">9</span></span>
<span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  7  9 11 13</code></pre>
</div>
<p>Each element of <code>x</code> was added to its corresponding element
of <code>y</code>:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>x<span class="sc">:</span>  <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">4</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    <span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>y<span class="sc">:</span>  <span class="dv">6</span>  <span class="dv">7</span>  <span class="dv">8</span>  <span class="dv">9</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="sc">---------------</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    <span class="dv">7</span>  <span class="dv">9</span> <span class="dv">11</span> <span class="dv">13</span></span></code></pre>
</div>
<p>Here is how we would add two vectors together using a for loop:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output_vector</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">output_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  7  9 11 13</code></pre>
</div>
<p>Compare this to the output using vectorised operations.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sum_xy</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span>
<span><span class="va">sum_xy</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  7  9 11 13</code></pre>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1</h3>
<div class="callout-content">
<p>Let’s try this on the <code>pop</code> column of the
<code>gapminder</code> dataset.</p>
<p>Make a new column in the <code>gapminder</code> data frame that
contains population in units of millions of people. Check the head or
tail of the data frame to make sure it worked.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Let’s try this on the <code>pop</code> column of the
<code>gapminder</code> dataset.</p>
<p>Make a new column in the <code>gapminder</code> data frame that
contains population in units of millions of people. Check the head or
tail of the data frame to make sure it worked.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">$</span><span class="va">pop_millions</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">$</span><span class="va">pop</span> <span class="op">/</span> <span class="fl">1e6</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap pop_millions
1 Afghanistan 1952  8425333      Asia  28.801  779.4453     8.425333
2 Afghanistan 1957  9240934      Asia  30.332  820.8530     9.240934
3 Afghanistan 1962 10267083      Asia  31.997  853.1007    10.267083
4 Afghanistan 1967 11537966      Asia  34.020  836.1971    11.537966
5 Afghanistan 1972 13079460      Asia  36.088  739.9811    13.079460
6 Afghanistan 1977 14880372      Asia  38.438  786.1134    14.880372</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2</h3>
<div class="callout-content">
<p>On a single graph, plot population, in millions, against year, for
all countries. Do not worry about identifying which country is
which.</p>
<p>Repeat the exercise, graphing only for China, India, and Indonesia.
Again, do not worry about which is which.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Refresh your plotting skills by plotting population in millions
against year.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">gapminder</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">pop_millions</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/09-vectorization-rendered-ch2-sol-1.png" alt="Scatter plot showing populations in the millions against the year for China, India, and Indonesia, countries are not labeled." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">countryset</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"China"</span>,<span class="st">"India"</span>,<span class="st">"Indonesia"</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span> <span class="op">%in%</span> <span class="va">countryset</span>,<span class="op">]</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">pop_millions</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/09-vectorization-rendered-ch2-sol-2.png" alt="Scatter plot showing populations in the millions against the year for China, India, and Indonesia, countries are not labeled." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>Comparison operators, logical operators, and many functions are also
vectorized:</p>
<p><strong>Comparison operators</strong></p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE FALSE  TRUE  TRUE</code></pre>
</div>
<p><strong>Logical operators</strong></p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">3</span>  <span class="co"># or, for clarity, a &lt;- (x &gt; 3)</span></span>
<span><span class="va">a</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE FALSE FALSE  TRUE</code></pre>
</div>
<div id="tip-some-useful-functions-for-logical-vectors" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-some-useful-functions-for-logical-vectors" class="callout-inner">
<h3 class="callout-title">Tip: some useful functions for logical vectors</h3>
<div class="callout-content">
<p><code>any()</code> will return <code>TRUE</code> if <em>any</em>
element of a vector is <code>TRUE</code>.<br><code>all()</code> will return <code>TRUE</code> if <em>all</em>
elements of a vector are <code>TRUE</code>.</p>
</div>
</div>
</div>
<p>Most functions also operate element-wise on vectors:</p>
<p><strong>Functions</strong></p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span>
<span><span class="fu">log</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.0000000 0.6931472 1.0986123 1.3862944</code></pre>
</div>
<p>Vectorized operations work element-wise on matrices:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, nrow<span class="op">=</span><span class="fl">3</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3] [,4]
[1,]   -1   -4   -7  -10
[2,]   -2   -5   -8  -11
[3,]   -3   -6   -9  -12</code></pre>
</div>
<div id="tip-element-wise-vs.-matrix-multiplication" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-element-wise-vs.-matrix-multiplication" class="callout-inner">
<h3 class="callout-title">Tip: element-wise vs. matrix multiplication</h3>
<div class="callout-content">
<p>Very important: the operator <code>*</code> gives you element-wise
multiplication! To do matrix multiplication, we need to use the
<code>%*%</code> operator:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">%*%</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span>, nrow<span class="op">=</span><span class="fl">4</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1]
[1,]   22
[2,]   26
[3,]   30</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">%*%</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1]
[1,]   30</code></pre>
</div>
<p>For more on matrix algebra, see the <a href="https://www.statmethods.net/advstats/matrix.html" class="external-link">Quick-R
reference guide</a></p>
</div>
</div>
</div>
<div id="challenge-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3</h3>
<div class="callout-content">
<p>Given the following matrix:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, nrow<span class="op">=</span><span class="fl">3</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">m</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3] [,4]
[1,]    1    4    7   10
[2,]    2    5    8   11
[3,]    3    6    9   12</code></pre>
</div>
<p>Write down what you think will happen when you run:</p>
<ol style="list-style-type: decimal">
<li><code>m ^ -1</code></li>
<li><code>m * c(1, 0, -1)</code></li>
<li><code>m &gt; c(0, 20)</code></li>
<li><code>m * c(1, 0, -1, 2)</code></li>
</ol>
<p>Did you get the output you expected? If not, ask a helper!</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Solution to challenge 3
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>Given the following matrix:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, nrow<span class="op">=</span><span class="fl">3</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">m</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3] [,4]
[1,]    1    4    7   10
[2,]    2    5    8   11
[3,]    3    6    9   12</code></pre>
</div>
<p>Write down what you think will happen when you run:</p>
<ol style="list-style-type: decimal">
<li><code>m ^ -1</code></li>
</ol>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>          [,1]      [,2]      [,3]       [,4]
[1,] 1.0000000 0.2500000 0.1428571 0.10000000
[2,] 0.5000000 0.2000000 0.1250000 0.09090909
[3,] 0.3333333 0.1666667 0.1111111 0.08333333</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li><code>m * c(1, 0, -1)</code></li>
</ol>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3] [,4]
[1,]    1    4    7   10
[2,]    0    0    0    0
[3,]   -3   -6   -9  -12</code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li><code>m &gt; c(0, 20)</code></li>
</ol>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      [,1]  [,2]  [,3]  [,4]
[1,]  TRUE FALSE  TRUE FALSE
[2,] FALSE  TRUE FALSE  TRUE
[3,]  TRUE FALSE  TRUE FALSE</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4" class="callout-inner">
<h3 class="callout-title">Challenge 4</h3>
<div class="callout-content">
<p>We’re interested in looking at the sum of the following sequence of
fractions:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">3</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">...</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<p>This would be tedious to type out, and impossible for high values of
n. Use vectorisation to compute x when n=100. What is the sum when
n=10,000?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Challenge 4
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>We’re interested in looking at the sum of the following sequence of
fractions:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">3</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">...</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<p>This would be tedious to type out, and impossible for high values of
n. Can you use vectorisation to compute x, when n=100? How about when
n=10,000?</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sum</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.634984</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sum</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1e04</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.644834</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="fu">sum</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.644834</code></pre>
</div>
<p>We can also obtain the same results using a function:</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inverse_sum_of_squares</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">sum</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">inverse_sum_of_squares</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.634984</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">inverse_sum_of_squares</span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.644834</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="fu">inverse_sum_of_squares</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.644834</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="tip-operations-on-vectors-of-unequal-length" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-operations-on-vectors-of-unequal-length" class="callout-inner">
<h3 class="callout-title">Tip: Operations on vectors of unequal length</h3>
<div class="callout-content">
<p>Operations can also be performed on vectors of unequal length,
through a process known as <em>recycling</em>. This process
automatically repeats the smaller vector until it matches the length of
the larger vector. R will provide a warning if the larger vector is not
a multiple of the smaller vector.</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning in x + y: longer object length is not a multiple of shorter object
length</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2 4 6 5 7 9 8</code></pre>
</div>
<p>Vector <code>x</code> was recycled to match the length of vector
<code>y</code></p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a>x<span class="sc">:</span>  <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">1</span></span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a>    <span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a>y<span class="sc">:</span>  <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">4</span>  <span class="dv">5</span>  <span class="dv">6</span>  <span class="dv">7</span></span>
<span id="cb50-4"><a href="#cb50-4" tabindex="-1"></a><span class="sc">-----------------------</span></span>
<span id="cb50-5"><a href="#cb50-5" tabindex="-1"></a>    <span class="dv">2</span>  <span class="dv">4</span>  <span class="dv">6</span>  <span class="dv">5</span>  <span class="dv">7</span>  <span class="dv">9</span>  <span class="dv">8</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use vectorized operations instead of loops.</li>
</ul>
</div>
</div>
</div></section><section id="aio-10-functions"><p>Content from <a href="10-functions.html">Functions Explained</a></p>
<hr>
<p>Last updated on 2024-11-26 |

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/episodes/10-functions.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 60 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I write a new function in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Define a function that takes arguments.</li>
<li>Return a value from a function.</li>
<li>Check argument conditions with <code>stopifnot()</code> in
functions.</li>
<li>Test a function.</li>
<li>Set default values for function arguments.</li>
<li>Explain why we should divide programs into small, single-purpose
functions.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>If we only had one data set to analyze, it would probably be faster
to load the file into a spreadsheet and use that to plot simple
statistics. However, the gapminder data is updated periodically, and we
may want to pull in that new information later and re-run our analysis
again. We may also obtain similar data from a different source in the
future.</p>
<p>In this lesson, we’ll learn how to write a function so that we can
repeat several operations with a single command.</p>
<div id="what-is-a-function" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="what-is-a-function" class="callout-inner">
<h3 class="callout-title">What is a function?</h3>
<div class="callout-content">
<p>Functions gather a sequence of operations into a whole, preserving it
for ongoing use. Functions provide:</p>
<ul>
<li>a name we can remember and invoke it by</li>
<li>relief from the need to remember the individual operations</li>
<li>a defined set of inputs and expected outputs</li>
<li>rich connections to the larger programming environment</li>
</ul>
<p>As the basic building block of most programming languages,
user-defined functions constitute “programming” as much as any single
abstraction can. If you have written a function, you are a computer
programmer.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="defining-a-function">Defining a function<a class="anchor" aria-label="anchor" href="#defining-a-function"></a>
</h2>
<hr class="half-width">
<p>Let’s open a new R script file in the <code>functions/</code>
directory and call it functions-lesson.R.</p>
<p>The general structure of a function is:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># perform action</span></span>
<span>  <span class="co"># return value</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Let’s define a function <code>fahr_to_kelvin()</code> that converts
temperatures from Fahrenheit to Kelvin:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fahr_to_kelvin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">kelvin</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">temp</span> <span class="op">-</span> <span class="fl">32</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">5</span> <span class="op">/</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">273.15</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">kelvin</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>We define <code>fahr_to_kelvin()</code> by assigning it to the output
of <code>function</code>. The list of argument names are contained
within parentheses. Next, the <a href="reference.html#body">body</a> of
the function–the statements that are executed when it runs–is contained
within curly braces (<code>{}</code>). The statements in the body are
indented by two spaces. This makes the code easier to read but does not
affect how the code operates.</p>
<p>It is useful to think of creating functions like writing a cookbook.
First you define the “ingredients” that your function needs. In this
case, we only need one ingredient to use our function: “temp”. After we
list our ingredients, we then say what we will do with them, in this
case, we are taking our ingredient and applying a set of mathematical
operators to it.</p>
<p>When we call the function, the values we pass to it as arguments are
assigned to those variables so that we can use them inside the function.
Inside the function, we use a <a href="reference.html#return-statement">return statement</a> to send a
result back to whoever asked for it.</p>
<div id="tip" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip" class="callout-inner">
<h3 class="callout-title">Tip</h3>
<div class="callout-content">
<p>One feature unique to R is that the return statement is not required.
R automatically returns whichever variable is on the last line of the
body of the function. But for clarity, we will explicitly define the
return statement.</p>
</div>
</div>
</div>
<p>Let’s try running our function. Calling our own function is no
different from calling any other function:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># freezing point of water</span></span>
<span><span class="fu">fahr_to_kelvin</span><span class="op">(</span><span class="fl">32</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 273.15</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># boiling point of water</span></span>
<span><span class="fu">fahr_to_kelvin</span><span class="op">(</span><span class="fl">212</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 373.15</code></pre>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1</h3>
<div class="callout-content">
<p>Write a function called <code>kelvin_to_celsius()</code> that takes a
temperature in Kelvin and returns that temperature in Celsius.</p>
<p>Hint: To convert from Kelvin to Celsius you subtract 273.15</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Write a function called <code>kelvin_to_celsius</code> that takes a
temperature in Kelvin and returns that temperature in Celsius</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kelvin_to_celsius</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="va">celsius</span> <span class="op">&lt;-</span> <span class="va">temp</span> <span class="op">-</span> <span class="fl">273.15</span></span>
<span> <span class="kw">return</span><span class="op">(</span><span class="va">celsius</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="combining-functions">Combining functions<a class="anchor" aria-label="anchor" href="#combining-functions"></a>
</h2>
<hr class="half-width">
<p>The real power of functions comes from mixing, matching and combining
them into ever-larger chunks to get the effect we want.</p>
<p>Let’s define two functions that will convert temperature from
Fahrenheit to Kelvin, and Kelvin to Celsius:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fahr_to_kelvin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">kelvin</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">temp</span> <span class="op">-</span> <span class="fl">32</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">5</span> <span class="op">/</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">273.15</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">kelvin</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">kelvin_to_celsius</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">celsius</span> <span class="op">&lt;-</span> <span class="va">temp</span> <span class="op">-</span> <span class="fl">273.15</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">celsius</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2</h3>
<div class="callout-content">
<p>Define the function to convert directly from Fahrenheit to Celsius,
by reusing the two functions above (or using your own functions if you
prefer).</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Define the function to convert directly from Fahrenheit to Celsius,
by reusing these two functions above</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fahr_to_celsius</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">temp_k</span> <span class="op">&lt;-</span> <span class="fu">fahr_to_kelvin</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">kelvin_to_celsius</span><span class="op">(</span><span class="va">temp_k</span><span class="op">)</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="interlude-defensive-programming">Interlude: Defensive Programming<a class="anchor" aria-label="anchor" href="#interlude-defensive-programming"></a>
</h2>
<hr class="half-width">
<p>Now that we’ve begun to appreciate how writing functions provides an
efficient way to make R code re-usable and modular, we should note that
it is important to ensure that functions only work in their intended
use-cases. Checking function parameters is related to the concept of
<em>defensive programming</em>. Defensive programming encourages us to
frequently check conditions and throw an error if something is wrong.
These checks are referred to as assertion statements because we want to
assert some condition is <code>TRUE</code> before proceeding. They make
it easier to debug because they give us a better idea of where the
errors originate.</p>
<div class="section level3">
<h3 id="checking-conditions-with-stopifnot">Checking conditions with <code>stopifnot()</code>
<a class="anchor" aria-label="anchor" href="#checking-conditions-with-stopifnot"></a>
</h3>
<p>Let’s start by re-examining <code>fahr_to_kelvin()</code>, our
function for converting temperatures from Fahrenheit to Kelvin. It was
defined like so:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fahr_to_kelvin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">kelvin</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">temp</span> <span class="op">-</span> <span class="fl">32</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">5</span> <span class="op">/</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">273.15</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">kelvin</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>For this function to work as intended, the argument <code>temp</code>
must be a <code>numeric</code> value; otherwise, the mathematical
procedure for converting between the two temperature scales will not
work. To create an error, we can use the function <code>stop()</code>.
For example, since the argument <code>temp</code> must be a
<code>numeric</code> vector, we could check for this condition with an
<code>if</code> statement and throw an error if the condition was
violated. We could augment our function above like so:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fahr_to_kelvin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu">is.numeric</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">stop</span><span class="op">(</span><span class="st">"temp must be a numeric vector."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">kelvin</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">temp</span> <span class="op">-</span> <span class="fl">32</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">5</span> <span class="op">/</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">273.15</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">kelvin</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>If we had multiple conditions or arguments to check, it would take
many lines of code to check all of them. Luckily R provides the
convenience function <code>stopifnot()</code>. We can list as many
requirements that should evaluate to <code>TRUE</code>;
<code>stopifnot()</code> throws an error if it finds one that is
<code>FALSE</code>. Listing these conditions also serves a secondary
purpose as extra documentation for the function.</p>
<p>Let’s try out defensive programming with <code>stopifnot()</code> by
adding assertions to check the input to our function
<code>fahr_to_kelvin()</code>.</p>
<p>We want to assert the following: <code>temp</code> is a numeric
vector. We may do that like so:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fahr_to_kelvin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">stopifnot</span><span class="op">(</span><span class="fu">is.numeric</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">kelvin</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">temp</span> <span class="op">-</span> <span class="fl">32</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">5</span> <span class="op">/</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">273.15</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">kelvin</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>It still works when given proper input.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># freezing point of water</span></span>
<span><span class="fu">fahr_to_kelvin</span><span class="op">(</span>temp <span class="op">=</span> <span class="fl">32</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 273.15</code></pre>
</div>
<p>But fails instantly if given improper input.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Metric is a factor instead of numeric</span></span>
<span><span class="fu">fahr_to_kelvin</span><span class="op">(</span>temp <span class="op">=</span> <span class="fu">as.factor</span><span class="op">(</span><span class="fl">32</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in fahr_to_kelvin(temp = as.factor(32)): is.numeric(temp) is not TRUE</code></pre>
</div>
<div id="challenge-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3</h3>
<div class="callout-content">
<p>Use defensive programming to ensure that our
<code>fahr_to_celsius()</code> function throws an error immediately if
the argument <code>temp</code> is specified inappropriately.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Solution to challenge 3
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>Extend our previous definition of the function by adding in an
explicit call to <code>stopifnot()</code>. Since
<code>fahr_to_celsius()</code> is a composition of two other functions,
checking inside here makes adding checks to the two component functions
redundant.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fahr_to_celsius</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">stopifnot</span><span class="op">(</span><span class="fu">is.numeric</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">temp_k</span> <span class="op">&lt;-</span> <span class="fu">fahr_to_kelvin</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">kelvin_to_celsius</span><span class="op">(</span><span class="va">temp_k</span><span class="op">)</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="more-on-combining-functions">More on combining functions<a class="anchor" aria-label="anchor" href="#more-on-combining-functions"></a>
</h2>
<hr class="half-width">
<p>Now, we’re going to define a function that calculates the Gross
Domestic Product of a nation from the data available in our dataset:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Takes a dataset and multiplies the population column</span></span>
<span><span class="co"># with the GDP per capita column.</span></span>
<span><span class="va">calcGDP</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">gdp</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">pop</span> <span class="op">*</span> <span class="va">dat</span><span class="op">$</span><span class="va">gdpPercap</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">gdp</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>We define <code>calcGDP()</code> by assigning it to the output of
<code>function</code>. The list of argument names are contained within
parentheses. Next, the body of the function -- the statements executed
when you call the function – is contained within curly braces
(<code>{}</code>).</p>
<p>We’ve indented the statements in the body by two spaces. This makes
the code easier to read but does not affect how it operates.</p>
<p>When we call the function, the values we pass to it are assigned to
the arguments, which become variables inside the body of the
function.</p>
<p>Inside the function, we use the <code>return()</code> function to
send back the result. This <code>return()</code> function is optional: R
will automatically return the results of whatever command is executed on
the last line of the function.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">calcGDP</span><span class="op">(</span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  6567086330  7585448670  8758855797  9648014150  9678553274 11697659231</code></pre>
</div>
<p>That’s not very informative. Let’s add some more arguments so we can
extract that per year and country.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Takes a dataset and multiplies the population column</span></span>
<span><span class="co"># with the GDP per capita column.</span></span>
<span><span class="va">calcGDP</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>, <span class="va">year</span><span class="op">=</span><span class="cn">NULL</span>, <span class="va">country</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu">is.null</span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">year</span> <span class="op">%in%</span> <span class="va">year</span>, <span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu">is.null</span><span class="op">(</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">country</span> <span class="op">%in%</span> <span class="va">country</span>,<span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">gdp</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">pop</span> <span class="op">*</span> <span class="va">dat</span><span class="op">$</span><span class="va">gdpPercap</span></span>
<span></span>
<span>  <span class="va">new</span> <span class="op">&lt;-</span> <span class="fu">cbind</span><span class="op">(</span><span class="va">dat</span>, gdp<span class="op">=</span><span class="va">gdp</span><span class="op">)</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">new</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>If you’ve been writing these functions down into a separate R script
(a good idea!), you can load in the functions into our R session by
using the <code>source()</code> function:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">source</span><span class="op">(</span><span class="st">"functions/functions-lesson.R"</span><span class="op">)</span></span></code></pre>
</div>
<p>Ok, so there’s a lot going on in this function now. In plain English,
the function now subsets the provided data by year if the year argument
isn’t empty, then subsets the result by country if the country argument
isn’t empty. Then it calculates the GDP for whatever subset emerges from
the previous two steps. The function then adds the GDP as a new column
to the subsetted data and returns this as the final result. You can see
that the output is much more informative than a vector of numbers.</p>
<p>Let’s take a look at what happens when we specify the year:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="fu">calcGDP</span><span class="op">(</span><span class="va">gapminder</span>, year<span class="op">=</span><span class="fl">2007</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>       country year      pop continent lifeExp  gdpPercap          gdp
12 Afghanistan 2007 31889923      Asia  43.828   974.5803  31079291949
24     Albania 2007  3600523    Europe  76.423  5937.0295  21376411360
36     Algeria 2007 33333216    Africa  72.301  6223.3675 207444851958
48      Angola 2007 12420476    Africa  42.731  4797.2313  59583895818
60   Argentina 2007 40301927  Americas  75.320 12779.3796 515033625357
72   Australia 2007 20434176   Oceania  81.235 34435.3674 703658358894</code></pre>
</div>
<p>Or for a specific country:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">calcGDP</span><span class="op">(</span><span class="va">gapminder</span>, country<span class="op">=</span><span class="st">"Australia"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     country year      pop continent lifeExp gdpPercap          gdp
61 Australia 1952  8691212   Oceania  69.120  10039.60  87256254102
62 Australia 1957  9712569   Oceania  70.330  10949.65 106349227169
63 Australia 1962 10794968   Oceania  70.930  12217.23 131884573002
64 Australia 1967 11872264   Oceania  71.100  14526.12 172457986742
65 Australia 1972 13177000   Oceania  71.930  16788.63 221223770658
66 Australia 1977 14074100   Oceania  73.490  18334.20 258037329175
67 Australia 1982 15184200   Oceania  74.740  19477.01 295742804309
68 Australia 1987 16257249   Oceania  76.320  21888.89 355853119294
69 Australia 1992 17481977   Oceania  77.560  23424.77 409511234952
70 Australia 1997 18565243   Oceania  78.830  26997.94 501223252921
71 Australia 2002 19546792   Oceania  80.370  30687.75 599847158654
72 Australia 2007 20434176   Oceania  81.235  34435.37 703658358894</code></pre>
</div>
<p>Or both:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">calcGDP</span><span class="op">(</span><span class="va">gapminder</span>, year<span class="op">=</span><span class="fl">2007</span>, country<span class="op">=</span><span class="st">"Australia"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     country year      pop continent lifeExp gdpPercap          gdp
72 Australia 2007 20434176   Oceania  81.235  34435.37 703658358894</code></pre>
</div>
<p>Let’s walk through the body of the function:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>calcGDP <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, <span class="at">year=</span><span class="cn">NULL</span>, <span class="at">country=</span><span class="cn">NULL</span>) {</span></code></pre>
</div>
<p>Here we’ve added two arguments, <code>year</code>, and
<code>country</code>. We’ve set <em>default arguments</em> for both as
<code>NULL</code> using the <code>=</code> operator in the function
definition. This means that those arguments will take on those values
unless the user specifies otherwise.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu">is.null</span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">year</span> <span class="op">%in%</span> <span class="va">year</span>, <span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu">is.null</span><span class="op">(</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">country</span> <span class="op">%in%</span> <span class="va">country</span>,<span class="op">]</span></span>
<span>  <span class="op">}</span></span></code></pre>
</div>
<p>Here, we check whether each additional argument is set to
<code>null</code>, and whenever they’re not <code>null</code> overwrite
the dataset stored in <code>dat</code> with a subset given by the
non-<code>null</code> argument.</p>
<p>Building these conditionals into the function makes it more flexible
for later. Now, we can use it to calculate the GDP for:</p>
<ul>
<li>The whole dataset;</li>
<li>A single year;</li>
<li>A single country;</li>
<li>A single combination of year and country.</li>
</ul>
<p>By using <code>%in%</code> instead, we can also give multiple years
or countries to those arguments.</p>
<div id="tip-pass-by-value" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-pass-by-value" class="callout-inner">
<h3 class="callout-title">Tip: Pass by value</h3>
<div class="callout-content">
<p>Functions in R almost always make copies of the data to operate on
inside of a function body. When we modify <code>dat</code> inside the
function we are modifying the copy of the gapminder dataset stored in
<code>dat</code>, not the original variable we gave as the first
argument.</p>
<p>This is called “pass-by-value” and it makes writing code much safer:
you can always be sure that whatever changes you make within the body of
the function, stay inside the body of the function.</p>
</div>
</div>
</div>
<div id="tip-function-scope" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-function-scope" class="callout-inner">
<h3 class="callout-title">Tip: Function scope</h3>
<div class="callout-content">
<p>Another important concept is scoping: any variables (or functions!)
you create or modify inside the body of a function only exist for the
lifetime of the function’s execution. When we call
<code>calcGDP()</code>, the variables <code>dat</code>, <code>gdp</code>
and <code>new</code> only exist inside the body of the function. Even if
we have variables of the same name in our interactive R session, they
are not modified in any way when executing a function.</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>  gdp <span class="ot">&lt;-</span> dat<span class="sc">$</span>pop <span class="sc">*</span> dat<span class="sc">$</span>gdpPercap</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>  new <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dat, <span class="at">gdp=</span>gdp)</span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>  <span class="fu">return</span>(new)</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a><span class="er">}</span></span></code></pre>
</div>
<p>Finally, we calculated the GDP on our new subset, and created a new
data frame with that column added. This means when we call the function
later we can see the context for the returned GDP values, which is much
better than in our first attempt where we got a vector of numbers.</p>
<div id="challenge-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4" class="callout-inner">
<h3 class="callout-title">Challenge 4</h3>
<div class="callout-content">
<p>Test out your GDP function by calculating the GDP for New Zealand in
1987. How does this differ from New Zealand’s GDP in 1952?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Solution to challenge 4
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu">calcGDP</span><span class="op">(</span><span class="va">gapminder</span>, year <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1952</span>, <span class="fl">1987</span><span class="op">)</span>, country <span class="op">=</span> <span class="st">"New Zealand"</span><span class="op">)</span></span></code></pre>
</div>
<p>GDP for New Zealand in 1987: 65050008703</p>
<p>GDP for New Zealand in 1952: 21058193787</p>
</div>
</div>
</div>
</div>
<div id="challenge-5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-5" class="callout-inner">
<h3 class="callout-title">Challenge 5</h3>
<div class="callout-content">
<p>The <code>paste()</code> function can be used to combine text
together, e.g:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_practice</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Write"</span>, <span class="st">"programs"</span>, <span class="st">"for"</span>, <span class="st">"people"</span>, <span class="st">"not"</span>, <span class="st">"computers"</span><span class="op">)</span></span>
<span><span class="fu">paste</span><span class="op">(</span><span class="va">best_practice</span>, collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Write programs for people not computers"</code></pre>
</div>
<p>Write a function called <code>fence()</code> that takes two vectors
as arguments, called <code>text</code> and <code>wrapper</code>, and
prints out the text wrapped with the <code>wrapper</code>:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fence</span><span class="op">(</span>text<span class="op">=</span><span class="va">best_practice</span>, wrapper<span class="op">=</span><span class="st">"***"</span><span class="op">)</span></span></code></pre>
</div>
<p><em>Note:</em> the <code>paste()</code> function has an argument
called <code>sep</code>, which specifies the separator between text. The
default is a space: ” “. The default for <code>paste0()</code> is no
space”“.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  Solution to challenge 5
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<p>Write a function called <code>fence()</code> that takes two vectors
as arguments, called <code>text</code> and <code>wrapper</code>, and
prints out the text wrapped with the <code>wrapper</code>:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fence</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">text</span>, <span class="va">wrapper</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">text</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">wrapper</span>, <span class="va">text</span>, <span class="va">wrapper</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">paste</span><span class="op">(</span><span class="va">text</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">best_practice</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Write"</span>, <span class="st">"programs"</span>, <span class="st">"for"</span>, <span class="st">"people"</span>, <span class="st">"not"</span>, <span class="st">"computers"</span><span class="op">)</span></span>
<span><span class="fu">fence</span><span class="op">(</span>text<span class="op">=</span><span class="va">best_practice</span>, wrapper<span class="op">=</span><span class="st">"***"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "*** Write programs for people not computers ***"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="tip-1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-1" class="callout-inner">
<h3 class="callout-title">Tip</h3>
<div class="callout-content">
<p>R has some unique aspects that can be exploited when performing more
complicated operations. We will not be writing anything that requires
knowledge of these more advanced concepts. In the future when you are
comfortable writing functions in R, you can learn more by reading the <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Environment-objects" class="external-link">R
Language Manual</a> or this <a href="https://adv-r.had.co.nz/Environments.html" class="external-link">chapter</a> from <a href="https://adv-r.had.co.nz/" class="external-link">Advanced R Programming</a> by Hadley
Wickham.</p>
</div>
</div>
</div>
<div id="tip-testing-and-documenting" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-testing-and-documenting" class="callout-inner">
<h3 class="callout-title">Tip: Testing and documenting</h3>
<div class="callout-content">
<p>It’s important to both test functions and document them:
Documentation helps you, and others, understand what the purpose of your
function is, and how to use it, and its important to make sure that your
function actually does what you think.</p>
<p>When you first start out, your workflow will probably look a lot like
this:</p>
<ol style="list-style-type: decimal">
<li>Write a function</li>
<li>Comment parts of the function to document its behaviour</li>
<li>Load in the source file</li>
<li>Experiment with it in the console to make sure it behaves as you
expect</li>
<li>Make any necessary bug fixes</li>
<li>Rinse and repeat.</li>
</ol>
<p>Formal documentation for functions, written in separate
<code>.Rd</code> files, gets turned into the documentation you see in
help files. The <a href="https://cran.r-project.org/web/packages/roxygen2/vignettes/rd.html" class="external-link">roxygen2</a>
package allows R coders to write documentation alongside the function
code and then process it into the appropriate <code>.Rd</code> files.
You will want to switch to this more formal method of writing
documentation when you start writing more complicated R projects. In
fact, packages are, in essence, bundles of functions with this formal
documentation. Loading your own functions through
<code>source("functions.R")</code> is equivalent to loading someone
else’s functions (or your own one day!) through
<code>library("package")</code>.</p>
<p>Formal automated tests can be written using the <a href="https://r-pkgs.had.co.nz/tests.html" class="external-link">testthat</a> package.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>function</code> to define a new function in R.</li>
<li>Use parameters to pass values into functions.</li>
<li>Use <code>stopifnot()</code> to flexibly check function arguments in
R.</li>
<li>Load functions into programs using <code>source()</code>.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-11-writing-data"><p>Content from <a href="11-writing-data.html">Writing Data</a></p>
<hr>
<p>Last updated on 2024-11-26 |

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/episodes/11-writing-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I save plots and data created in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>To be able to write out plots and data from R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="saving-plots">Saving plots<a class="anchor" aria-label="anchor" href="#saving-plots"></a>
</h2>
<hr class="half-width">
<p>You have already seen how to save the most recent plot you create in
<code>ggplot2</code>, using the command <code>ggsave</code>. As a
refresher:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"My_most_recent_plot.pdf"</span><span class="op">)</span></span></code></pre>
</div>
<p>You can save a plot from within RStudio using the ‘Export’ button in
the ‘Plot’ window. This will give you the option of saving as a .pdf or
as .png, .jpg or other image formats.</p>
<p>Sometimes you will want to save plots without creating them in the
‘Plot’ window first. Perhaps you want to make a pdf document with
multiple pages: each one a different plot, for example. Or perhaps
you’re looping through multiple subsets of a file, plotting data from
each subset, and you want to save each plot, but obviously can’t stop
the loop to click ‘Export’ for each one.</p>
<p>In this case you can use a more flexible approach. The function
<code>pdf</code> creates a new pdf device. You can control the size and
resolution using the arguments to this function.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pdf</span><span class="op">(</span><span class="st">"Life_Exp_vs_time.pdf"</span>, width<span class="op">=</span><span class="fl">12</span>, height<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data<span class="op">=</span><span class="va">gapminder</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">lifeExp</span>, colour<span class="op">=</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># You then have to make sure to turn off the pdf device!</span></span>
<span></span>
<span><span class="fu">dev.off</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>Open up this document and have a look.</p>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1</h3>
<div class="callout-content">
<p>Rewrite your ‘pdf’ command to print a second page in the pdf, showing
a facet plot (hint: use <code>facet_grid</code>) of the same data with
one panel per continent.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pdf</span><span class="op">(</span><span class="st">"Life_Exp_vs_time.pdf"</span>, width <span class="op">=</span> <span class="fl">12</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, colour <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">p</span></span>
<span><span class="va">p</span> <span class="op">+</span> <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="va">continent</span><span class="op">)</span></span>
<span><span class="fu">dev.off</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The commands <code>jpeg</code>, <code>png</code> etc. are used
similarly to produce documents in different formats.</p>
</section><section><h2 class="section-heading" id="writing-data">Writing data<a class="anchor" aria-label="anchor" href="#writing-data"></a>
</h2>
<hr class="half-width">
<p>At some point, you’ll also want to write out data from R.</p>
<p>We can use the <code>write.table</code> function for this, which is
very similar to <code>read.table</code> from before.</p>
<p>Let’s create a data-cleaning script, for this analysis, we only want
to focus on the gapminder data for Australia:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aust_subset</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Australia"</span>,<span class="op">]</span></span>
<span></span>
<span><span class="fu">write.table</span><span class="op">(</span><span class="va">aust_subset</span>,</span>
<span>  file<span class="op">=</span><span class="st">"cleaned-data/gapminder-aus.csv"</span>,</span>
<span>  sep<span class="op">=</span><span class="st">","</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s switch back to the shell to take a look at the data to make
sure it looks OK:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">head</span> cleaned-data/gapminder-aus.csv</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>"country","year","pop","continent","lifeExp","gdpPercap"
"61","Australia",1952,8691212,"Oceania",69.12,10039.59564
"62","Australia",1957,9712569,"Oceania",70.33,10949.64959
"63","Australia",1962,10794968,"Oceania",70.93,12217.22686
"64","Australia",1967,11872264,"Oceania",71.1,14526.12465
"65","Australia",1972,13177000,"Oceania",71.93,16788.62948
"66","Australia",1977,14074100,"Oceania",73.49,18334.19751
"67","Australia",1982,15184200,"Oceania",74.74,19477.00928
"68","Australia",1987,16257249,"Oceania",76.32,21888.88903
"69","Australia",1992,17481977,"Oceania",77.56,23424.76683</code></pre>
</div>
<p>Hmm, that’s not quite what we wanted. Where did all these quotation
marks come from? Also the row numbers are meaningless.</p>
<p>Let’s look at the help file to work out how to change this
behaviour.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">write.table</span></span></code></pre>
</div>
<p>By default R will wrap character vectors with quotation marks when
writing out to file. It will also write out the row and column
names.</p>
<p>Let’s fix this:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write.table</span><span class="op">(</span></span>
<span>  <span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Australia"</span>,<span class="op">]</span>,</span>
<span>  file<span class="op">=</span><span class="st">"cleaned-data/gapminder-aus.csv"</span>,</span>
<span>  sep<span class="op">=</span><span class="st">","</span>, quote<span class="op">=</span><span class="cn">FALSE</span>, row.names<span class="op">=</span><span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>Now lets look at the data again using our shell skills:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">head</span> cleaned-data/gapminder-aus.csv</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>country,year,pop,continent,lifeExp,gdpPercap
Australia,1952,8691212,Oceania,69.12,10039.59564
Australia,1957,9712569,Oceania,70.33,10949.64959
Australia,1962,10794968,Oceania,70.93,12217.22686
Australia,1967,11872264,Oceania,71.1,14526.12465
Australia,1972,13177000,Oceania,71.93,16788.62948
Australia,1977,14074100,Oceania,73.49,18334.19751
Australia,1982,15184200,Oceania,74.74,19477.00928
Australia,1987,16257249,Oceania,76.32,21888.88903
Australia,1992,17481977,Oceania,77.56,23424.76683</code></pre>
</div>
<p>That looks better!</p>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2</h3>
<div class="callout-content">
<p>Write a data-cleaning script file that subsets the gapminder data to
include only data points collected since 1990.</p>
<p>Use this script to write out the new subset to a file in the
<code>cleaned-data/</code> directory.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write.table</span><span class="op">(</span></span>
<span>  <span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">1990</span>, <span class="op">]</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"cleaned-data/gapminder-after1990.csv"</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">","</span>, quote <span class="op">=</span> <span class="cn">FALSE</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Save plots from RStudio using the ‘Export’ button.</li>
<li>Use <code>write.table</code> to save tabular data.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-12-dplyr"><p>Content from <a href="12-dplyr.html">Data Frame Manipulation with dplyr</a></p>
<hr>
<p>Last updated on 2024-11-26 |

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/episodes/12-dplyr.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 55 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I manipulate data frames without repeating myself?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>To be able to use the six main data frame manipulation ‘verbs’ with
pipes in <code>dplyr</code>.</li>
<li>To understand how <code>group_by()</code> and
<code>summarize()</code> can be combined to summarize datasets.</li>
<li>Be able to analyze a subset of data using logical filtering.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Manipulation of data frames means many things to many researchers: we
often select certain observations (rows) or variables (columns), we
often group the data by a certain variable(s), or we even calculate
summary statistics. We can do these operations using the normal base R
operations:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">gdpPercap</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Africa"</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2193.755</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">gdpPercap</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 7136.11</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">gdpPercap</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Asia"</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 7902.15</code></pre>
</div>
<p>But this isn’t very <em>nice</em> because there is a fair bit of
repetition. Repeating yourself will cost you time, both now and later,
and potentially introduce some nasty bugs.</p>
<section><h2 class="section-heading" id="the-dplyr-package">The <code>dplyr</code> package<a class="anchor" aria-label="anchor" href="#the-dplyr-package"></a>
</h2>
<hr class="half-width">
<p>Luckily, the <a href="https://cran.r-project.org/package=dplyr" class="external-link"><code>dplyr</code></a>
package provides a number of very useful functions for manipulating data
frames in a way that will reduce the above repetition, reduce the
probability of making errors, and probably even save you some typing. As
an added bonus, you might even find the <code>dplyr</code> grammar
easier to read.</p>
<div id="tip-tidyverse" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-tidyverse" class="callout-inner">
<h3 class="callout-title">Tip: Tidyverse</h3>
<div class="callout-content">
<p><code>dplyr</code> package belongs to a broader family of opinionated
R packages designed for data science called the “Tidyverse”. These
packages are specifically designed to work harmoniously together. Some
of these packages will be covered along this course, but you can find
more complete information here: <a href="https://www.tidyverse.org/" class="external-link">https://www.tidyverse.org/</a>.</p>
</div>
</div>
</div>
<p>Here we’re going to cover 5 of the most commonly used functions as
well as using pipes (<code>%&gt;%</code>) to combine them.</p>
<ol style="list-style-type: decimal">
<li><code>select()</code></li>
<li><code>filter()</code></li>
<li><code>group_by()</code></li>
<li><code>summarize()</code></li>
<li><code>mutate()</code></li>
</ol>
<p>If you have have not installed this package earlier, please do
so:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">'dplyr'</span><span class="op">)</span></span></code></pre>
</div>
<p>Now let’s load the package:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="using-select">Using select()<a class="anchor" aria-label="anchor" href="#using-select"></a>
</h2>
<hr class="half-width">
<p>If, for example, we wanted to move forward with only a few of the
variables in our data frame we could use the <code>select()</code>
function. This will keep only the variables you select.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/13-dplyr-fig1.png" alt="Diagram illustrating use of select function to select two columns of a data frame" class="figure">
If we want to remove one column only from the <code>gapminder</code>
data, for example, removing the <code>continent</code> column.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smaller_gapminder_data</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">gapminder</span>, <span class="op">-</span><span class="va">continent</span><span class="op">)</span></span></code></pre>
</div>
<p>If we open up <code>year_country_gdp</code> we’ll see that it only
contains the year, country and gdpPercap. Above we used ‘normal’
grammar, but the strengths of <code>dplyr</code> lie in combining
several functions using pipes. Since the pipes grammar is unlike
anything we’ve seen in R before, let’s repeat what we’ve done above
using pipes.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span></span></code></pre>
</div>
<p>To help you understand why we wrote that in that way, let’s walk
through it step by step. First we summon the gapminder data frame and
pass it on, using the pipe symbol <code>%&gt;%</code>, to the next step,
which is the <code>select()</code> function. In this case we don’t
specify which data object we use in the <code>select()</code> function
since in gets that from the previous pipe. <strong>Fun Fact</strong>:
There is a good chance you have encountered pipes before in the shell.
In R, a pipe symbol is <code>%&gt;%</code> while in the shell it is
<code>|</code> but the concept is the same!</p>
<div id="tip-renaming-data-frame-columns-in-dplyr" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-renaming-data-frame-columns-in-dplyr" class="callout-inner">
<h3 class="callout-title">Tip: Renaming data frame columns in dplyr</h3>
<div class="callout-content">
<p>In Chapter 4 we covered how you can rename columns with base R by
assigning a value to the output of the <code>names()</code> function.
Just like select, this is a bit cumbersome, but thankfully dplyr has a
<code>rename()</code> function.</p>
<p>Within a pipeline, the syntax is
<code>rename(new_name = old_name)</code>. For example, we may want to
rename the gdpPercap column name from our <code>select()</code>
statement above.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_gdp</span> <span class="op">&lt;-</span> <span class="va">year_country_gdp</span> <span class="op">%&gt;%</span> <span class="fu">rename</span><span class="op">(</span>gdp_per_capita <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">tidy_gdp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  year     country gdp_per_capita
1 1952 Afghanistan       779.4453
2 1957 Afghanistan       820.8530
3 1962 Afghanistan       853.1007
4 1967 Afghanistan       836.1971
5 1972 Afghanistan       739.9811
6 1977 Afghanistan       786.1134</code></pre>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="using-filter">Using filter()<a class="anchor" aria-label="anchor" href="#using-filter"></a>
</h2>
<hr class="half-width">
<p>If we now want to move forward with the above, but only with European
countries, we can combine <code>select</code> and
<code>filter</code></p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp_euro</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Europe"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span></span></code></pre>
</div>
<p>If we now want to show life expectancy of European countries but only
for a specific year (e.g., 2007), we can do as below.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">europe_lifeExp_2007</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Europe"</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">country</span>, <span class="va">lifeExp</span><span class="op">)</span></span></code></pre>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1</h3>
<div class="callout-content">
<p>Write a single command (which can span multiple lines and includes
pipes) that will produce a data frame that has the African values for
<code>lifeExp</code>, <code>country</code> and <code>year</code>, but
not for other Continents. How many rows does your data frame have and
why?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to Challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_lifeExp_Africa</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>                           <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Africa"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                           <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">country</span>, <span class="va">lifeExp</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>As with last time, first we pass the gapminder data frame to the
<code>filter()</code> function, then we pass the filtered version of the
gapminder data frame to the <code>select()</code> function.
<strong>Note:</strong> The order of operations is very important in this
case. If we used ‘select’ first, filter would not be able to find the
variable continent since we would have removed it in the previous
step.</p>
</section><section><h2 class="section-heading" id="using-group_by">Using group_by()<a class="anchor" aria-label="anchor" href="#using-group_by"></a>
</h2>
<hr class="half-width">
<p>Now, we were supposed to be reducing the error prone repetitiveness
of what can be done with base R, but up to now we haven’t done that
since we would have to repeat the above for each continent. Instead of
<code>filter()</code>, which will only pass observations that meet your
criteria (in the above: <code>continent=="Europe"</code>), we can use
<code>group_by()</code>, which will essentially use every unique
criteria that you could have used in filter.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	1704 obs. of  6 variables:
 $ country  : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr  "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num  779 821 853 836 740 ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>gropd_df [1,704 × 6] (S3: grouped_df/tbl_df/tbl/data.frame)
 $ country  : chr [1:1704] "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int [1:1704] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num [1:1704] 8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr [1:1704] "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num [1:1704] 779 821 853 836 740 ...
 - attr(*, "groups")= tibble [5 × 2] (S3: tbl_df/tbl/data.frame)
  ..$ continent: chr [1:5] "Africa" "Americas" "Asia" "Europe" ...
  ..$ .rows    : list&lt;int&gt; [1:5]
  .. ..$ : int [1:624] 25 26 27 28 29 30 31 32 33 34 ...
  .. ..$ : int [1:300] 49 50 51 52 53 54 55 56 57 58 ...
  .. ..$ : int [1:396] 1 2 3 4 5 6 7 8 9 10 ...
  .. ..$ : int [1:360] 13 14 15 16 17 18 19 20 21 22 ...
  .. ..$ : int [1:24] 61 62 63 64 65 66 67 68 69 70 ...
  .. ..@ ptype: int(0)
  ..- attr(*, ".drop")= logi TRUE</code></pre>
</div>
<p>You will notice that the structure of the data frame where we used
<code>group_by()</code> (<code>grouped_df</code>) is not the same as the
original <code>gapminder</code> (<code>data.frame</code>). A
<code>grouped_df</code> can be thought of as a <code>list</code> where
each item in the <code>list</code>is a <code>data.frame</code> which
contains only the rows that correspond to the a particular value
<code>continent</code> (at least in the example above).</p>
<figure><img src="../fig/13-dplyr-fig2.png" alt="Diagram illustrating how the group by function oraganizes a data frame into groups" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="using-summarize">Using summarize()<a class="anchor" aria-label="anchor" href="#using-summarize"></a>
</h2>
<hr class="half-width">
<p>The above was a bit on the uneventful side but
<code>group_by()</code> is much more exciting in conjunction with
<code>summarize()</code>. This will allow us to create new variable(s)
by using functions that repeat for each of the continent-specific data
frames. That is to say, using the <code>group_by()</code> function, we
split our original data frame into multiple pieces, then we can run
functions (e.g. <code>mean()</code> or <code>sd()</code>) within
<code>summarize()</code>.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_bycontinents</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/13-dplyr-fig3.png" alt="Diagram illustrating the use of group by and summarize together to create a new variable" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>continent mean_gdpPercap</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>     <span class="sc">&lt;</span>fctr<span class="sc">&gt;</span>          <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="dv">1</span>    Africa       <span class="fl">2193.755</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="dv">2</span>  Americas       <span class="fl">7136.110</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="dv">3</span>      Asia       <span class="fl">7902.150</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="dv">4</span>    Europe      <span class="fl">14469.476</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a><span class="dv">5</span>   Oceania      <span class="fl">18621.609</span></span></code></pre>
</div>
<p>That allowed us to calculate the mean gdpPercap for each continent,
but it gets even better.</p>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2</h3>
<div class="callout-content">
<p>Calculate the average life expectancy per country. Which has the
longest average life expectancy and which has the shortest average life
expectancy?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to Challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeExp_bycountry</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">group_by</span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">summarize</span><span class="op">(</span>mean_lifeExp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lifeExp_bycountry</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">filter</span><span class="op">(</span><span class="va">mean_lifeExp</span> <span class="op">==</span> <span class="fu">min</span><span class="op">(</span><span class="va">mean_lifeExp</span><span class="op">)</span> <span class="op">|</span> <span class="va">mean_lifeExp</span> <span class="op">==</span> <span class="fu">max</span><span class="op">(</span><span class="va">mean_lifeExp</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 2 × 2
  country      mean_lifeExp
  &lt;chr&gt;               &lt;dbl&gt;
1 Iceland              76.5
2 Sierra Leone         36.8</code></pre>
</div>
<p>Another way to do this is to use the <code>dplyr</code> function
<code>arrange()</code>, which arranges the rows in a data frame
according to the order of one or more variables from the data frame. It
has similar syntax to other functions from the <code>dplyr</code>
package. You can use <code>desc()</code> inside <code>arrange()</code>
to sort in descending order.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeExp_bycountry</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">arrange</span><span class="op">(</span><span class="va">mean_lifeExp</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">head</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 2
  country      mean_lifeExp
  &lt;chr&gt;               &lt;dbl&gt;
1 Sierra Leone         36.8</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeExp_bycountry</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">mean_lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">head</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 2
  country mean_lifeExp
  &lt;chr&gt;          &lt;dbl&gt;
1 Iceland         76.5</code></pre>
</div>
<p>Alphabetical order works too</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeExp_bycountry</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">head</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 2
  country  mean_lifeExp
  &lt;chr&gt;           &lt;dbl&gt;
1 Zimbabwe         52.7</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The function <code>group_by()</code> allows us to group by multiple
variables. Let’s group by <code>year</code> and
<code>continent</code>.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_bycontinents_byyear</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<p>That is already quite powerful, but it gets even better! You’re not
limited to defining 1 new variable in <code>summarize()</code>.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_pop_bycontinents_byyear</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>              sd_gdpPercap <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>              mean_pop <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>              sd_pop <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
</section><section><h2 class="section-heading" id="count-and-n">count() and n()<a class="anchor" aria-label="anchor" href="#count-and-n"></a>
</h2>
<hr class="half-width">
<p>A very common operation is to count the number of observations for
each group. The <code>dplyr</code> package comes with two related
functions that help with this.</p>
<p>For instance, if we wanted to check the number of countries included
in the dataset for the year 2002, we can use the <code>count()</code>
function. It takes the name of one or more columns that contain the
groups we are interested in, and we can optionally sort the results in
descending order by adding <code>sort=TRUE</code>:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="va">continent</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  continent  n
1    Africa 52
2      Asia 33
3    Europe 30
4  Americas 25
5   Oceania  2</code></pre>
</div>
<p>If we need to use the number of observations in calculations, the
<code>n()</code> function is useful. It will return the total number of
observations in the current group rather than counting the number of
observations in each group within a specific column. For instance, if we
wanted to get the standard error of the life expectency per
continent:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>se_le <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">/</span><span class="fu">sqrt</span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 5 × 2
  continent se_le
  &lt;chr&gt;     &lt;dbl&gt;
1 Africa    0.366
2 Americas  0.540
3 Asia      0.596
4 Europe    0.286
5 Oceania   0.775</code></pre>
</div>
<p>You can also chain together several summary operations; in this case
calculating the <code>minimum</code>, <code>maximum</code>,
<code>mean</code> and <code>se</code> of each continent’s per-country
life-expectancy:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span></span>
<span>      mean_le <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>      min_le <span class="op">=</span> <span class="fu">min</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>      max_le <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>      se_le <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">/</span><span class="fu">sqrt</span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 5 × 5
  continent mean_le min_le max_le se_le
  &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 Africa       48.9   23.6   76.4 0.366
2 Americas     64.7   37.6   80.7 0.540
3 Asia         60.1   28.8   82.6 0.596
4 Europe       71.9   43.6   81.8 0.286
5 Oceania      74.3   69.1   81.2 0.775</code></pre>
</div>
</section><section><h2 class="section-heading" id="using-mutate">Using mutate()<a class="anchor" aria-label="anchor" href="#using-mutate"></a>
</h2>
<hr class="half-width">
<p>We can also create new variables prior to (or even after) summarizing
information using <code>mutate()</code>.</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_pop_bycontinents_byyear</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>gdp_billion <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">*</span><span class="va">pop</span><span class="op">/</span><span class="fl">10</span><span class="op">^</span><span class="fl">9</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>,<span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>              sd_gdpPercap <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>              mean_pop <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>              sd_pop <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>              mean_gdp_billion <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdp_billion</span><span class="op">)</span>,</span>
<span>              sd_gdp_billion <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">gdp_billion</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
</section><section><h2 class="section-heading" id="connect-mutate-with-logical-filtering-ifelse">Connect mutate with logical filtering: ifelse<a class="anchor" aria-label="anchor" href="#connect-mutate-with-logical-filtering-ifelse"></a>
</h2>
<hr class="half-width">
<p>When creating new variables, we can hook this with a logical
condition. A simple combination of <code>mutate()</code> and
<code>ifelse()</code> facilitates filtering right where it is needed: in
the moment of creating something new. This easy-to-read statement is a
fast and powerful way of discarding certain data (even though the
overall dimension of the data frame will not change) or for updating
values depending on this given condition.</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## keeping all data but "filtering" after a certain condition</span></span>
<span><span class="co"># calculate GDP only for people with a life expectation above 25</span></span>
<span><span class="va">gdp_pop_bycontinents_byyear_above25</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>gdp_billion <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">25</span>, <span class="va">gdpPercap</span> <span class="op">*</span> <span class="va">pop</span> <span class="op">/</span> <span class="fl">10</span><span class="op">^</span><span class="fl">9</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>              sd_gdpPercap <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>              mean_pop <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>              sd_pop <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>              mean_gdp_billion <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdp_billion</span><span class="op">)</span>,</span>
<span>              sd_gdp_billion <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">gdp_billion</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## updating only if certain condition is fullfilled</span></span>
<span><span class="co"># for life expectations above 40 years, the gpd to be expected in the future is scaled</span></span>
<span><span class="va">gdp_future_bycontinents_byyear_high_lifeExp</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>gdp_futureExpectation <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">40</span>, <span class="va">gdpPercap</span> <span class="op">*</span> <span class="fl">1.5</span>, <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>              mean_gdpPercap_expected <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdp_futureExpectation</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
</section><section><h2 class="section-heading" id="combining-dplyr-and-ggplot2">Combining <code>dplyr</code> and <code>ggplot2</code>
<a class="anchor" aria-label="anchor" href="#combining-dplyr-and-ggplot2"></a>
</h2>
<hr class="half-width">
<p>First install and load ggplot2:</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">'ggplot2'</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span></code></pre>
</div>
<p>In the plotting lesson we looked at how to make a multi-panel figure
by adding a layer of facet panels using <code>ggplot2</code>. Here is
the code we used (with some extra comments):</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter countries located in the Americas</span></span>
<span><span class="va">americas</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span>, <span class="op">]</span></span>
<span><span class="co"># Make the plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">americas</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">country</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/12-dplyr-rendered-unnamed-chunk-27-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>This code makes the right plot but it also creates an intermediate
variable (<code>americas</code>) that we might not have any other uses
for. Just as we used <code>%&gt;%</code> to pipe data along a chain of
<code>dplyr</code> functions we can use it to pass data to
<code>ggplot()</code>. Because <code>%&gt;%</code> replaces the first
argument in a function we don’t need to specify the <code>data =</code>
argument in the <code>ggplot()</code> function. By combining
<code>dplyr</code> and <code>ggplot2</code> functions we can make the
same figure without creating any new variables or modifying the
data.</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Filter countries located in the Americas</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Make the plot</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">country</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/12-dplyr-rendered-unnamed-chunk-28-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>More examples of using the function <code>mutate()</code> and the
<code>ggplot2</code> package.</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># extract first letter of country name into new column</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>startsWith <span class="op">=</span> <span class="fu">substr</span><span class="op">(</span><span class="va">country</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># only keep countries starting with A or Z</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">startsWith</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"Z"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># plot lifeExp into facets</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, colour <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/12-dplyr-rendered-unnamed-chunk-29-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="advanced-challenge" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="advanced-challenge" class="callout-inner">
<h3 class="callout-title">Advanced Challenge</h3>
<div class="callout-content">
<p>Calculate the average life expectancy in 2002 of 2 randomly selected
countries for each continent. Then arrange the continent names in
reverse order. <strong>Hint:</strong> Use the <code>dplyr</code>
functions <code>arrange()</code> and <code>sample_n()</code>, they have
similar syntax to other dplyr functions.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Solution to Advanced Challenge
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeExp_2countries_bycontinents</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">filter</span><span class="op">(</span><span class="va">year</span><span class="op">==</span><span class="fl">2002</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">sample_n</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">summarize</span><span class="op">(</span>mean_lifeExp<span class="op">=</span><span class="fu">mean</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">mean_lifeExp</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="other-great-resources">Other great resources<a class="anchor" aria-label="anchor" href="#other-great-resources"></a>
</h2>
<hr class="half-width">
<ul>
<li>
<a href="https://r4ds.hadley.nz/" class="external-link">R for Data Science</a> (online
book)</li>
<li>
<a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="external-link">Data
Wrangling Cheat sheet</a> (pdf file)</li>
<li>
<a href="https://dplyr.tidyverse.org/" class="external-link">Introduction to dplyr</a>
(online documentation)</li>
<li>
<a href="https://www.rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/" class="external-link">Data
wrangling with R and RStudio</a> (online video)</li>
<li>
<a href="https://jhudatascience.org/tidyversecourse/" class="external-link">Tidyverse
Skills for Data Science</a> (online book)</li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use the <code>dplyr</code> package to manipulate data frames.</li>
<li>Use <code>select()</code> to choose variables from a data
frame.</li>
<li>Use <code>filter()</code> to choose data based on values.</li>
<li>Use <code>group_by()</code> and <code>summarize()</code> to work
with subsets of data.</li>
<li>Use <code>mutate()</code> to create new variables.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-13-tidyr"><p>Content from <a href="13-tidyr.html">Data Frame Manipulation with tidyr</a></p>
<hr>
<p>Last updated on 2024-11-26 |

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/episodes/13-tidyr.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 45 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I change the layout of a data frame?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>To understand the concepts of ‘longer’ and ‘wider’ data frame
formats and be able to convert between them with
<code>tidyr</code>.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Researchers often want to reshape their data frames from ‘wide’ to
‘longer’ layouts, or vice-versa. The ‘long’ layout or format is
where:</p>
<ul>
<li>each column is a variable</li>
<li>each row is an observation</li>
</ul>
<p>In the purely ‘long’ (or ‘longest’) format, you usually have 1 column
for the observed variable and the other columns are ID variables.</p>
<p>For the ‘wide’ format each row is often a site/subject/patient and
you have multiple observation variables containing the same type of
data. These can be either repeated observations over time, or
observation of multiple variables (or a mix of both). You may find data
input may be simpler or some other applications may prefer the ‘wide’
format. However, many of <code>R</code>‘s functions have been designed
assuming you have ’longer’ formatted data. This tutorial will help you
efficiently transform your data shape regardless of original format.</p>
<figure><img src="../fig/14-tidyr-fig1.png" alt="Diagram illustrating the difference between a wide versus long layout of a data frame" class="figure mx-auto d-block"></figure><p>Long and wide data frame layouts mainly affect readability. For
humans, the wide format is often more intuitive since we can often see
more of the data on the screen due to its shape. However, the long
format is more machine readable and is closer to the formatting of
databases. The ID variables in our data frames are similar to the fields
in a database and observed variables are like the database values.</p>
<section><h2 class="section-heading" id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<hr class="half-width">
<p>First install the packages if you haven’t already done so (you
probably installed dplyr in the previous lesson):</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install.packages("tidyr")</span></span>
<span><span class="co">#install.packages("dplyr")</span></span></code></pre>
</div>
<p>Load the packages</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"tidyr"</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span></span></code></pre>
</div>
<p>First, lets look at the structure of our original gapminder data
frame:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	1704 obs. of  6 variables:
 $ country  : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr  "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num  779 821 853 836 740 ...</code></pre>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1</h3>
<div class="callout-content">
<p>Is gapminder a purely long, purely wide, or some intermediate
format?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to Challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>The original gapminder data.frame is in an intermediate format. It is
not purely long since it had multiple observation variables
(<code>pop</code>,<code>lifeExp</code>,<code>gdpPercap</code>).</p>
</div>
</div>
</div>
</div>
<p>Sometimes, as with the gapminder dataset, we have multiple types of
observed data. It is somewhere in between the purely ‘long’ and ‘wide’
data formats. We have 3 “ID variables” (<code>continent</code>,
<code>country</code>, <code>year</code>) and 3 “Observation variables”
(<code>pop</code>,<code>lifeExp</code>,<code>gdpPercap</code>). This
intermediate format can be preferred despite not having ALL observations
in 1 column given that all 3 observation variables have different units.
There are few operations that would need us to make this data frame any
longer (i.e. 4 ID variables and 1 Observation variable).</p>
<p>While using many of the functions in R, which are often vector based,
you usually do not want to do mathematical operations on values with
different units. For example, using the purely long format, a single
mean for all of the values of population, life expectancy, and GDP would
not be meaningful since it would return the mean of values with 3
incompatible units. The solution is that we first manipulate the data
either by grouping (see the lesson on <code>dplyr</code>), or we change
the structure of the data frame. <strong>Note:</strong> Some plotting
functions in R actually work better in the wide format data.</p>
</section><section><h2 class="section-heading" id="from-wide-to-long-format-with-pivot_longer">From wide to long format with pivot_longer()<a class="anchor" aria-label="anchor" href="#from-wide-to-long-format-with-pivot_longer"></a>
</h2>
<hr class="half-width">
<p>Until now, we’ve been using the nicely formatted original gapminder
dataset, but ‘real’ data (i.e. our own research data) will never be so
well organized. Here let’s start with the wide formatted version of the
gapminder dataset.</p>
<blockquote>
<p>Download the wide version of the gapminder data from <a href="../data/gapminder_wide.csv">this link to a csv file</a> and save it
in your data folder.</p>
</blockquote>
<p>We’ll load the data file and look at it. Note: we don’t want our
continent and country columns to be factors, so we use the
stringsAsFactors argument for <code>read.csv()</code> to disable
that.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_wide</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_wide.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gap_wide</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	142 obs. of  38 variables:
 $ continent     : chr  "Africa" "Africa" "Africa" "Africa" ...
 $ country       : chr  "Algeria" "Angola" "Benin" "Botswana" ...
 $ gdpPercap_1952: num  2449 3521 1063 851 543 ...
 $ gdpPercap_1957: num  3014 3828 960 918 617 ...
 $ gdpPercap_1962: num  2551 4269 949 984 723 ...
 $ gdpPercap_1967: num  3247 5523 1036 1215 795 ...
 $ gdpPercap_1972: num  4183 5473 1086 2264 855 ...
 $ gdpPercap_1977: num  4910 3009 1029 3215 743 ...
 $ gdpPercap_1982: num  5745 2757 1278 4551 807 ...
 $ gdpPercap_1987: num  5681 2430 1226 6206 912 ...
 $ gdpPercap_1992: num  5023 2628 1191 7954 932 ...
 $ gdpPercap_1997: num  4797 2277 1233 8647 946 ...
 $ gdpPercap_2002: num  5288 2773 1373 11004 1038 ...
 $ gdpPercap_2007: num  6223 4797 1441 12570 1217 ...
 $ lifeExp_1952  : num  43.1 30 38.2 47.6 32 ...
 $ lifeExp_1957  : num  45.7 32 40.4 49.6 34.9 ...
 $ lifeExp_1962  : num  48.3 34 42.6 51.5 37.8 ...
 $ lifeExp_1967  : num  51.4 36 44.9 53.3 40.7 ...
 $ lifeExp_1972  : num  54.5 37.9 47 56 43.6 ...
 $ lifeExp_1977  : num  58 39.5 49.2 59.3 46.1 ...
 $ lifeExp_1982  : num  61.4 39.9 50.9 61.5 48.1 ...
 $ lifeExp_1987  : num  65.8 39.9 52.3 63.6 49.6 ...
 $ lifeExp_1992  : num  67.7 40.6 53.9 62.7 50.3 ...
 $ lifeExp_1997  : num  69.2 41 54.8 52.6 50.3 ...
 $ lifeExp_2002  : num  71 41 54.4 46.6 50.6 ...
 $ lifeExp_2007  : num  72.3 42.7 56.7 50.7 52.3 ...
 $ pop_1952      : num  9279525 4232095 1738315 442308 4469979 ...
 $ pop_1957      : num  10270856 4561361 1925173 474639 4713416 ...
 $ pop_1962      : num  11000948 4826015 2151895 512764 4919632 ...
 $ pop_1967      : num  12760499 5247469 2427334 553541 5127935 ...
 $ pop_1972      : num  14760787 5894858 2761407 619351 5433886 ...
 $ pop_1977      : num  17152804 6162675 3168267 781472 5889574 ...
 $ pop_1982      : num  20033753 7016384 3641603 970347 6634596 ...
 $ pop_1987      : num  23254956 7874230 4243788 1151184 7586551 ...
 $ pop_1992      : num  26298373 8735988 4981671 1342614 8878303 ...
 $ pop_1997      : num  29072015 9875024 6066080 1536536 10352843 ...
 $ pop_2002      : int  31287142 10866106 7026113 1630347 12251209 7021078 15929988 4048013 8835739 614382 ...
 $ pop_2007      : int  33333216 12420476 8078314 1639131 14326203 8390505 17696293 4369038 10238807 710960 ...</code></pre>
</div>
<figure><img src="../fig/14-tidyr-fig2.png" alt="Diagram illustrating the wide format of the gapminder data frame" class="figure mx-auto d-block"></figure><p>To change this very wide data frame layout back to our nice,
intermediate (or longer) layout, we will use one of the two available
<code>pivot</code> functions from the <code>tidyr</code> package. To
convert from wide to a longer format, we will use the
<code>pivot_longer()</code> function. <code>pivot_longer()</code> makes
datasets longer by increasing the number of rows and decreasing the
number of columns, or ‘lengthening’ your observation variables into a
single variable.</p>
<figure><img src="../fig/14-tidyr-fig3.png" alt="Diagram illustrating how pivot longer reorganizes a data frame from a wide to long format" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_long</span> <span class="op">&lt;-</span> <span class="va">gap_wide</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">'pop'</span><span class="op">)</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">'lifeExp'</span><span class="op">)</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">'gdpPercap'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"obstype_year"</span>, values_to <span class="op">=</span> <span class="st">"obs_values"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gap_long</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>tibble [5,112 × 4] (S3: tbl_df/tbl/data.frame)
 $ continent   : chr [1:5112] "Africa" "Africa" "Africa" "Africa" ...
 $ country     : chr [1:5112] "Algeria" "Algeria" "Algeria" "Algeria" ...
 $ obstype_year: chr [1:5112] "pop_1952" "pop_1957" "pop_1962" "pop_1967" ...
 $ obs_values  : num [1:5112] 9279525 10270856 11000948 12760499 14760787 ...</code></pre>
</div>
<p>Here we have used piping syntax which is similar to what we were
doing in the previous lesson with dplyr. In fact, these are compatible
and you can use a mix of tidyr and dplyr functions by piping them
together.</p>
<p>We first provide to <code>pivot_longer()</code> a vector of column
names that will be pivoted into longer format. We could type out all the
observation variables, but as in the <code>select()</code> function (see
<code>dplyr</code> lesson), we can use the <code>starts_with()</code>
argument to select all variables that start with the desired character
string. <code>pivot_longer()</code> also allows the alternative syntax
of using the <code>-</code> symbol to identify which variables are not
to be pivoted (i.e. ID variables).</p>
<p>The next arguments to <code>pivot_longer()</code> are
<code>names_to</code> for naming the column that will contain the new ID
variable (<code>obstype_year</code>) and <code>values_to</code> for
naming the new amalgamated observation variable
(<code>obs_value</code>). We supply these new column names as
strings.</p>
<figure><img src="../fig/14-tidyr-fig4.png" alt="Diagram illustrating the long format of the gapminder data" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_long</span> <span class="op">&lt;-</span> <span class="va">gap_wide</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="va">continent</span>, <span class="op">-</span><span class="va">country</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"obstype_year"</span>, values_to <span class="op">=</span> <span class="st">"obs_values"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gap_long</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>tibble [5,112 × 4] (S3: tbl_df/tbl/data.frame)
 $ continent   : chr [1:5112] "Africa" "Africa" "Africa" "Africa" ...
 $ country     : chr [1:5112] "Algeria" "Algeria" "Algeria" "Algeria" ...
 $ obstype_year: chr [1:5112] "gdpPercap_1952" "gdpPercap_1957" "gdpPercap_1962" "gdpPercap_1967" ...
 $ obs_values  : num [1:5112] 2449 3014 2551 3247 4183 ...</code></pre>
</div>
<p>That may seem trivial with this particular data frame, but sometimes
you have 1 ID variable and 40 observation variables with irregular
variable names. The flexibility is a huge time saver!</p>
<p>Now <code>obstype_year</code> actually contains 2 pieces of
information, the observation type
(<code>pop</code>,<code>lifeExp</code>, or <code>gdpPercap</code>) and
the <code>year</code>. We can use the <code>separate()</code> function
to split the character strings into multiple variables</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_long</span> <span class="op">&lt;-</span> <span class="va">gap_long</span> <span class="op">%&gt;%</span> <span class="fu">separate</span><span class="op">(</span><span class="va">obstype_year</span>, into <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">'obs_type'</span>, <span class="st">'year'</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="va">gap_long</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu">as.integer</span><span class="op">(</span><span class="va">gap_long</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></code></pre>
</div>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2</h3>
<div class="callout-content">
<p>Using <code>gap_long</code>, calculate the mean life expectancy,
population, and gdpPercap for each continent. <strong>Hint:</strong> use
the <code>group_by()</code> and <code>summarize()</code> functions we
learned in the <code>dplyr</code> lesson</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to Challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_long</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>, <span class="va">obs_type</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">summarize</span><span class="op">(</span>means<span class="op">=</span><span class="fu">mean</span><span class="op">(</span><span class="va">obs_values</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 15 × 3
# Groups:   continent [5]
   continent obs_type       means
   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
 1 Africa    gdpPercap     2194.
 2 Africa    lifeExp         48.9
 3 Africa    pop        9916003.
 4 Americas  gdpPercap     7136.
 5 Americas  lifeExp         64.7
 6 Americas  pop       24504795.
 7 Asia      gdpPercap     7902.
 8 Asia      lifeExp         60.1
 9 Asia      pop       77038722.
10 Europe    gdpPercap    14469.
11 Europe    lifeExp         71.9
12 Europe    pop       17169765.
13 Oceania   gdpPercap    18622.
14 Oceania   lifeExp         74.3
15 Oceania   pop        8874672. </code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="from-long-to-intermediate-format-with-pivot_wider">From long to intermediate format with pivot_wider()<a class="anchor" aria-label="anchor" href="#from-long-to-intermediate-format-with-pivot_wider"></a>
</h2>
<hr class="half-width">
<p>It is always good to check work. So, let’s use the second
<code>pivot</code> function, <code>pivot_wider()</code>, to ‘widen’ our
observation variables back out. <code>pivot_wider()</code> is the
opposite of <code>pivot_longer()</code>, making a dataset wider by
increasing the number of columns and decreasing the number of rows. We
can use <code>pivot_wider()</code> to pivot or reshape our
<code>gap_long</code> to the original intermediate format or the widest
format. Let’s start with the intermediate format.</p>
<p>The <code>pivot_wider()</code> function takes <code>names_from</code>
and <code>values_from</code> arguments.</p>
<p>To <code>names_from</code> we supply the column name whose contents
will be pivoted into new output columns in the widened data frame. The
corresponding values will be added from the column named in the
<code>values_from</code> argument.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_normal</span> <span class="op">&lt;-</span> <span class="va">gap_long</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">obs_type</span>, values_from <span class="op">=</span> <span class="va">obs_values</span><span class="op">)</span></span>
<span><span class="fu">dim</span><span class="op">(</span><span class="va">gap_normal</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1704    6</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dim</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1704    6</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">gap_normal</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "continent" "country"   "year"      "gdpPercap" "lifeExp"   "pop"      </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "country"   "year"      "pop"       "continent" "lifeExp"   "gdpPercap"</code></pre>
</div>
<p>Now we’ve got an intermediate data frame <code>gap_normal</code> with
the same dimensions as the original <code>gapminder</code>, but the
order of the variables is different. Let’s fix that before checking if
they are <code>all.equal()</code>.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_normal</span> <span class="op">&lt;-</span> <span class="va">gap_normal</span><span class="op">[</span>, <span class="fu">names</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu">all.equal</span><span class="op">(</span><span class="va">gap_normal</span>, <span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Attributes: &lt; Component \"class\": Lengths (3, 1) differ (string compare on first 1) &gt;"
[2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"
[3] "Component \"country\": 1704 string mismatches"
[4] "Component \"pop\": Mean relative difference: 1.634504"
[5] "Component \"continent\": 1212 string mismatches"
[6] "Component \"lifeExp\": Mean relative difference: 0.203822"
[7] "Component \"gdpPercap\": Mean relative difference: 1.162302"                           </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gap_normal</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 6
  country  year      pop continent lifeExp gdpPercap
  &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Algeria  1952  9279525 Africa       43.1     2449.
2 Algeria  1957 10270856 Africa       45.7     3014.
3 Algeria  1962 11000948 Africa       48.3     2551.
4 Algeria  1967 12760499 Africa       51.4     3247.
5 Algeria  1972 14760787 Africa       54.5     4183.
6 Algeria  1977 17152804 Africa       58.0     4910.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap
1 Afghanistan 1952  8425333      Asia  28.801  779.4453
2 Afghanistan 1957  9240934      Asia  30.332  820.8530
3 Afghanistan 1962 10267083      Asia  31.997  853.1007
4 Afghanistan 1967 11537966      Asia  34.020  836.1971
5 Afghanistan 1972 13079460      Asia  36.088  739.9811
6 Afghanistan 1977 14880372      Asia  38.438  786.1134</code></pre>
</div>
<p>We’re almost there, the original was sorted by <code>country</code>,
then <code>year</code>.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_normal</span> <span class="op">&lt;-</span> <span class="va">gap_normal</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span><span class="op">)</span></span>
<span><span class="fu">all.equal</span><span class="op">(</span><span class="va">gap_normal</span>, <span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Attributes: &lt; Component \"class\": Lengths (3, 1) differ (string compare on first 1) &gt;"
[2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"                                </code></pre>
</div>
<p>That’s great! We’ve gone from the longest format back to the
intermediate and we didn’t introduce any errors in our code.</p>
<p>Now let’s convert the long all the way back to the wide. In the wide
format, we will keep country and continent as ID variables and pivot the
observations across the 3 metrics
(<code>pop</code>,<code>lifeExp</code>,<code>gdpPercap</code>) and time
(<code>year</code>). First we need to create appropriate labels for all
our new variables (time*metric combinations) and we also need to unify
our ID variables to simplify the process of defining
<code>gap_wide</code>.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_temp</span> <span class="op">&lt;-</span> <span class="va">gap_long</span> <span class="op">%&gt;%</span> <span class="fu">unite</span><span class="op">(</span><span class="va">var_ID</span>, <span class="va">continent</span>, <span class="va">country</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gap_temp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>tibble [5,112 × 4] (S3: tbl_df/tbl/data.frame)
 $ var_ID    : chr [1:5112] "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" ...
 $ obs_type  : chr [1:5112] "gdpPercap" "gdpPercap" "gdpPercap" "gdpPercap" ...
 $ year      : int [1:5112] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ obs_values: num [1:5112] 2449 3014 2551 3247 4183 ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_temp</span> <span class="op">&lt;-</span> <span class="va">gap_long</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">unite</span><span class="op">(</span><span class="va">ID_var</span>, <span class="va">continent</span>, <span class="va">country</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">unite</span><span class="op">(</span><span class="va">var_names</span>, <span class="va">obs_type</span>, <span class="va">year</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gap_temp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>tibble [5,112 × 3] (S3: tbl_df/tbl/data.frame)
 $ ID_var    : chr [1:5112] "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" ...
 $ var_names : chr [1:5112] "gdpPercap_1952" "gdpPercap_1957" "gdpPercap_1962" "gdpPercap_1967" ...
 $ obs_values: num [1:5112] 2449 3014 2551 3247 4183 ...</code></pre>
</div>
<p>Using <code>unite()</code> we now have a single ID variable which is
a combination of <code>continent</code>,<code>country</code>,and we have
defined variable names. We’re now ready to pipe in
<code>pivot_wider()</code></p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_wide_new</span> <span class="op">&lt;-</span> <span class="va">gap_long</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">unite</span><span class="op">(</span><span class="va">ID_var</span>, <span class="va">continent</span>, <span class="va">country</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">unite</span><span class="op">(</span><span class="va">var_names</span>, <span class="va">obs_type</span>, <span class="va">year</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">var_names</span>, values_from <span class="op">=</span> <span class="va">obs_values</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gap_wide_new</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>tibble [142 × 37] (S3: tbl_df/tbl/data.frame)
 $ ID_var        : chr [1:142] "Africa_Algeria" "Africa_Angola" "Africa_Benin" "Africa_Botswana" ...
 $ gdpPercap_1952: num [1:142] 2449 3521 1063 851 543 ...
 $ gdpPercap_1957: num [1:142] 3014 3828 960 918 617 ...
 $ gdpPercap_1962: num [1:142] 2551 4269 949 984 723 ...
 $ gdpPercap_1967: num [1:142] 3247 5523 1036 1215 795 ...
 $ gdpPercap_1972: num [1:142] 4183 5473 1086 2264 855 ...
 $ gdpPercap_1977: num [1:142] 4910 3009 1029 3215 743 ...
 $ gdpPercap_1982: num [1:142] 5745 2757 1278 4551 807 ...
 $ gdpPercap_1987: num [1:142] 5681 2430 1226 6206 912 ...
 $ gdpPercap_1992: num [1:142] 5023 2628 1191 7954 932 ...
 $ gdpPercap_1997: num [1:142] 4797 2277 1233 8647 946 ...
 $ gdpPercap_2002: num [1:142] 5288 2773 1373 11004 1038 ...
 $ gdpPercap_2007: num [1:142] 6223 4797 1441 12570 1217 ...
 $ lifeExp_1952  : num [1:142] 43.1 30 38.2 47.6 32 ...
 $ lifeExp_1957  : num [1:142] 45.7 32 40.4 49.6 34.9 ...
 $ lifeExp_1962  : num [1:142] 48.3 34 42.6 51.5 37.8 ...
 $ lifeExp_1967  : num [1:142] 51.4 36 44.9 53.3 40.7 ...
 $ lifeExp_1972  : num [1:142] 54.5 37.9 47 56 43.6 ...
 $ lifeExp_1977  : num [1:142] 58 39.5 49.2 59.3 46.1 ...
 $ lifeExp_1982  : num [1:142] 61.4 39.9 50.9 61.5 48.1 ...
 $ lifeExp_1987  : num [1:142] 65.8 39.9 52.3 63.6 49.6 ...
 $ lifeExp_1992  : num [1:142] 67.7 40.6 53.9 62.7 50.3 ...
 $ lifeExp_1997  : num [1:142] 69.2 41 54.8 52.6 50.3 ...
 $ lifeExp_2002  : num [1:142] 71 41 54.4 46.6 50.6 ...
 $ lifeExp_2007  : num [1:142] 72.3 42.7 56.7 50.7 52.3 ...
 $ pop_1952      : num [1:142] 9279525 4232095 1738315 442308 4469979 ...
 $ pop_1957      : num [1:142] 10270856 4561361 1925173 474639 4713416 ...
 $ pop_1962      : num [1:142] 11000948 4826015 2151895 512764 4919632 ...
 $ pop_1967      : num [1:142] 12760499 5247469 2427334 553541 5127935 ...
 $ pop_1972      : num [1:142] 14760787 5894858 2761407 619351 5433886 ...
 $ pop_1977      : num [1:142] 17152804 6162675 3168267 781472 5889574 ...
 $ pop_1982      : num [1:142] 20033753 7016384 3641603 970347 6634596 ...
 $ pop_1987      : num [1:142] 23254956 7874230 4243788 1151184 7586551 ...
 $ pop_1992      : num [1:142] 26298373 8735988 4981671 1342614 8878303 ...
 $ pop_1997      : num [1:142] 29072015 9875024 6066080 1536536 10352843 ...
 $ pop_2002      : num [1:142] 31287142 10866106 7026113 1630347 12251209 ...
 $ pop_2007      : num [1:142] 33333216 12420476 8078314 1639131 14326203 ...</code></pre>
</div>
<div id="challenge-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3</h3>
<div class="callout-content">
<p>Take this 1 step further and create a
<code>gap_ludicrously_wide</code> format data by pivoting over
countries, year and the 3 metrics? <strong>Hint</strong> this new data
frame should only have 5 rows.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Solution to Challenge 3
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_ludicrously_wide</span> <span class="op">&lt;-</span> <span class="va">gap_long</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">unite</span><span class="op">(</span><span class="va">var_names</span>, <span class="va">obs_type</span>, <span class="va">year</span>, <span class="va">country</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">var_names</span>, values_from <span class="op">=</span> <span class="va">obs_values</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Now we have a great ‘wide’ format data frame, but the
<code>ID_var</code> could be more usable, let’s separate it into 2
variables with <code>separate()</code></p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_wide_betterID</span> <span class="op">&lt;-</span> <span class="fu">separate</span><span class="op">(</span><span class="va">gap_wide_new</span>, <span class="va">ID_var</span>, <span class="fu">c</span><span class="op">(</span><span class="st">"continent"</span>, <span class="st">"country"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span></span>
<span><span class="va">gap_wide_betterID</span> <span class="op">&lt;-</span> <span class="va">gap_long</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">unite</span><span class="op">(</span><span class="va">ID_var</span>, <span class="va">continent</span>, <span class="va">country</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">unite</span><span class="op">(</span><span class="va">var_names</span>, <span class="va">obs_type</span>, <span class="va">year</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">var_names</span>, values_from <span class="op">=</span> <span class="va">obs_values</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">separate</span><span class="op">(</span><span class="va">ID_var</span>, <span class="fu">c</span><span class="op">(</span><span class="st">"continent"</span>,<span class="st">"country"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gap_wide_betterID</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>tibble [142 × 38] (S3: tbl_df/tbl/data.frame)
 $ continent     : chr [1:142] "Africa" "Africa" "Africa" "Africa" ...
 $ country       : chr [1:142] "Algeria" "Angola" "Benin" "Botswana" ...
 $ gdpPercap_1952: num [1:142] 2449 3521 1063 851 543 ...
 $ gdpPercap_1957: num [1:142] 3014 3828 960 918 617 ...
 $ gdpPercap_1962: num [1:142] 2551 4269 949 984 723 ...
 $ gdpPercap_1967: num [1:142] 3247 5523 1036 1215 795 ...
 $ gdpPercap_1972: num [1:142] 4183 5473 1086 2264 855 ...
 $ gdpPercap_1977: num [1:142] 4910 3009 1029 3215 743 ...
 $ gdpPercap_1982: num [1:142] 5745 2757 1278 4551 807 ...
 $ gdpPercap_1987: num [1:142] 5681 2430 1226 6206 912 ...
 $ gdpPercap_1992: num [1:142] 5023 2628 1191 7954 932 ...
 $ gdpPercap_1997: num [1:142] 4797 2277 1233 8647 946 ...
 $ gdpPercap_2002: num [1:142] 5288 2773 1373 11004 1038 ...
 $ gdpPercap_2007: num [1:142] 6223 4797 1441 12570 1217 ...
 $ lifeExp_1952  : num [1:142] 43.1 30 38.2 47.6 32 ...
 $ lifeExp_1957  : num [1:142] 45.7 32 40.4 49.6 34.9 ...
 $ lifeExp_1962  : num [1:142] 48.3 34 42.6 51.5 37.8 ...
 $ lifeExp_1967  : num [1:142] 51.4 36 44.9 53.3 40.7 ...
 $ lifeExp_1972  : num [1:142] 54.5 37.9 47 56 43.6 ...
 $ lifeExp_1977  : num [1:142] 58 39.5 49.2 59.3 46.1 ...
 $ lifeExp_1982  : num [1:142] 61.4 39.9 50.9 61.5 48.1 ...
 $ lifeExp_1987  : num [1:142] 65.8 39.9 52.3 63.6 49.6 ...
 $ lifeExp_1992  : num [1:142] 67.7 40.6 53.9 62.7 50.3 ...
 $ lifeExp_1997  : num [1:142] 69.2 41 54.8 52.6 50.3 ...
 $ lifeExp_2002  : num [1:142] 71 41 54.4 46.6 50.6 ...
 $ lifeExp_2007  : num [1:142] 72.3 42.7 56.7 50.7 52.3 ...
 $ pop_1952      : num [1:142] 9279525 4232095 1738315 442308 4469979 ...
 $ pop_1957      : num [1:142] 10270856 4561361 1925173 474639 4713416 ...
 $ pop_1962      : num [1:142] 11000948 4826015 2151895 512764 4919632 ...
 $ pop_1967      : num [1:142] 12760499 5247469 2427334 553541 5127935 ...
 $ pop_1972      : num [1:142] 14760787 5894858 2761407 619351 5433886 ...
 $ pop_1977      : num [1:142] 17152804 6162675 3168267 781472 5889574 ...
 $ pop_1982      : num [1:142] 20033753 7016384 3641603 970347 6634596 ...
 $ pop_1987      : num [1:142] 23254956 7874230 4243788 1151184 7586551 ...
 $ pop_1992      : num [1:142] 26298373 8735988 4981671 1342614 8878303 ...
 $ pop_1997      : num [1:142] 29072015 9875024 6066080 1536536 10352843 ...
 $ pop_2002      : num [1:142] 31287142 10866106 7026113 1630347 12251209 ...
 $ pop_2007      : num [1:142] 33333216 12420476 8078314 1639131 14326203 ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">all.equal</span><span class="op">(</span><span class="va">gap_wide</span>, <span class="va">gap_wide_betterID</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Attributes: &lt; Component \"class\": Lengths (1, 3) differ (string compare on first 1) &gt;"
[2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"                                </code></pre>
</div>
<p>There and back again!</p>
</section><section><h2 class="section-heading" id="other-great-resources">Other great resources<a class="anchor" aria-label="anchor" href="#other-great-resources"></a>
</h2>
<hr class="half-width">
<ul>
<li>
<a href="https://r4ds.hadley.nz/" class="external-link">R for Data Science</a> (online
book)</li>
<li>
<a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="external-link">Data
Wrangling Cheat sheet</a> (pdf file)</li>
<li>
<a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html" class="external-link">Introduction
to tidyr</a> (online documentation)</li>
<li>
<a href="https://www.rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/" class="external-link">Data
wrangling with R and RStudio</a> (online video)</li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use the <code>tidyr</code> package to change the layout of data
frames.</li>
<li>Use <code>pivot_longer()</code> to go from wide to longer
layout.</li>
<li>Use <code>pivot_wider()</code> to go from long to wider layout.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-14-knitr-markdown"><p>Content from <a href="14-knitr-markdown.html">Producing Reports With knitr</a></p>
<hr>
<p>Last updated on 2024-11-26 |

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/episodes/14-knitr-markdown.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 75 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I integrate software and reports?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand the value of writing reproducible reports</li>
<li>Learn how to recognise and compile the basic components of an R
Markdown file</li>
<li>Become familiar with R code chunks, and understand their purpose,
structure and options</li>
<li>Demonstrate the use of inline chunks for weaving R outputs into text
blocks, for example when discussing the results of some
calculations</li>
<li>Be aware of alternative output formats to which an R Markdown file
can be exported</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="data-analysis-reports">Data analysis reports<a class="anchor" aria-label="anchor" href="#data-analysis-reports"></a>
</h2>
<hr class="half-width">
<p>Data analysts tend to write a lot of reports, describing their
analyses and results, for their collaborators or to document their work
for future reference.</p>
<p>Many new users begin by first writing a single R script containing
all of their work, and then share the analysis by emailing the script
and various graphs as attachments. But this can be cumbersome, requiring
a lengthy discussion to explain which attachment was which result.</p>
<p>Writing formal reports with Word or <a href="https://www.latex-project.org/" class="external-link">LaTeX</a> can simplify this
process by incorporating both the analysis report and output graphs into
a single document. But tweaking formatting to make figures look correct
and fixing obnoxious page breaks can be tedious and lead to a lengthy
“whack-a-mole” game of fixing new mistakes resulting from a single
formatting change.</p>
<p>Creating a report as a web page (which is an html file) using R
Markdown makes things easier. The report can be one long stream, so tall
figures that wouldn’t ordinarily fit on one page can be kept at full
size and easier to read, since the reader can simply keep scrolling.
Additionally, the formatting of and R Markdown document is simple and
easy to modify, allowing you to spend more time on your analyses instead
of writing reports.</p>
</section><section><h2 class="section-heading" id="literate-programming">Literate programming<a class="anchor" aria-label="anchor" href="#literate-programming"></a>
</h2>
<hr class="half-width">
<p>Ideally, such analysis reports are <em>reproducible</em> documents:
If an error is discovered, or if some additional subjects are added to
the data, you can just re-compile the report and get the new or
corrected results rather than having to reconstruct figures, paste them
into a Word document, and hand-edit various detailed results.</p>
<p>The key R package here is <a href="https://yihui.name/knitr/" class="external-link"><code>knitr</code></a>. It allows you
to create a document that is a mixture of text and chunks of code. When
the document is processed by <code>knitr</code>, chunks of code will be
executed, and graphs or other results will be inserted into the final
document.</p>
<p>This sort of idea has been called “literate programming”.</p>
<p><code>knitr</code> allows you to mix basically any type of text with
code from different programming languages, but we recommend that you use
<code>R Markdown</code>, which mixes Markdown with R. <a href="https://www.markdownguide.org/" class="external-link">Markdown</a> is a light-weight
mark-up language for creating web pages.</p>
</section><section><h2 class="section-heading" id="creating-an-r-markdown-file">Creating an R Markdown file<a class="anchor" aria-label="anchor" href="#creating-an-r-markdown-file"></a>
</h2>
<hr class="half-width">
<p>Within RStudio, click File → New File → R Markdown and you’ll get a
dialog box like this:</p>
<figure><img src="../fig/New_R_Markdown.png" alt="Screenshot of the New R Markdown file dialogue box in RStudio" class="figure mx-auto d-block"></figure><p>You can stick with the default (HTML output), but give it a
title.</p>
</section><section><h2 class="section-heading" id="basic-components-of-r-markdown">Basic components of R Markdown<a class="anchor" aria-label="anchor" href="#basic-components-of-r-markdown"></a>
</h2>
<hr class="half-width">
<p>The initial chunk of text (header) contains instructions for R to
specify what kind of document will be created, and the options chosen.
You can use the header to give your document a title, author, date, and
tell it what type of output you want to produce. In this case, we’re
creating an html document.</p>
<pre><code>---
title: "Initial R Markdown document"
author: "Karl Broman"
date: "April 23, 2015"
output: html_document
---</code></pre>
<p>You can delete any of those fields if you don’t want them included.
The double-quotes aren’t strictly <em>necessary</em> in this case.
They’re mostly needed if you want to include a colon in the title.</p>
<p>RStudio creates the document with some example text to get you
started. Note below that there are chunks like</p>
<pre>
```{r}
summary(cars)
```
</pre>
<p>These are chunks of R code that will be executed by
<code>knitr</code> and replaced by their results. More on this
later.</p>
</section><section><h2 class="section-heading" id="markdown">Markdown<a class="anchor" aria-label="anchor" href="#markdown"></a>
</h2>
<hr class="half-width">
<p>Markdown is a system for writing web pages by marking up the text
much as you would in an email rather than writing html code. The
marked-up text gets <em>converted</em> to html, replacing the marks with
the proper html code.</p>
<p>For now, let’s delete all of the stuff that’s there and write a bit
of markdown.</p>
<p>You make things <strong>bold</strong> using two asterisks, like this:
<code>**bold**</code>, and you make things <em>italics</em> by using
underscores, like this: <code>_italics_</code>.</p>
<p>You can make a bulleted list by writing a list with hyphens or
asterisks with a space between the list and other text, like this:</p>
<pre><code>A list:

* bold with double-asterisks
* italics with underscores
* code-type font with backticks</code></pre>
<p>or like this:</p>
<pre><code>A second list:

- bold with double-asterisks
- italics with underscores
- code-type font with backticks</code></pre>
<p>Each will appear as:</p>
<ul>
<li>bold with double-asterisks</li>
<li>italics with underscores</li>
<li>code-type font with backticks</li>
</ul>
<p>You can use whatever method you prefer, but <em>be consistent</em>.
This maintains the readability of your code.</p>
<p>You can make a numbered list by just using numbers. You can even use
the same number over and over if you want:</p>
<pre><code>1. bold with double-asterisks
1. italics with underscores
1. code-type font with backticks</code></pre>
<p>This will appear as:</p>
<ol style="list-style-type: decimal">
<li>bold with double-asterisks</li>
<li>italics with underscores</li>
<li>code-type font with backticks</li>
</ol>
<p>You can make section headers of different sizes by initiating a line
with some number of <code>#</code> symbols:</p>
<pre><code><span><span class="co"># Title</span></span>
<span><span class="co">## Main section</span></span>
<span><span class="co">### Sub-section</span></span>
<span><span class="co">#### Sub-sub section</span></span></code></pre>
<p>You <em>compile</em> the R Markdown document to an html webpage by
clicking the “Knit” button in the upper-left.</p>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1</h3>
<div class="callout-content">
<p>Create a new R Markdown document. Delete all of the R code chunks and
write a bit of Markdown (some sections, some italicized text, and an
itemized list).</p>
<p>Convert the document to a webpage.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to Challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>In RStudio, select File &gt; New file &gt; R Markdown…</p>
<p>Delete the placeholder text and add the following:</p>
<pre><code># Introduction

## Background on Data

This report uses the *gapminder* dataset, which has columns that include:

* country
* continent
* year
* lifeExp
* pop
* gdpPercap

## Background on Methods
</code></pre>
<p>Then click the ‘Knit’ button on the toolbar to generate an html
document (webpage).</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="a-bit-more-markdown">A bit more Markdown<a class="anchor" aria-label="anchor" href="#a-bit-more-markdown"></a>
</h2>
<hr class="half-width">
<p>You can make a hyperlink like this:
<code>[Carpentries Home Page](https://carpentries.org/)</code>.</p>
<p>You can include an image file like this:
<code>![The Carpentries Logo](https://carpentries.org/assets/img/TheCarpentries.svg)</code></p>
<p>You can do subscripts (e.g., F<sub>2</sub>) with <code>F~2~</code>
and superscripts (e.g., F<sup>2</sup>) with <code>F^2^</code>.</p>
<p>If you know how to write equations in <a href="https://www.latex-project.org/" class="external-link">LaTeX</a>, you can use
<code>$ $</code> and <code>$$ $$</code> to insert math equations, like
<code>$E = mc^2$</code> and</p>
<pre><code>$$y = \mu + \sum_{i=1}^p \beta_i x_i + \epsilon$$</code></pre>
<p>You can review Markdown syntax by navigating to the “Markdown Quick
Reference” under the “Help” field in the toolbar at the top of
RStudio.</p>
</section><section><h2 class="section-heading" id="r-code-chunks">R code chunks<a class="anchor" aria-label="anchor" href="#r-code-chunks"></a>
</h2>
<hr class="half-width">
<p>The real power of Markdown comes from mixing markdown with chunks of
code. This is R Markdown. When processed, the R code will be executed;
if they produce figures, the figures will be inserted in the final
document.</p>
<p>The main code chunks look like this:</p>
<pre>
```{r load_data}
gapminder
<p>That is, you place a chunk of R code between <code>```{r
chunk_name}</code> and <code>```</code>. You should give each chunk a
unique name, as they will help you to fix errors and, if any graphs are
produced, the file names are based on the name of the code chunk that
produced them. You can create code chunks quickly in RStudio using the
shortcuts <kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>I</kbd> on Windows and
Linux, or <kbd>Cmd</kbd>+<kbd>Option</kbd>+<kbd>I</kbd> on Mac.</p>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2</h3>
<div class="callout-content">
<p>Add code chunks to:</p>
<ul>
<li>Load the ggplot2 package</li>
<li>Read the gapminder data</li>
<li>Create a plot</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to Challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<pre>
```{r load-ggplot2}
library("ggplot2")
```
</pre>
<pre>
```{r read-gapminder-data}
gapminder
<pre>
```{r make-plot}
plot(lifeExp ~ year, data = gapminder)
```
</pre>
</pre>
</div>
</div>
</div>
</div>
</pre></section><section><h2 class="section-heading" id="how-things-get-compiled">How things get compiled<a class="anchor" aria-label="anchor" href="#how-things-get-compiled"></a>
</h2>
<hr class="half-width">
<p>When you press the “Knit” button, the R Markdown document is
processed by <a href="https://yihui.name/knitr" class="external-link"><code>knitr</code></a>
and a plain Markdown document is produced (as well as, potentially, a
set of figure files): the R code is executed and replaced by both the
input and the output; if figures are produced, links to those figures
are included.</p>
<p>The Markdown and figure documents are then processed by the tool <a href="https://pandoc.org/" class="external-link"><code>pandoc</code></a>, which converts the
Markdown file into an html file, with the figures embedded.</p>
<figure><img src="../fig/14-knitr-markdown-rendered-rmd_to_html_fig-1.png" style="display: block; margin: auto auto auto 0;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="chunk-options">Chunk options<a class="anchor" aria-label="anchor" href="#chunk-options"></a>
</h2>
<hr class="half-width">
<p>There are a variety of options to affect how the code chunks are
treated. Here are some examples:</p>
<ul>
<li>Use <code>echo=FALSE</code> to avoid having the code itself
shown.</li>
<li>Use <code>results="hide"</code> to avoid having any results
printed.</li>
<li>Use <code>eval=FALSE</code> to have the code shown but not
evaluated.</li>
<li>Use <code>warning=FALSE</code> and <code>message=FALSE</code> to
hide any warnings or messages produced.</li>
<li>Use <code>fig.height</code> and <code>fig.width</code> to control
the size of the figures produced (in inches).</li>
</ul>
<p>So you might write:</p>
<pre>
```{r load_libraries, echo=FALSE, message=FALSE}
library("dplyr")
library("ggplot2")
```
</pre>
<p>Often there will be particular options that you’ll want to use
repeatedly; for this, you can set <em>global</em> chunk options, like
so:</p>
<pre>
```{r global_options, echo=FALSE}
knitr::opts_chunk$set(fig.path="Figs/", message=FALSE, warning=FALSE,
                      echo=FALSE, results="hide", fig.width=11)
```
</pre>
<p>The <code>fig.path</code> option defines where the figures will be
saved. The <code>/</code> here is really important; without it, the
figures would be saved in the standard place but just with names that
begin with <code>Figs</code>.</p>
<p>If you have multiple R Markdown files in a common directory, you
might want to use <code>fig.path</code> to define separate prefixes for
the figure file names, like <code>fig.path="Figs/cleaning-"</code> and
<code>fig.path="Figs/analysis-"</code>.</p>
<div id="challenge-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3</h3>
<div class="callout-content">
<p>Use chunk options to control the size of a figure and to hide the
code.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Solution to Challenge 3
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<pre>
```{r echo = FALSE, fig.width = 3}
plot(faithful)
```
</pre>
</div>
</div>
</div>
</div>
<p>You can review all of the <code>R</code> chunk options by navigating
to the “R Markdown Cheat Sheet” under the “Cheatsheets” section of the
“Help” field in the toolbar at the top of RStudio.</p>
</section><section><h2 class="section-heading" id="inline-r-code">Inline R code<a class="anchor" aria-label="anchor" href="#inline-r-code"></a>
</h2>
<hr class="half-width">
<p>You can make <em>every</em> number in your report reproducible. Use
<code>`r</code> and <code>`</code> for an in-line code chunk, like so:
<code>`r round(some_value, 2)`</code>. The code will be executed and
replaced with the <em>value</em> of the result.</p>
<p>Don’t let these in-line chunks get split across lines.</p>
<p>Perhaps precede the paragraph with a larger code chunk that does
calculations and defines variables, with <code>include=FALSE</code> for
that larger chunk (which is the same as <code>echo=FALSE</code> and
<code>results="hide"</code>).</p>
<p>Rounding can produce differences in output in such situations. You
may want <code>2.0</code>, but <code>round(2.03, 1)</code> will give
just <code>2</code>.</p>
<p>The <a href="https://github.com/kbroman/broman/blob/master/R/myround.R" class="external-link"><code>myround</code></a>
function in the <a href="https://github.com/kbroman/broman" class="external-link">R/broman</a>
package handles this.</p>
<div id="challenge-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4" class="callout-inner">
<h3 class="callout-title">Challenge 4</h3>
<div class="callout-content">
<p>Try out a bit of in-line R code.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Solution to Challenge 4
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>Here’s some inline code to determine that 2 + 2 = <code>4</code>.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="other-output-options">Other output options<a class="anchor" aria-label="anchor" href="#other-output-options"></a>
</h2>
<hr class="half-width">
<p>You can also convert R Markdown to a PDF or a Word document. Click
the little triangle next to the “Knit” button to get a drop-down menu.
Or you could put <code>pdf_document</code> or <code>word_document</code>
in the initial header of the file.</p>
<div id="tip-creating-pdf-documents" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-creating-pdf-documents" class="callout-inner">
<h3 class="callout-title">Tip: Creating PDF documents</h3>
<div class="callout-content">
<p>Creating .pdf documents may require installation of some extra
software. The R package <code>tinytex</code> provides some tools to help
make this process easier for R users. With <code>tinytex</code>
installed, run <code>tinytex::install_tinytex()</code> to install the
required software (you’ll only need to do this once) and then when you
knit to pdf <code>tinytex</code> will automatically detect and install
any additional LaTeX packages that are needed to produce the pdf
document. Visit the <a href="https://yihui.org/tinytex/" class="external-link">tinytex
website</a> for more information.</p>
</div>
</div>
</div>
<div id="tip-visual-markdown-editing-in-rstudio" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-visual-markdown-editing-in-rstudio" class="callout-inner">
<h3 class="callout-title">Tip: Visual markdown editing in RStudio</h3>
<div class="callout-content">
<p>RStudio versions 1.4 and later include visual markdown editing mode.
In visual editing mode, markdown expressions (like
<code>**bold words**</code>) are transformed to the formatted appearance
(<strong>bold words</strong>) as you type. This mode also includes a
toolbar at the top with basic formatting buttons, similar to what you
might see in common word processing software programs. You can turn
visual editing on and off by pressing the <img src="../fig/visual_mode_icon.png" alt="Icon for turning on and off the visual editing mode in RStudio, which looks like a pair of compasses" class="figure">
button in the top right corner of your R Markdown document.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="resources">Resources<a class="anchor" aria-label="anchor" href="#resources"></a>
</h2>
<hr class="half-width">
<ul>
<li><a href="https://kbroman.org/knitr_knutshell" class="external-link">Knitr in a knutshell
tutorial</a></li>
<li>
<a href="https://www.amazon.com/exec/obidos/ASIN/1482203537/7210-20" class="external-link">Dynamic
Documents with R and knitr</a> (book)</li>
<li><a href="https://rmarkdown.rstudio.com" class="external-link">R Markdown
documentation</a></li>
<li><a href="https://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf" class="external-link">R
Markdown cheat sheet</a></li>
<li><a href="https://www.rstudio.com/resources/webinars/getting-started-with-r-markdown/" class="external-link">Getting
started with R Markdown</a></li>
<li>
<a href="https://bookdown.org/yihui/rmarkdown/" class="external-link">R Markdown: The
Definitive Guide</a> (book by Rstudio team)</li>
<li><a href="https://www.rstudio.com/resources/webinars/reproducible-reporting/" class="external-link">Reproducible
Reporting</a></li>
<li><a href="https://www.rstudio.com/resources/webinars/the-ecosystem-of-r-markdown/" class="external-link">The
Ecosystem of R Markdown</a></li>
<li><a href="https://www.rstudio.com/resources/webinars/introducing-bookdown/" class="external-link">Introducing
Bookdown</a></li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Mix reporting written in R Markdown with software written in R.</li>
<li>Specify chunk options to control formatting.</li>
<li>Use <code>knitr</code> to convert these documents into PDF and other
formats.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-15-wrap-up"><p>Content from <a href="15-wrap-up.html">Writing Good Software</a></p>
<hr>
<p>Last updated on 2024-11-26 |

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/episodes/15-wrap-up.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 15 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I write software that other people can use?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Describe best practices for writing R and explain the justification
for each.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="structure-your-project-folder">Structure your project folder<a class="anchor" aria-label="anchor" href="#structure-your-project-folder"></a>
</h2>
<hr class="half-width">
<p>Keep your project folder structured, organized and tidy, by creating
subfolders for your code files, manuals, data, binaries, output plots,
etc. It can be done completely manually, or with the help of RStudio’s
<code>New Project</code> functionality, or a designated package, such as
<code>ProjectTemplate</code>.</p>
<div id="tip-projecttemplate---a-possible-solution" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-projecttemplate---a-possible-solution" class="callout-inner">
<h3 class="callout-title">Tip: ProjectTemplate - a possible solution</h3>
<div class="callout-content">
<p>One way to automate the management of projects is to install the
third-party package, <code>ProjectTemplate</code>. This package will set
up an ideal directory structure for project management. This is very
useful as it enables you to have your analysis pipeline/workflow
organised and structured. Together with the default RStudio project
functionality and Git you will be able to keep track of your work as
well as be able to share your work with collaborators.</p>
<ol style="list-style-type: decimal">
<li>Install <code>ProjectTemplate</code>.</li>
<li>Load the library</li>
<li>Initialise the project:</li>
</ol>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"ProjectTemplate"</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="st">"ProjectTemplate"</span><span class="op">)</span></span>
<span><span class="fu">create.project</span><span class="op">(</span><span class="st">"../my_project_2"</span>, merge.strategy <span class="op">=</span> <span class="st">"allow.non.conflict"</span><span class="op">)</span></span></code></pre>
</div>
<p>For more information on ProjectTemplate and its functionality visit
the home page <a href="https://projecttemplate.net/index.html" class="external-link">ProjectTemplate</a></p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="make-code-readable">Make code readable<a class="anchor" aria-label="anchor" href="#make-code-readable"></a>
</h2>
<hr class="half-width">
<p>The most important part of writing code is making it readable and
understandable. You want someone else to be able to pick up your code
and be able to understand what it does: more often than not this someone
will be you 6 months down the line, who will otherwise be cursing
past-self.</p>
</section><section><h2 class="section-heading" id="documentation-tell-us-what-and-why-not-how">Documentation: tell us what and why, not how<a class="anchor" aria-label="anchor" href="#documentation-tell-us-what-and-why-not-how"></a>
</h2>
<hr class="half-width">
<p>When you first start out, your comments will often describe what a
command does, since you’re still learning yourself and it can help to
clarify concepts and remind you later. However, these comments aren’t
particularly useful later on when you don’t remember what problem your
code is trying to solve. Try to also include comments that tell you
<em>why</em> you’re solving a problem, and <em>what</em> problem that
is. The <em>how</em> can come after that: it’s an implementation detail
you ideally shouldn’t have to worry about.</p>
</section><section><h2 class="section-heading" id="keep-your-code-modular">Keep your code modular<a class="anchor" aria-label="anchor" href="#keep-your-code-modular"></a>
</h2>
<hr class="half-width">
<p>Our recommendation is that you should separate your functions from
your analysis scripts, and store them in a separate file that you
<code>source</code> when you open the R session in your project. This
approach is nice because it leaves you with an uncluttered analysis
script, and a repository of useful functions that can be loaded into any
analysis script in your project. It also lets you group related
functions together easily.</p>
</section><section><h2 class="section-heading" id="break-down-problem-into-bite-size-pieces">Break down problem into bite size pieces<a class="anchor" aria-label="anchor" href="#break-down-problem-into-bite-size-pieces"></a>
</h2>
<hr class="half-width">
<p>When you first start out, problem solving and function writing can be
daunting tasks, and hard to separate from code inexperience. Try to
break down your problem into digestible chunks and worry about the
implementation details later: keep breaking down the problem into
smaller and smaller functions until you reach a point where you can code
a solution, and build back up from there.</p>
</section><section><h2 class="section-heading" id="know-that-your-code-is-doing-the-right-thing">Know that your code is doing the right thing<a class="anchor" aria-label="anchor" href="#know-that-your-code-is-doing-the-right-thing"></a>
</h2>
<hr class="half-width">
<p>Make sure to test your functions!</p>
</section><section><h2 class="section-heading" id="dont-repeat-yourself">Don’t repeat yourself<a class="anchor" aria-label="anchor" href="#dont-repeat-yourself"></a>
</h2>
<hr class="half-width">
<p>Functions enable easy reuse within a project. If you see blocks of
similar lines of code through your project, those are usually candidates
for being moved into functions.</p>
<p>If your calculations are performed through a series of functions,
then the project becomes more modular and easier to change. This is
especially the case for which a particular input always gives a
particular output.</p>
</section><section><h2 class="section-heading" id="remember-to-be-stylish">Remember to be stylish<a class="anchor" aria-label="anchor" href="#remember-to-be-stylish"></a>
</h2>
<hr class="half-width">
<p>Apply consistent style to your code.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Keep your project folder structured, organized and tidy.</li>
<li>Document what and why, not how.</li>
<li>Break programs into short single-purpose functions.</li>
<li>Write re-runnable tests.</li>
<li>Don’t repeat yourself.</li>
<li>Be consistent in naming, indentation, and other aspects of
style.</li>
</ul>
</div>
</div>
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/swcarpentry/r-novice-gapminder/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/swcarpentry/r-novice-gapminder/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/swcarpentry/r-novice-gapminder/" class="external-link">Source</a></p>
				<p><a href="https://github.com/swcarpentry/r-novice-gapminder/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.10" class="external-link">sandpaper (0.16.10)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.7" class="external-link">pegboard (0.7.7)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://swcarpentry.github.io/r-novice-gapminder/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://swcarpentry.github.io/r-novice-gapminder/instructor/aio.html",
  "identifier": "https://swcarpentry.github.io/r-novice-gapminder/instructor/aio.html",
  "dateCreated": "2015-04-18",
  "dateModified": "2024-12-17",
  "datePublished": "2024-12-17"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

